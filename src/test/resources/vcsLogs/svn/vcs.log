------------------------------------------------------------------------
r15258 | carll | 2015-05-19 17:16:52 +0100 (Tue, 19 May 2015) | 2 lines
Changed paths:
   M /trunk/tests/check_ppc64le_cap

Set tests/check_ppc64le_cap to executable.

------------------------------------------------------------------------
r15257 | carll | 2015-05-19 17:08:05 +0100 (Tue, 19 May 2015) | 11 lines
Changed paths:
   M /trunk/coregrind/m_initimg/initimg-linux.c

Fix for the HWCAP2 aux vector.

The support assumed that if HWCAP2 is present that the system also supports
ISA2.07.  That assumption is not correct as we have found a few systems (OS)
where the HWCAP2 entry is present but the ISA2.07 bit is not set.  This patch
fixes the assertion test to specifically check the ISA2.07 support bit setting
in the HWCAP2 and vex_archinfo->hwcaps variable.  The setting for the 
ISA2.07 support must be the same in both variables if the HWCAP2 entry exists.

This patch updates Vagrind bugzilla 345695.

------------------------------------------------------------------------
r15256 | sewardj | 2015-05-19 17:01:40 +0100 (Tue, 19 May 2015) | 2 lines
Changed paths:
   M /trunk/docs/internals/3_10_BUGSTATUS.txt

Update.

------------------------------------------------------------------------
r15255 | rhyskidd | 2015-05-19 14:53:27 +0100 (Tue, 19 May 2015) | 1 line
Changed paths:
   M /trunk/darwin14.supp

Silence some reachable system library reports on OS X 10.10 for simple Hello World console application. No regressions. n-i-bz.
------------------------------------------------------------------------
r15254 | philippe | 2015-05-17 22:36:05 +0100 (Sun, 17 May 2015) | 5 lines
Changed paths:
   M /trunk/helgrind/libhb_core.c

Follow up to r15253:
Having a one elt free lineF cache avoids many PA calls.
This seems to slightly improve (a few %) a firefox startup.


------------------------------------------------------------------------
r15253 | philippe | 2015-05-17 20:32:42 +0100 (Sun, 17 May 2015) | 63 lines
Changed paths:
   M /trunk/coregrind/m_poolalloc.c
   M /trunk/helgrind/libhb_core.c
   M /trunk/include/pub_tool_poolalloc.h

This patch reduces the memory needed for the linesF.

Currently, each SecMap has an array of linesF, referenced by the linesZ
of the secmap that needs a lineF, via an index stored in dict[1].
When the array is full, its size is doubled.
The linesF array of a secmap is freed when the SecMap is GC-ed.
The above strategy has the following consequences:
  A. in average, 25% of the LinesF are unused.
  B. if a SecMap has 'temporarily' a need for linesF, but afterwards,
     these linesF are converted to normal lineZ representation, the linesF
     will not be recuperated unless the SecMap is GC-ed (i.e. fully marked
     no access).

The patch replaces the linesF array private per SecMap
by a pool allocator of LinesF shared between all SecMap.
A lineZ that needs a lineF will directly point to its lineF (using a pointer
stored in dict[1]), instead of having in dict[1] the index in the SecMap
linesF array.
When a lineZ needs a lineF, it is allocated from the pool allocator.
When a lineZ does not need anymore a lineF, it is returned back to the
pool allocator.

On a firefox startup, the above strategy reduces the memory for linesF
by about 42Mb. It seems that the more firefox is used (e.g. to visit
a few websites), the bigger the memory gain.
After opening the home page of valgrind, wikipedia and google, the memory
gain is about 94Mb:
trunk:
  linesF:    392,181 allocd ( 203,934,120 bytes occupied) (   173,279 used)
patch:
  linesF:    212,966 allocd ( 109,038,592 bytes occupied) (   170,252 used)

There is also less alloc/free operations in core arena with the patch:
trunk:
  core    :   810,680,320/  802,291,712 max/curr mmap'd, 17/19 unsplit/split sb unmmap'd,    759,441,224/  703,191,896 max/curr,    40631760/16376828248 totalloc-blocks/bytes,   188015696 searches 8 rzB
patch:
  core    :   701,628,416/  690,753,536 max/curr mmap'd, 12/29 unsplit/split sb unmmap'd,    643,041,944/  577,793,712 max/curr,    32050040/14056017712 totalloc-blocks/bytes,   174097728 searches 8 rzB


In terms of performance, no CPU impact detected on Firefox startup.
Note we have no representative reproducible (and preferrably small)
perf test that uses extensively linesF. Firefox is a good heavy lineF
user but is far to be reproducible, and is very far to be small.

Theoretically, in terms of CPU performance, the patch might have some
small benefits here and there for read operations, as the lineF pointer
is directly retrieved from the lineZ, rather than retrieved via an indirection
in the linesF array.
For write operations, the patch might need a little bit more CPU,
as we replace an
  assignment to lineF inUse boolean to False (and then probably back to True
  when the cacheline is written back)
by 
  a call to pool allocator VG_(freeEltPA) (and then probably a call to
  VG_(allocEltPA) when the cacheline is written back).
These PA functions are small, so cost should be ok.
We might however still maintain in clear_LineF_of_Z the last cleared lineF
and re-use it in alloc_LineF_for_Z. Not sure how many calls to the PA functions
would be avoided by this '1 elt cache' (and the needed 'if elt == NULL'
check in both clear_LineF_of_Z and alloc_LineF_for_Z.
This possible optimisationwill be looked at later.


------------------------------------------------------------------------
r15252 | philippe | 2015-05-17 19:37:14 +0100 (Sun, 17 May 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_gdbserver/remote-utils.c

Avoid warning about %d and long int


------------------------------------------------------------------------
r15250 | philippe | 2015-05-17 17:34:04 +0100 (Sun, 17 May 2015) | 6 lines
Changed paths:
   M /trunk/coregrind/m_gdbserver/remote-utils.c

Improve trace of pkt send by V gdbsrv:
  * show the len
  * print binary date using \octal notation (like printf, when given
    non printable chars)


------------------------------------------------------------------------
r15249 | rhyskidd | 2015-05-17 15:02:34 +0100 (Sun, 17 May 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c
   M /trunk/memcheck/tests/darwin/scalar.c
   M /trunk/memcheck/tests/darwin/scalar.stderr.exp
   M /trunk/memcheck/tests/darwin/scalar_nocancel.c
   M /trunk/memcheck/tests/darwin/scalar_nocancel.stderr.exp

Fix unhandled syscall: unix:410 (sigsuspend_nocancel) on OS X. bz#319274.
------------------------------------------------------------------------
r15248 | philippe | 2015-05-17 14:38:25 +0100 (Sun, 17 May 2015) | 4 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_gdbserver/m_gdbserver.c
   M /trunk/coregrind/m_gdbserver/server.c
   M /trunk/coregrind/m_gdbserver/server.h
   M /trunk/coregrind/m_gdbserver/target.c
   M /trunk/coregrind/m_signals.c
   M /trunk/coregrind/pub_core_gdbserver.h

* Let GDB user modify the signal to send to the guest process
* implement qXfer:siginfo:read: packet to allow GDB to show $_siginfo


------------------------------------------------------------------------
r15247 | philippe | 2015-05-17 09:24:40 +0100 (Sun, 17 May 2015) | 7 lines
Changed paths:
   M /trunk/coregrind/m_syscall.c
   M /trunk/coregrind/m_syswrap/syscall-amd64-linux.S
   M /trunk/coregrind/m_syswrap/syscall-x86-linux.S

Add some more cfi directives
With some gcc versions, without these directives, unwind does
not work or gives strange entries in stack traces.

Patch from Matthias Schwarzott 


------------------------------------------------------------------------
r15246 | rhyskidd | 2015-05-17 08:31:20 +0100 (Sun, 17 May 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c
   M /trunk/memcheck/tests/darwin
   M /trunk/memcheck/tests/darwin/Makefile.am
   A /trunk/memcheck/tests/darwin/ioctl-tiocsbrk.c
   A /trunk/memcheck/tests/darwin/ioctl-tiocsbrk.stderr.exp
   A /trunk/memcheck/tests/darwin/ioctl-tiocsbrk.vgtest

Fix Warning: noted but unhandled ioctl 0x2000747b on Mac OS X. bz#208217.
------------------------------------------------------------------------
r15245 | rhyskidd | 2015-05-17 07:01:04 +0100 (Sun, 17 May 2015) | 1 line
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c

Followup to r15242 - as PRE() and POST() wrappers utilised, define with the *XY variant.
------------------------------------------------------------------------
r15243 | florian | 2015-05-16 17:17:52 +0100 (Sat, 16 May 2015) | 2 lines
Changed paths:
   M /trunk/Makefile.all.am
   M /trunk/configure.ac
   M /trunk/coregrind/m_signals.c
   M /trunk/memcheck/tests/vbit-test/vtest.h

Enable a few more compiler warnings.

------------------------------------------------------------------------
r15242 | rhyskidd | 2015-05-16 15:48:08 +0100 (Sat, 16 May 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/priv_syswrap-darwin.h
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c
   M /trunk/memcheck/tests/darwin/scalar.c
   M /trunk/memcheck/tests/darwin/scalar.stderr.exp

Fix unhandled syscall: unix:132 (mkfifo) on OS X. bz#212291.
------------------------------------------------------------------------
r15241 | rhyskidd | 2015-05-16 15:18:36 +0100 (Sat, 16 May 2015) | 1 line
Changed paths:
   M /trunk/memcheck/tests/darwin
   M /trunk/memcheck/tests/darwin/Makefile.am
   A /trunk/memcheck/tests/darwin/mkfifo.c
   A /trunk/memcheck/tests/darwin/mkfifo.stderr.exp
   A /trunk/memcheck/tests/darwin/mkfifo.vgtest

Add (presently) failing test case for bz#212291.
------------------------------------------------------------------------
r15239 | carll | 2015-05-15 21:09:05 +0100 (Fri, 15 May 2015) | 13 lines
Changed paths:
   M /trunk/helgrind/tests/Makefile.am
   A /trunk/helgrind/tests/pth_cond_destroy_busy.stderr.exp-ppc64

Patch 5 in a revised series of cleanup patches from Will Schmidt

Add a .exp for the pth_cond_destroy_busy for PPC64 big endian.
This is specifically to cover the last line of output as
seen on ppc64BE, which is "ERROR SUMMARY: X errors from 3 contexts",
where X is 6, versus 3 as seen on other architectures.
The additional errors show up on BE during the "Thread #1: pthread_cond
_destroy: destruction of condition variable being waited upon."

Signed-off-by: Will Schmidt <will_schmidt@vnet.ibm.com>

This patch fixes Vagrind bugzilla 347686

------------------------------------------------------------------------
r15238 | carll | 2015-05-15 17:50:06 +0100 (Fri, 15 May 2015) | 15 lines
Changed paths:
   M /trunk/memcheck/mc_leakcheck.c

Patch 6 in a revised series of cleanup patches from Will Schmidt

    Fix multipleinheritance heuristic for ppc64LE (leak_cpp_interior test).
    Adjust the PPC64 #ifdiffery to indicate that ppc64BE uses a thunk table,
    but ppc64LE (in particular, the ELF ABIV2) does not.  In this case, thunk
    table == function descriptors.
    
    Signed-off-by: Will Schmidt <will_schmidt@vnet.ibm.com>
    --
    
    This patch replaces the previously posted "[6/7] add leak_cpp_interior
    test .exp results ....."

This patch fixes Vagrind bugzilla 347686

------------------------------------------------------------------------
r15237 | philippe | 2015-05-15 14:17:17 +0100 (Fri, 15 May 2015) | 3 lines
Changed paths:
   M /trunk/helgrind/libhb_core.c

Add statistics about the nr of used linesF


------------------------------------------------------------------------
r15236 | philippe | 2015-05-15 12:41:54 +0100 (Fri, 15 May 2015) | 115 lines
Changed paths:
   M /trunk/helgrind/hg_main.c
   M /trunk/helgrind/libhb_core.c

This patch (re-)gains performance in helgrind, following revision 15207, that
reduced memory use doing SecMap GC, but was slowing down some workloads
(typically, workloads doing a lot of malloc/free).

A significant part of the slowdown came from the clear of the filter,
that was not optimised for big ranges : the filter was working byte
per byte till an 8 alignment. Then working per 8 bytes at a time.

With the patch, the filter clear is done the following way:
   * all the bytes till 8 alignement are done together
   * then 8 bytes at a time till filter_line alignment (32 bytes)
   * then 32 bytes at a time.

Moreover, as the filter cache is small (1024 lines of 32 bytes),
clearing filter for ranges bigger than 32Kb was uselessly checking
several times the same entry. This is now avoided by using a range
check rather than a tag equality check.

As the new filter clear is significanly more complex than the previous simple
algorithm, the old algorithm is kept and used to check the new algorithm
when CHECK_ZSM is defined as 1.

The patch also contains a few micro optimisations and
disables 
   // VG_(track_die_mem_stack)       ( evh__die_mem );
as this had no effect and was somewhat costly.

With this patch, we have almost reached for all perf tests the same
performance as we had before revision 15207. Some tests are still
slightly slower than before the SecMap GC (max 2% difference).
Some tests are now significantly faster (e.g. sarp).
For almost all tests, we are now faster than valgrind 3.10.1.
Details below.

Regtested on x86/amd64/ppc64 (and regtested with all compile time
checks set).
I have also regtested with libreoffice and firefox.
(with firefox, also with CHECK_ZSM set to 1).


Details about performance:
hgtrace = this patch
trunk_untouched = trunk
base_secmap = trunk before secmap GC
valgrind 3.10.1 included for comparison
Measured on core i5 2.53GHz


-- Running  tests in perf ----------------------------------------------
-- bigcode1 --
bigcode1 hgtrace   :0.14s  he: 2.6s (18.4x, -----)
bigcode1 trunk_untouched:0.14s  he: 2.6s (18.4x, -0.4%)
bigcode1 base_secmap:0.14s  he: 2.6s (18.6x, -1.2%)
bigcode1 valgrind-3.10.1:0.14s  he: 2.8s (19.8x, -7.8%)
-- bigcode2 --
bigcode2 hgtrace   :0.14s  he: 6.3s (44.7x, -----)
bigcode2 trunk_untouched:0.14s  he: 6.2s (44.6x,  0.2%)
bigcode2 base_secmap:0.14s  he: 6.3s (45.0x, -0.6%)
bigcode2 valgrind-3.10.1:0.14s  he: 6.6s (47.1x, -5.4%)
-- bz2 --
bz2      hgtrace   :0.64s  he:11.3s (17.7x, -----)
bz2      trunk_untouched:0.64s  he:11.7s (18.2x, -3.2%)
bz2      base_secmap:0.64s  he:11.1s (17.3x,  1.9%)
bz2      valgrind-3.10.1:0.64s  he:12.6s (19.7x,-11.3%)
-- fbench --
fbench   hgtrace   :0.29s  he: 3.4s (11.8x, -----)
fbench   trunk_untouched:0.29s  he: 3.4s (11.7x,  0.6%)
fbench   base_secmap:0.29s  he: 3.6s (12.4x, -5.0%)
fbench   valgrind-3.10.1:0.29s  he: 3.5s (12.2x, -3.5%)
-- ffbench --
ffbench  hgtrace   :0.26s  he: 9.8s (37.7x, -----)
ffbench  trunk_untouched:0.26s  he:10.0s (38.4x, -1.9%)
ffbench  base_secmap:0.26s  he: 9.8s (37.8x, -0.2%)
ffbench  valgrind-3.10.1:0.26s  he:10.0s (38.4x, -1.9%)
-- heap --
heap     hgtrace   :0.11s  he: 9.2s (84.0x, -----)
heap     trunk_untouched:0.11s  he: 9.6s (87.1x, -3.7%)
heap     base_secmap:0.11s  he: 9.0s (81.9x,  2.5%)
heap     valgrind-3.10.1:0.11s  he: 9.1s (82.9x,  1.3%)
-- heap_pdb4 --
heap_pdb4 hgtrace   :0.13s  he:10.7s (82.3x, -----)
heap_pdb4 trunk_untouched:0.13s  he:11.0s (84.8x, -3.0%)
heap_pdb4 base_secmap:0.13s  he:10.5s (80.8x,  1.8%)
heap_pdb4 valgrind-3.10.1:0.13s  he:10.6s (81.8x,  0.7%)
-- many-loss-records --
many-loss-records hgtrace   :0.01s  he: 1.5s (152.0x, -----)
many-loss-records trunk_untouched:0.01s  he: 1.6s (157.0x, -3.3%)
many-loss-records base_secmap:0.01s  he: 1.6s (158.0x, -3.9%)
many-loss-records valgrind-3.10.1:0.01s  he: 1.7s (167.0x, -9.9%)
-- many-xpts --
many-xpts hgtrace   :0.03s  he: 2.8s (91.7x, -----)
many-xpts trunk_untouched:0.03s  he: 2.8s (94.7x, -3.3%)
many-xpts base_secmap:0.03s  he: 2.8s (94.0x, -2.5%)
many-xpts valgrind-3.10.1:0.03s  he: 2.9s (97.7x, -6.5%)
-- memrw --
memrw    hgtrace   :0.06s  he: 7.3s (121.2x, -----)
memrw    trunk_untouched:0.06s  he: 7.2s (120.3x,  0.7%)
memrw    base_secmap:0.06s  he: 7.1s (117.7x,  2.9%)
memrw    valgrind-3.10.1:0.06s  he: 8.1s (135.2x,-11.6%)
-- sarp --
sarp     hgtrace   :0.02s  he: 7.6s (378.5x, -----)
sarp     trunk_untouched:0.02s  he: 8.4s (422.0x,-11.5%)
sarp     base_secmap:0.02s  he: 8.6s (431.0x,-13.9%)
sarp     valgrind-3.10.1:0.02s  he: 8.8s (442.0x,-16.8%)
-- tinycc --
tinycc   hgtrace   :0.20s  he:12.4s (62.0x, -----)
tinycc   trunk_untouched:0.20s  he:12.6s (63.2x, -1.9%)
tinycc   base_secmap:0.20s  he:12.6s (63.0x, -1.6%)
tinycc   valgrind-3.10.1:0.20s  he:12.7s (63.5x, -2.3%)
-- Finished tests in perf ----------------------------------------------

== 12 programs, 48 timings =================



------------------------------------------------------------------------
r15235 | philippe | 2015-05-15 10:38:54 +0100 (Fri, 15 May 2015) | 2 lines
Changed paths:
   M /trunk/helgrind/libhb_core.c

micro-opt: add an UNLIKELY

------------------------------------------------------------------------
r15234 | philippe | 2015-05-14 23:37:30 +0100 (Thu, 14 May 2015) | 5 lines
Changed paths:
   M /trunk/coregrind/m_stacks.c

* add some comments in stack_limits
* add UNLIKELY indications for unlikely conditions
No functional difference.


------------------------------------------------------------------------
r15233 | carll | 2015-05-14 22:52:59 +0100 (Thu, 14 May 2015) | 13 lines
Changed paths:
   M /trunk/memcheck/tests/supp_unknown.supp
   M /trunk/memcheck/tests/supp_unknown.vgtest


Patch 4 in a revised series of cleanup patches from Will Schmidt

Add a suppression to handle a "Jump to the invalid address..." message
that gets generated on power.  This is a variation of the existing
suppressions.

While here, I also updated the "prog:" line in the vgtest file to reference
the supp_unknown executable, versus the badjump executable.  They share the
same source code, so I think this is effectively cosmetic.
 
This patch fixes Vagrind bugzilla 347686

------------------------------------------------------------------------
r15232 | philippe | 2015-05-14 22:26:36 +0100 (Thu, 14 May 2015) | 8 lines
Changed paths:
   M /trunk/coregrind/m_xarray.c

avoid warning

m_xarray.c:133:23: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]

(I have double checked that passing a negative argument makes the 
assert fail)


------------------------------------------------------------------------
r15231 | philippe | 2015-05-14 22:05:49 +0100 (Thu, 14 May 2015) | 23 lines
Changed paths:
   M /trunk/coregrind/m_libcassert.c

Add the lwpid in the scheduler status information
E.g. we now have:
Thread 1: status = VgTs_Runnable (lwpid 15782)
==15782==    at 0x8048EB5: main (sleepers.c:188)
client stack range: [0xBE836000 0xBE839FFF] client SP: 0xBE838F80
valgrind stack top usage: 10264 of 1048576

Thread 2: status = VgTs_WaitSys (lwpid 15828)
==15782==    at 0x2E9451: ??? (syscall-template.S:82)
==15782==    by 0x8048AD3: sleeper_or_burner (sleepers.c:84)
==15782==    by 0x39B924: start_thread (pthread_create.c:297)
==15782==    by 0x2F107D: clone (clone.S:130)
client stack range: [0x442F000 0x4E2EFFF] client SP: 0x4E2E338
valgrind stack top usage: 2288 of 1048576

This allows to attach with GDB to the good lwpid in case
you want to examine the valgrind state rather than the guest state.

(it is needed to attach to the specific lwpid as valgrind is not
linked with lib pthread, so GDB cannot discover the threads
of the process).


------------------------------------------------------------------------
r15230 | philippe | 2015-05-14 20:56:47 +0100 (Thu, 14 May 2015) | 10 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_gdbserver/server.c

Implement 'qXfer:exec-file:read' packet in Valgrind gdbserver.

Thanks to this packet, with recent GDB (>= 7.9.50.20150514-cvs), the
command 'target remote' will automatically load the executable file of
the process running under Valgrind. This means you do not need to
specify the executable file yourself, GDB will discover it itself.
See GDB documentation about 'qXfer:exec-file:read' packet for more
info.


------------------------------------------------------------------------
r15229 | rhyskidd | 2015-05-14 14:03:08 +0100 (Thu, 14 May 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/memcheck/tests/filter_strchr
   M /trunk/shared/vg_replace_strmem.c

bz#347233 - Fix memcheck/tests/strchr on OS X 10.10 (Haswell)
------------------------------------------------------------------------
r15228 | carll | 2015-05-13 22:46:47 +0100 (Wed, 13 May 2015) | 14 lines
Changed paths:
   M /trunk/massif/tests/Makefile.am
   A /trunk/massif/tests/deep-D.post.exp-ppc64
   M /trunk/tests/filter_libc


Patch 2 in a revised series of cleanup patches from Will Schmidt

Add a deep-D test .exp values for ppc64.
Depending on the system and the systems endianness, there are variances
in the library reference, and to the specific line number in the library.
I was able to add and modify existing filters to cover most of the variations,
but did need to add a .exp to cover the additional call stack entry as seen
on power.
This change allows the ppc64 targets to pass the massif/deep-D test.

 
This patch fixes Vagrind bugzilla 347686

------------------------------------------------------------------------
r15227 | florian | 2015-05-13 22:26:46 +0100 (Wed, 13 May 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-common.c
   M /trunk/coregrind/m_libcfile.c
   M /trunk/include/vki/vki-scnums-tilegx-linux.h

Changes for tilegx: Use VKI_AT_FDCWD not AT_FDCWD.

------------------------------------------------------------------------
r15226 | carll | 2015-05-13 22:10:12 +0100 (Wed, 13 May 2015) | 12 lines
Changed paths:
   M /trunk/massif/tests/Makefile.am
   A /trunk/massif/tests/big-alloc.post.exp-ppc64


Patch 1 in a revised series of cleanup patches from Will Schmidt

Update the massif/big-alloc test for ppc64*.
In comparison to the existing .exp files, the time,total,extra-heap
values generated on ppc64* vary from the other architectures.

This .exp allows the ppc64 targets to pass the test.

   
This patch fixes Vagrind bugzilla 347322.

------------------------------------------------------------------------
r15222 | florian | 2015-05-13 09:11:56 +0100 (Wed, 13 May 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_redir.c

Function is_plausible_guest_addr should also consider SkShmC
segments.

------------------------------------------------------------------------
r15221 | florian | 2015-05-12 22:52:08 +0100 (Tue, 12 May 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/none/tests/linux
   M /trunk/none/tests/linux/Makefile.am
   A /trunk/none/tests/linux/mremap5.c
   A /trunk/none/tests/linux/mremap5.stderr.exp
   A /trunk/none/tests/linux/mremap5.vgtest

In functions VG_(am_relocate_nooverlap_client) and VG_(am_extend_map_client)
need to allow SkShmC segments, too.

------------------------------------------------------------------------
r15220 | florian | 2015-05-12 22:44:48 +0100 (Tue, 12 May 2015) | 2 lines
Changed paths:
   M /trunk/none/tests/linux/mremap4.c

Get prototype from system header.

------------------------------------------------------------------------
r15219 | florian | 2015-05-12 22:19:25 +0100 (Tue, 12 May 2015) | 2 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-generic.c
   M /trunk/none/tests/linux
   M /trunk/none/tests/linux/Makefile.am
   A /trunk/none/tests/linux/mremap4.c
   A /trunk/none/tests/linux/mremap4.stderr.exp
   A /trunk/none/tests/linux/mremap4.vgtest

Fix bug in do_mremap. Also need to allow SkShmC segments.

------------------------------------------------------------------------
r15217 | rhyskidd | 2015-05-12 15:25:43 +0100 (Tue, 12 May 2015) | 1 line
Changed paths:
   M /trunk/darwin14.supp

Allow suppression on OS X 10.10 in libSystem_initializer
------------------------------------------------------------------------
r15215 | philippe | 2015-05-11 22:02:00 +0100 (Mon, 11 May 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_xarray.c

Add back vg_assert(xa); that was removed by error in r15211


------------------------------------------------------------------------
r15214 | philippe | 2015-05-11 21:56:49 +0100 (Mon, 11 May 2015) | 5 lines
Changed paths:
   M /trunk/helgrind/libhb_core.c

VTS stats
* add the missing increment to the nr of gc done
* add vts pruning stat


------------------------------------------------------------------------
r15213 | philippe | 2015-05-11 21:18:10 +0100 (Mon, 11 May 2015) | 4 lines
Changed paths:
   M /trunk/helgrind/libhb_core.c

Simplify shmem__invalidate_scache_range : it only has to handle
cacheline aligned ranges.


------------------------------------------------------------------------
r15212 | philippe | 2015-05-11 20:45:08 +0100 (Mon, 11 May 2015) | 10 lines
Changed paths:
   M /trunk/helgrind/libhb_core.c

Small optimisations in libhb_core.c

* avoid indirection via function pointers to call SVal__rcinc and SVal__rcdec
* declare these functions inlined
* transform 2 asserts on hot path in conditionally compiled checks
  on CHECK_ZSM

This slightly optimises some perf tests with helgrind


------------------------------------------------------------------------
r15211 | philippe | 2015-05-11 20:41:43 +0100 (Mon, 11 May 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_xarray.c

Micro-optimisation following helgrind secmap gc
Checking the range in indexXA can be done with one comparison.


------------------------------------------------------------------------
r15210 | rhyskidd | 2015-05-11 14:24:42 +0100 (Mon, 11 May 2015) | 1 line
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c

Fix typo in task_policy_set() output. n-i-bz.
------------------------------------------------------------------------
r15209 | rhyskidd | 2015-05-11 14:19:48 +0100 (Mon, 11 May 2015) | 11 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/priv_syswrap-darwin.h
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c

OS X task_info: UNKNOWN task message [id 3405, to mach_task_self(), reply 0x........]
bz#254164

Before:

== 593 tests, 234 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 30 post failures ==

After:

== 593 tests, 233 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 30 post failures ==

------------------------------------------------------------------------
r15208 | philippe | 2015-05-10 23:40:38 +0100 (Sun, 10 May 2015) | 10 lines
Changed paths:
   M /trunk/coregrind/m_gdbserver/server.c
   M /trunk/coregrind/m_mallocfree.c

Improves the way arena statistics are shown
The mmap'd max/curr and max/curr nr of bytes will be shown e.g. as
   11,440,408/    4,508,968 
instead of
     11440656/ 4509200 

So, using more space, but more readable (in particular when the
nr exceeds the width, and so are not aligned anymore)


------------------------------------------------------------------------
r15207 | philippe | 2015-05-10 23:19:31 +0100 (Sun, 10 May 2015) | 28 lines
Changed paths:
   M /trunk/helgrind/helgrind.h
   M /trunk/helgrind/hg_main.c
   M /trunk/helgrind/libhb.h
   M /trunk/helgrind/libhb_core.c
   M /trunk/helgrind/tests
   M /trunk/helgrind/tests/Makefile.am
   A /trunk/helgrind/tests/shmem_abits.c
   A /trunk/helgrind/tests/shmem_abits.stderr.exp
   A /trunk/helgrind/tests/shmem_abits.stdout.exp
   A /trunk/helgrind/tests/shmem_abits.vgtest

This patch decreases the memory used by the helgrind SecMap,
by implementing a Garbage Collection for the SecMap.

The basic change is that freed memory is marked as noaccess
(while before, it kept the previous marking, on the basis that
non buggy applications are not accessing freed memory in any case).
Keeping the previous marking avoids the CPU/memory changes needed
to mark noaccess.

However, marking freed memory noaccess and GC the secmap reduces
the memory on big apps.
For example, a firefox test needs 220Mb less (on about 2.06 Gb).
Similar reduction for libreoffice batch (260 MB less on 1.09 Gb).
On such applications, the performance with the patch is similar to the trunk.

There is a performance decrease for applications that are doing
a lot of malloc/free repetitively: e.g. on some perf tests, an increase
in cpu of up to 15% has been observed.

Several performance optimisations can be done afterwards to not loose
too much performance. The decrease of memory is expected to produce
in any case significant benefit in memory constrained environments
(e.g. android phones).

So, after discussion with Julian, it was decided to commit as-is
and (re-)gain (part of) performance in follow-up commits.


------------------------------------------------------------------------
r15206 | philippe | 2015-05-10 19:17:38 +0100 (Sun, 10 May 2015) | 2 lines
Changed paths:
   M /trunk/README_DEVELOPERS

small refinement in the outer/inner doc

------------------------------------------------------------------------
r15205 | rhyskidd | 2015-05-10 14:34:22 +0100 (Sun, 10 May 2015) | 1 line
Changed paths:
   M /trunk/none/tests/darwin
   M /trunk/none/tests/darwin/Makefile.am
   A /trunk/none/tests/darwin/bug254164.c
   A /trunk/none/tests/darwin/bug254164.stderr.exp
   A /trunk/none/tests/darwin/bug254164.vgtest

Add (presently) failing test case for bz#254164.
------------------------------------------------------------------------
r15201 | florian | 2015-05-10 12:07:06 +0100 (Sun, 10 May 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Simplify is_valid_for taking advantage of the fact that SegKinds
are one-hot encoded.

------------------------------------------------------------------------
r15199 | rhyskidd | 2015-05-10 02:33:16 +0100 (Sun, 10 May 2015) | 1 line
Changed paths:
   M /trunk/none/tests/amd64

testsuite: properly svn:ignore output files in none/tests/amd64. n-i-bz.
------------------------------------------------------------------------
r15198 | rhyskidd | 2015-05-10 00:32:13 +0100 (Sun, 10 May 2015) | 11 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/memcheck/tests/amd64/fxsave-amd64.c

Use fxsave64 and fxrstor64 mnemonics instead of old-school rex64 prefix 
bz#339636

Before:

== 591 tests, 232 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 30 post failures ==

After:

== 591 tests, 232 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 30 post failures ==

------------------------------------------------------------------------
r15194 | philippe | 2015-05-08 22:37:18 +0100 (Fri, 08 May 2015) | 35 lines
Changed paths:
   M /trunk/coregrind/m_syscall.c

Add some cfi directives in the code doing syscall (by Valgrind).
This allows to attach to Valgrind when VAlgrind is blocked in a syscall
and have GDB producing a stacktrace, rather than being unable
to unwind.
I.e. instead of having:
  (gdb) bt
  #0  0x380460f2 in do_syscall_WRK ()
  (gdb) 
with the directives, we obtain:
   (gdb) bt
   #0  vgPlain_mk_SysRes_x86_linux (val=1) at m_syscall.c:65
   #1  vgPlain_do_syscall (sysno=168, a1=944907996, a2=1, a3=4294967295, a4=0, a5=0, a6=0, a7=0, a8=0) at m_syscall.c:791
   #2  0x38031986 in vgPlain_poll (fds=0x385226dc <remote_desc_pollfdread_activity>, nfds=1, timeout=-1) at m_libcfile.c:535
   #3  0x3807479f in vgPlain_poll_no_eintr (fds=0x385226dc <remote_desc_pollfdread_activity>, nfds=1, timeout=-1)
       at m_gdbserver/remote-utils.c:86
   #4  0x380752f0 in readchar (single=4096) at m_gdbserver/remote-utils.c:938
   #5  0x38075ae3 in getpkt (buf=0x61f35020 "") at m_gdbserver/remote-utils.c:997
   #6  0x38076fcb in server_main () at m_gdbserver/server.c:1048
   #7  0x38072af2 in call_gdbserver (tid=1, reason=init_reason) at m_gdbserver/m_gdbserver.c:721
   #8  0x380735ba in vgPlain_gdbserver (tid=1) at m_gdbserver/m_gdbserver.c:788
   #9  0x3802c6ef in do_actions_on_error (allow_db_attach=<optimized out>, err=<optimized out>) at m_errormgr.c:532
   #10 pp_Error (err=0x61f580e0, allow_db_attach=1 '\001', xml=1 '\001') at m_errormgr.c:644
   #11 0x3802cc34 in vgPlain_maybe_record_error (tid=1643479264, ekind=8, a=2271560481, s=0x0, extra=0x62937f1c)
       at m_errormgr.c:851
   #12 0x38028821 in vgMemCheck_record_free_error (tid=1, a=2271560481) at mc_errors.c:836
   #13 0x38007b65 in vgMemCheck_free (tid=1, p=0x87654321) at mc_malloc_wrappers.c:496
   #14 0x3807e261 in do_client_request (tid=1) at m_scheduler/scheduler.c:1840
   #15 vgPlain_scheduler (tid=1) at m_scheduler/scheduler.c:1406
   #16 0x3808b6b2 in thread_wrapper (tidW=<optimized out>) at m_syswrap/syswrap-linux.c:102
   #17 run_a_thread_NORETURN (tidW=1) at m_syswrap/syswrap-linux.c:155
   #18 0x00000000 in ?? ()
   (gdb) 



------------------------------------------------------------------------
r15193 | sewardj | 2015-05-08 10:52:42 +0100 (Fri, 08 May 2015) | 2 lines
Changed paths:
   M /trunk/docs/internals/3_10_BUGSTATUS.txt

Update.

------------------------------------------------------------------------
r15192 | tom | 2015-05-07 19:54:51 +0100 (Thu, 07 May 2015) | 2 lines
Changed paths:
   M /trunk/NEWS

Document fix for BZ#347389.

------------------------------------------------------------------------
r15191 | tom | 2015-05-07 19:54:31 +0100 (Thu, 07 May 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/priv_syswrap-linux.h
   M /trunk/coregrind/m_syswrap/syswrap-amd64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-arm-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-arm64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-mips32-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-mips64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-ppc32-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-ppc64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-s390x-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-x86-linux.c

Add support for the syncfs system call.

Based on patch from j@eckel.me on BZ#347389.

------------------------------------------------------------------------
r15190 | rhyskidd | 2015-05-07 14:17:50 +0100 (Thu, 07 May 2015) | 12 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/darwin12.supp

valgrind --leak-check=full memleak errors from system libraries on OS X 10.8
bz#347379
== bz#217236

Before:

== 591 tests, 237 stderr failures, 23 stdout failures, 0 stderrB failures, 0 stdoutB failures, 30 post failures ==

After:

== 591 tests, 232 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 30 post failures ==

------------------------------------------------------------------------
r15189 | philippe | 2015-05-06 22:24:23 +0100 (Wed, 06 May 2015) | 2 lines
Changed paths:
   M /trunk/perf/memrw.c

Compute total size with unsigned long long

------------------------------------------------------------------------
r15188 | carll | 2015-05-06 22:11:35 +0100 (Wed, 06 May 2015) | 10 lines
Changed paths:
   M /trunk/none/tests/ppc32/jm_vec_isa_2_07.vgtest
   A /trunk/tests/check_ppc64le_cap


Patch 8 in a series of cleanup patches from Will Schmidt

Add a helper script to determine if the platform is ppc64le.
This is specifically used to help exclude the 32-bit tests from being
run on a ppc64LE (ABIV2)  platform.  The 32-bit targets, specifically ppc32/*
is not built on LE.
   
This patch fixes Vagrind bugzilla 347322.

------------------------------------------------------------------------
r15187 | philippe | 2015-05-06 21:50:17 +0100 (Wed, 06 May 2015) | 2 lines
Changed paths:
   M /trunk/none/tests/x86/int.disabled

Fix also the rm vgcore of a disabled test (also spotted by  Matthias Schwarzott)

------------------------------------------------------------------------
r15186 | philippe | 2015-05-06 21:16:34 +0100 (Wed, 06 May 2015) | 3 lines
Changed paths:
   M /trunk/memcheck/tests/badjump.vgtest
   M /trunk/memcheck/tests/supp_unknown.vgtest

Fix incorrect cleanup lines in 2 tests (spotted by  Matthias Schwarzott)


------------------------------------------------------------------------
r15185 | carll | 2015-05-06 21:16:04 +0100 (Wed, 06 May 2015) | 8 lines
Changed paths:
   M /trunk/drd/tests/pth_create_chain.vgtest


Patch 3 in a series of cleanup patches from Will Schmidt

Update the pth_create_chain vgtest prereq to handle the ppc64le architecture
in the same way as ppc64 (BE).
   
This patch fixes Vagrind bugzilla 347322.

------------------------------------------------------------------------
r15184 | carll | 2015-05-06 20:44:14 +0100 (Wed, 06 May 2015) | 9 lines
Changed paths:
   M /trunk/memcheck/tests/badjump2.c


Patch 2 in a series of cleanup patches from Will Schmidt

Adjust the badjump2 test for ppc64le/ABIV2. Under the ABIV2 there
is no function descriptor, so the fn[] setup does not apply.
This fixes the badjump2 test failure as seen on ppc64le.
   
This patch fixes Vagrind bugzilla 347322.

------------------------------------------------------------------------
r15183 | carll | 2015-05-06 20:18:28 +0100 (Wed, 06 May 2015) | 11 lines
Changed paths:
   M /trunk/coregrind/m_stacktrace.c


Patch 1 in a series of cleanup patches from Will Schmidt

Update ifdefs around the bogus-LR-value-handling code to allow ppc64le to
behave as ppc64 (BE) does.

This fixes the overlap test case, where the stack unwinding code was
otherwise coming up with bad instruction pointers.
    
This patch fixes Vagrind bugzilla 347322.

------------------------------------------------------------------------
r15181 | florian | 2015-05-05 07:14:10 +0100 (Tue, 05 May 2015) | 40 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-generic.c

Simplify. The condition on line 1223 is always true.
Here's why:

The condition

 if (VG_(brk_limit) > VG_(brk_base))   line 1223

is reachable iff 

  newbrk < VG_(brk_base)  on line 1201  is false  AND
  newbrk < VG_(brk_limit) on line 1205  is true

Rewrite as

  newbrk >= VG_(brk_base)    is true  AND
  newbrk <  VG_(brk_limit)   is true

Rewrite as

  newbrk >= VG_(brk_base)        is true  AND
  newbrk <= VG_(brk_limit) - 1   is true

Combine

  VG_(brk_base) <= newbrk <= VG_(brk_limit) - 1

Therefore

  VG_(brk_base) <= VG_(brk_limit) - 1

Or

  VG_(brk_base) < VG_(brk_limit)

Which is the same as

  VG_(brk_limit) > VG_(brk_base)

qed.

------------------------------------------------------------------------
r15180 | philippe | 2015-05-04 21:00:49 +0100 (Mon, 04 May 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_gdbserver/server.c

One more msg to use 'mmap-ed ANONYMOUS' wording

------------------------------------------------------------------------
r15179 | rhyskidd | 2015-05-04 13:46:44 +0100 (Mon, 04 May 2015) | 11 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/darwin12.supp

Fix suppression for pthread_rwlock_init on OS X 10.8
bz#347151

Before:

== 593 tests, 238 stderr failures, 23 stdout failures, 0 stderrB failures, 0 stdoutB failures, 30 post failures ==

After:

== 593 tests, 237 stderr failures, 23 stdout failures, 0 stderrB failures, 0 stdoutB failures, 30 post failures ==

------------------------------------------------------------------------
r15178 | sewardj | 2015-05-04 09:40:11 +0100 (Mon, 04 May 2015) | 3 lines
Changed paths:
   M /trunk/docs/Makefile.am
   D /trunk/docs/internals/aarch64-linux-on-qemu-HOWTO.txt
   A /trunk/docs/internals/qemu-aarch64-linux-HOWTO.txt (from /trunk/docs/internals/aarch64-linux-on-qemu-HOWTO.txt:15159)
   A /trunk/docs/internals/qemu-mips64-linux-HOWTO.txt

Add a new howto for running mips64-linux on QEMU.
Rename the aarch64-linux howto accordingly.

------------------------------------------------------------------------
r15177 | philippe | 2015-05-03 22:48:13 +0100 (Sun, 03 May 2015) | 6 lines
Changed paths:
   M /trunk/coregrind/m_gdbserver/server.c
   M /trunk/coregrind/m_mallocfree.c

* Out of memory message was using  'bytes have already been allocated.'
  while this nr is in fact the total anonymously mmap-ed.
  Change the message so as to reflect the shown number.
* Show also the total anonymous mmaped in non OOM memory statistics


------------------------------------------------------------------------
r15176 | philippe | 2015-05-03 11:56:16 +0100 (Sun, 03 May 2015) | 2 lines
Changed paths:
   M /trunk/helgrind/hg_main.c

Reduce nr of lines produced by laog gc --stats=yes

------------------------------------------------------------------------
r15175 | rhyskidd | 2015-05-02 05:23:46 +0100 (Sat, 02 May 2015) | 1 line
Changed paths:
   M /trunk/exp-bbv/tests/Makefile.am
   M /trunk/exp-bbv/tests/x86/complex_rep.vgtest
   M /trunk/exp-bbv/tests/x86/fldcw_check.vgtest
   M /trunk/exp-bbv/tests/x86/million.vgtest
   M /trunk/exp-bbv/tests/x86/rep_prefix.vgtest

Properly guard exp-bbv/tests/x86/ on OS X. Partial fix for BZ#344416 (at least reduces required hacks).
------------------------------------------------------------------------
r15174 | philippe | 2015-05-01 18:12:00 +0100 (Fri, 01 May 2015) | 9 lines
Changed paths:
   M /trunk/helgrind/libhb_core.c
   M /trunk/perf/memrw.c

This patch reduces the memory needed for a VtsTE by 25% (one word)
on 32 bits platforms. No memory reduction on 64 bits platforms,
due to alignment.
The patch also shows the vts stats when showing the helgrind stats.

The perf/memrw.c perf test gets also some new additional features
allowing e.g. to control the size of the read or written blocks.


------------------------------------------------------------------------
r15173 | philippe | 2015-05-01 17:46:38 +0100 (Fri, 01 May 2015) | 28 lines
Changed paths:
   M /trunk/coregrind/m_transtab.c
   M /trunk/coregrind/m_xarray.c
   M /trunk/include/pub_tool_xarray.h
   M /trunk/memcheck/mc_translate.c

This patch adds a function that allows to directly properly size an xarray
when the size is known in advance.

3 places identified where this function can be used trivially.

The result is a reduction of 'realloc' operations in core
arena, and a small reduction in ttaux arena
(it is the nr of operations that decreases, the memory usage itself
stays the same (ignoring some 'rounding' effects).

E.g. for perf/bigcode 0, we change from
  core 1085742/ 216745904 totalloc-blocks/bytes,     1085733 searches
  ttaux 5348/   6732560 totalloc-blocks/bytes,        5326 searches
to
  core 712666/ 190998592 totalloc-blocks/bytes,      712657 searches
  ttaux 5319/   6731808 totalloc-blocks/bytes,        5296 searches

For bz2, we switch from
  core 50285/  32383664 totalloc-blocks/bytes,       50256 searches
  ttaux 670/    245160 totalloc-blocks/bytes,         669 searches
to
  core 32564/  29971984 totalloc-blocks/bytes,       32535 searches
  ttaux 605/    243280 totalloc-blocks/bytes,         604 searches

Performance wise, on amd64, this improves memcheck performance
on perf tests by 0.0, 0.1 or 0.2 seconds depending on the test.


------------------------------------------------------------------------
r15172 | rhyskidd | 2015-05-01 11:19:22 +0100 (Fri, 01 May 2015) | 1 line
Changed paths:
   M /trunk/drd/tests/Makefile.am

Properly guard drd/tests/thread_name with HAVE_PTHREAD_BARRIER. Partial fix for BZ#344416 (at least reduces required hacks).
------------------------------------------------------------------------
r15171 | rhyskidd | 2015-05-01 07:29:51 +0100 (Fri, 01 May 2015) | 13 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Fix aspacem segment mismatch: seen with none/tests/bigcode
bz#345824

Tested on OS X 10.9 and OS X 10.10.

Before:

== 595 tests, 237 stderr failures, 23 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

After:

== 595 tests, 236 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

------------------------------------------------------------------------
r15170 | rhyskidd | 2015-05-01 00:39:10 +0100 (Fri, 01 May 2015) | 1 line
Changed paths:
   M /trunk/none/tests/libvex_test.c

Fix regression test compile issue on OS X platform, introduced in r15113. n-i-bz
------------------------------------------------------------------------
r15169 | florian | 2015-04-30 21:44:17 +0100 (Thu, 30 Apr 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_coredump/coredump-elf.c
   M /trunk/coregrind/m_coredump/coredump-macho.c
   M /trunk/coregrind/m_debugger.c
   M /trunk/coregrind/m_debuginfo/debuginfo.c
   M /trunk/coregrind/m_errormgr.c
   M /trunk/coregrind/m_execontext.c
   M /trunk/coregrind/m_gdbserver/m_gdbserver.c
   M /trunk/coregrind/m_gdbserver/server.h
   M /trunk/coregrind/m_initimg/initimg-darwin.c
   M /trunk/coregrind/m_initimg/initimg-linux.c
   M /trunk/coregrind/m_libcassert.c
   M /trunk/coregrind/m_machine.c
   M /trunk/coregrind/m_main.c
   M /trunk/coregrind/m_mallocfree.c
   M /trunk/coregrind/m_scheduler/scheduler.c
   M /trunk/coregrind/m_sigframe/sigframe-amd64-darwin.c
   M /trunk/coregrind/m_sigframe/sigframe-amd64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-arm-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-arm64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-mips32-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-mips64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-ppc32-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-ppc64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-s390x-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-tilegx-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-x86-darwin.c
   M /trunk/coregrind/m_sigframe/sigframe-x86-linux.c
   M /trunk/coregrind/m_signals.c
   M /trunk/coregrind/m_stacktrace.c
   M /trunk/coregrind/m_threadstate.c
   M /trunk/coregrind/m_translate.c

Remove a few embarassing comments.

------------------------------------------------------------------------
r15167 | philippe | 2015-04-30 21:30:12 +0100 (Thu, 30 Apr 2015) | 5 lines
Changed paths:
   M /trunk/perf/memrw.c

Rename write variable to avoid a warning:
memrw.c:37: warning: declaration of ‘write’ shadows a global declaration
/usr/include/unistd.h:333: warning: shadowed declaration is here


------------------------------------------------------------------------
r15165 | florian | 2015-04-30 18:34:04 +0100 (Thu, 30 Apr 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/coregrind/m_aspacemgr/aspacemgr-segnames.c
   M /trunk/coregrind/m_aspacemgr/priv_aspacemgr.h

Fix the namespace of the functions dealing with segment names.
As those are private to the address space manager they should
be ML_ not VG_ prefixed.

------------------------------------------------------------------------
r15160 | sewardj | 2015-04-30 12:45:13 +0100 (Thu, 30 Apr 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/readdwarf.c

DW_CFA_def_cfa_expression: don't push the CFA on the stack before
evaluation starts.  For DW_CFA_val_expression and DW_CFA_expression
doing so is correct, but not for DW_CFA_def_cfa_expression.

------------------------------------------------------------------------
r15159 | sewardj | 2015-04-30 12:06:00 +0100 (Thu, 30 Apr 2015) | 3 lines
Changed paths:
   M /trunk/docs/Makefile.am
   A /trunk/docs/internals/aarch64-linux-on-qemu-HOWTO.txt

Add a HOWTO on how to build and install aarch64-linux on QEMU,
primarily for testing convenience.

------------------------------------------------------------------------
r15157 | sewardj | 2015-04-29 21:48:48 +0100 (Wed, 29 Apr 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syscall-arm64-linux.S

Fix intermittent build error on aarch64-linux caused by inadequate
alignment for some data symbols.

------------------------------------------------------------------------
r15155 | florian | 2015-04-29 13:59:16 +0100 (Wed, 29 Apr 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-generic.c
   M /trunk/memcheck/tests/linux/brk.stderr.exp
   M /trunk/none/tests/linux
   M /trunk/none/tests/linux/Makefile.am
   A /trunk/none/tests/linux/brk-overflow1.c
   A /trunk/none/tests/linux/brk-overflow1.stderr.exp
   A /trunk/none/tests/linux/brk-overflow1.vgtest
   A /trunk/none/tests/linux/brk-overflow2.c
   A /trunk/none/tests/linux/brk-overflow2.stderr.exp
   A /trunk/none/tests/linux/brk-overflow2.vgtest

Issue an error message if then brk segment overflows.

------------------------------------------------------------------------
r15153 | florian | 2015-04-28 19:46:33 +0100 (Tue, 28 Apr 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_initimg/initimg-linux.c

Use error exit code when bailing out.

------------------------------------------------------------------------
r15151 | sewardj | 2015-04-28 12:49:05 +0100 (Tue, 28 Apr 2015) | 2 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/docs/internals/3_10_BUGSTATUS.txt

Update.

------------------------------------------------------------------------
r15150 | florian | 2015-04-27 22:10:36 +0100 (Mon, 27 Apr 2015) | 5 lines
Changed paths:
   M /trunk/NEWS

Back out most of r15145 which reports bug fixes for various altivec insns.
Either those bugs have been fixed looong time ago, or the reporter ran 
on a host without altivec capabilities, or those insns were actually
e500 insns which are not supported at all at this point.

------------------------------------------------------------------------
r15149 | florian | 2015-04-27 18:28:15 +0100 (Mon, 27 Apr 2015) | 3 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_sigframe/sigframe-common.c

Fix fallout from r15138: build error on Darwin due to renamed function.
Fixes BZ #346801.

------------------------------------------------------------------------
r15148 | florian | 2015-04-27 15:28:28 +0100 (Mon, 27 Apr 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_initimg/initimg-linux.c

Remove magic constant. Use LibVEX_GUEST_STATE_ALIGN instead.

------------------------------------------------------------------------
r15147 | florian | 2015-04-27 15:26:26 +0100 (Mon, 27 Apr 2015) | 5 lines
Changed paths:
   M /trunk/coregrind/m_initimg/initimg-linux.c

Follow up on VEX r3144 and remove VexGuestTILEGXStateAlignment.
Also fix the alignment check which should be mod 16 not mod 8.
Well, actually, it should be mod LibVEX_GUEST_STATE_ALIGN but
that is another patch.

------------------------------------------------------------------------
r15146 | florian | 2015-04-27 15:04:52 +0100 (Mon, 27 Apr 2015) | 2 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/launcher-linux.c

Fix an outdated comment as pointed out in BZ #211256.

------------------------------------------------------------------------
r15145 | florian | 2015-04-26 20:23:56 +0100 (Sun, 26 Apr 2015) | 2 lines
Changed paths:
   M /trunk/NEWS

Update. Mostly ppc insns that appear to have been fixed

------------------------------------------------------------------------
r15144 | florian | 2015-04-25 19:23:21 +0100 (Sat, 25 Apr 2015) | 8 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_initimg/initimg-linux.c
   M /trunk/memcheck/tests/dw4.stderr.exp

Fix BZ #342683. Based on patch by Ivo Raisr.
What this does is to make sure that the initial client data segment
is marked as unaddressable. This is consistent with the behaviour of
brk when the data segment is shrunk. The "freed" memory is marked
as unaddressable.
Special tweaks were needed for s390 which was returning early from
the funtion to avoid sloppy register definedness initialisation.

------------------------------------------------------------------------
r15143 | florian | 2015-04-25 19:14:17 +0100 (Sat, 25 Apr 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-generic.c
   M /trunk/memcheck/tests/writev1.c
   M /trunk/memcheck/tests/writev1.stderr.exp

Fix the writev / readv wrappers. Do not read the array pointed to
by the 2nd argument, if the element count is negative.

------------------------------------------------------------------------
r15142 | philippe | 2015-04-25 15:53:35 +0100 (Sat, 25 Apr 2015) | 6 lines
Changed paths:
   M /trunk/coregrind/m_deduppoolalloc.c

Replace adler32 by sdbm_hash in m_deduppoolalloc.c
adler32 is not very good as a hash function.
sdbm_hash gives more different keys that adler32,
and in a large majority of the cases, shorter chains.


------------------------------------------------------------------------
r15141 | philippe | 2015-04-25 15:00:24 +0100 (Sat, 25 Apr 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_hashtable.c
   M /trunk/helgrind/libhb_core.c

Give statistics about RCEC helgrind hash table chains.
Improve statistic in coregrind hash table

------------------------------------------------------------------------
r15140 | florian | 2015-04-24 11:05:23 +0100 (Fri, 24 Apr 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-generic.c

Check for any client stack segment. Rule out valgrind segments.

------------------------------------------------------------------------
r15139 | philippe | 2015-04-23 22:28:12 +0100 (Thu, 23 Apr 2015) | 3 lines
Changed paths:
   M /trunk/README_DEVELOPERS_processes
   A /trunk/docs/internals/svn-HOWTO.txt

Add some internal documentation for 'svn ignore' maintenance;
reference it from README_DEVELOPERS_processes

------------------------------------------------------------------------
r15138 | florian | 2015-04-23 16:20:00 +0100 (Thu, 23 Apr 2015) | 19 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/configure.ac
   M /trunk/coregrind/m_sigframe/priv_sigframe.h
   M /trunk/coregrind/m_sigframe/sigframe-amd64-darwin.c
   M /trunk/coregrind/m_sigframe/sigframe-amd64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-arm-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-arm64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-common.c
   M /trunk/coregrind/m_sigframe/sigframe-mips32-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-mips64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-ppc32-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-ppc64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-s390x-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-tilegx-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-x86-darwin.c
   M /trunk/coregrind/m_sigframe/sigframe-x86-linux.c
   M /trunk/coregrind/m_signals.c
   M /trunk/none/tests/Makefile.am
   A /trunk/none/tests/amd64-linux
   A /trunk/none/tests/amd64-linux/Makefile.am
   A /trunk/none/tests/amd64-linux/bug345887.c
   A /trunk/none/tests/amd64-linux/bug345887.stderr.exp
   A /trunk/none/tests/amd64-linux/bug345887.vgtest
   A /trunk/none/tests/amd64-linux/filter_minimal
   A /trunk/none/tests/amd64-linux/filter_stderr
   M /trunk/none/tests/linux
   M /trunk/none/tests/linux/Makefile.am
   A /trunk/none/tests/linux/pthread-stack.c
   A /trunk/none/tests/linux/pthread-stack.stderr.exp
   A /trunk/none/tests/linux/pthread-stack.vgtest
   M /trunk/none/tests/x86-linux
   M /trunk/none/tests/x86-linux/Makefile.am
   A /trunk/none/tests/x86-linux/bug345887.c
   A /trunk/none/tests/x86-linux/bug345887.stderr.exp
   A /trunk/none/tests/x86-linux/bug345887.vgtest
   A /trunk/none/tests/x86-linux/filter_minimal

Fix an assertion in the address space manager. BZ #345887.
The VG_(extend_stack) call needs to be properly guarded because the
passed-in address is not necessarily part of an extensible stack
segment. And an extensible stack segment is the only thing that
function should have to deal with.
Previously, the function VG_(am_addr_is_in_extensible_client_stack)
was introduced to guard VG_(extend_stack) but it was not added in all
places it should have been.

Also, extending the client stack during signal delivery (in sigframe-common.c)
was simply calling VG_(extend_stack) hoping it would do the right thing.
But that was not always the case. The new testcase 
none/tests/linux/pthread-stack.c exercises this (3.10.1 errors out on it).

Renamed ML_(sf_extend_stack) to ML_(sf_maybe_extend_stack) and add
proper guard logic for VG_(extend_stack).

Testcases none/tests/{amd64|x86}-linux/bug345887.c by Ivo Raisr.

------------------------------------------------------------------------
r15137 | florian | 2015-04-23 14:17:20 +0100 (Thu, 23 Apr 2015) | 2 lines
Changed paths:
   M /trunk/perf

Update list of ignored files.

------------------------------------------------------------------------
r15136 | carll | 2015-04-22 22:17:48 +0100 (Wed, 22 Apr 2015) | 7 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/none/tests/ppc32/test_dfp4.c
   M /trunk/none/tests/ppc32/test_dfp5.c

There is an ABI change in how the PPC64 gcc compiler handles 128 bit arguments
are aligned with GCC 5.0.  The compiler generates a "note" about this starting
with GCC 4.9.  To avoid generating the "note", the passing of the arguments
were changed to a pointer to make it pass by reference rather then pass by 
value.

bugzilla 346487.
------------------------------------------------------------------------
r15135 | carll | 2015-04-22 17:28:22 +0100 (Wed, 22 Apr 2015) | 1 line
Changed paths:
   M /trunk/NEWS

Update NEWS file with bix for bugzilla 346474.
------------------------------------------------------------------------
r15134 | carll | 2015-04-22 17:17:06 +0100 (Wed, 22 Apr 2015) | 16 lines
Changed paths:
   M /trunk/memcheck/mc_main.c

Add support for the TEXASRU register.  This register contains information on
transactional memory instruction summary information.  This register contains
the upper 32-bits of the transaction information.  Note, the valgrind
implementation of transactional memory instructions is limited.  Currently, the
contents of the TEXASRU register will always return 0.  The lower 64-bits of
the trasnaction information in the TEXASR register will contain the failure
information as setup by Valgrind.

The vex commit 3143 contains the changes needed to support the TEXASRU
register on PPC64.

The support requires changing the value of MAX_REG_WRITE_SIZE in
memcheck/mc_main.c from 1696 to 1712.  The change is made in this
valgrind commit.

This patch addresses Bugzilla 346474
------------------------------------------------------------------------
r15133 | mjw | 2015-04-22 16:29:03 +0100 (Wed, 22 Apr 2015) | 3 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-ppc64-linux.c

Enable rt_sigpending syscall on ppc64 linux.

Patch from Thomas Huth <thuth@redhat.com>
------------------------------------------------------------------------
r15132 | florian | 2015-04-22 15:16:11 +0100 (Wed, 22 Apr 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-main.c
   M /trunk/coregrind/pub_core_aspacemgr.h

Rename VG_(am_is_bogus_client_stack_pointer) to 
VG_(am_addr_is_in_extensible_client_stack).

------------------------------------------------------------------------
r15131 | florian | 2015-04-22 14:50:13 +0100 (Wed, 22 Apr 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Fix a silly bug.

------------------------------------------------------------------------
r15130 | bart | 2015-04-22 09:07:35 +0100 (Wed, 22 Apr 2015) | 1 line
Changed paths:
   M /trunk/NEWS

NEWS: Add entry for bug #346416 / trunk r15123
------------------------------------------------------------------------
r15129 | philippe | 2015-04-21 23:04:55 +0100 (Tue, 21 Apr 2015) | 4 lines
Changed paths:
   M /trunk/NEWS

Announce in NEWS the optimisation done for helgrind big applications
full history level


------------------------------------------------------------------------
r15128 | philippe | 2015-04-21 22:58:14 +0100 (Tue, 21 Apr 2015) | 6 lines
Changed paths:
   M /trunk/helgrind/hg_main.c
   M /trunk/helgrind/libhb_core.c

Add some stats to helgrind stats:
* nr of client malloc-ed blocks
* how many OldRef helgrind has, and the distribution
  of these OldRef according to the nr of accs they have
 

------------------------------------------------------------------------
r15127 | philippe | 2015-04-21 21:56:49 +0100 (Tue, 21 Apr 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_libcprint.c
   M /trunk/include/pub_tool_libcprint.h

Move a comment useful to the caller to the .h, rather than keeping it
in the .c


------------------------------------------------------------------------
r15126 | philippe | 2015-04-21 21:55:40 +0100 (Tue, 21 Apr 2015) | 9 lines
Changed paths:
   M /trunk/helgrind/libhb_core.c

Do RCEC_GC when approaching the max nr of RCEC, not when reaching it.
Otherwise, long running applications still see the max nr of RCEC
slowly growing, which increases the memory usage and
makes the (fixed) contextTab hash table slower to search.
Without this margin, the max could increase as the GC code
is not called at exactly the moment we reach the previous max,
but rather when a thread has run a bunch of basic blocks.


------------------------------------------------------------------------
r15125 | carll | 2015-04-21 21:13:27 +0100 (Tue, 21 Apr 2015) | 2 lines
Changed paths:
   M /trunk/NEWS

Update the NEWS file with the fixes for bugzillas 345695, 346267, and 346324.

------------------------------------------------------------------------
r15124 | carll | 2015-04-21 21:06:13 +0100 (Tue, 21 Apr 2015) | 5 lines
Changed paths:
   M /trunk/none/tests/ppc64/jm_int_isa_2_07.stdout.exp

Update the expected output file none/tests/ppc64/jm_int_isa_2_07.stdout.exp
for PPC64 big endian.



------------------------------------------------------------------------
r15123 | bart | 2015-04-21 18:46:52 +0100 (Tue, 21 Apr 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-linux.c
   M /trunk/include/vki/vki-linux.h

Add support for LL_IOC_PATH2FID and LL_IOC_GETPARENT Lustre ioctls

From: Frank Zago <fzago@cray.com>

------------------------------------------------------------------------
r15121 | cborntra | 2015-04-21 13:27:09 +0100 (Tue, 21 Apr 2015) | 6 lines
Changed paths:
   M /trunk/perf/bigcode.c

increase function size even more (see r15095). On s390 this testcase
might use a relative load (e.g. via load address relative long(larl)
for the address) into the literal pool for some constants. 1280 seems
to be enough that the r/o data is copied along the function.


------------------------------------------------------------------------
r15120 | carll | 2015-04-21 00:38:33 +0100 (Tue, 21 Apr 2015) | 11 lines
Changed paths:
   M /trunk/memcheck/tests/ppc32/Makefile.am
   D /trunk/memcheck/tests/ppc32/power_ISA2_07.stdout.exp-LE
   M /trunk/none/tests/ppc32/Makefile.am
   M /trunk/none/tests/ppc64/jm_int_isa_2_07.stdout.exp
   A /trunk/none/tests/ppc64/jm_int_isa_2_07.stdout.exp-LE

Add support for the lbarx, lharx, stbcx and sthcs instructions.

One of the expect files was missing.  Also found that there 
was a bug in the stq, stqcx, lq and lqarx instructions for LE.
The VEX commit for the instruction fix was 3138.

This commit updates the expect files for the corrected instructions
and adds the missing expect files.

The bugzilla for the orginal issue of the missing instructions
is 346324.
------------------------------------------------------------------------
r15119 | philippe | 2015-04-20 22:33:16 +0100 (Mon, 20 Apr 2015) | 93 lines
Changed paths:
   M /trunk/helgrind/libhb_core.c
   M /trunk/perf/Makefile.am
   A /trunk/perf/memrw.c
   A /trunk/perf/memrw.vgperf

This patch changes the policy that does the GC of OldRef and RCEC
conflict cache size.

The current policy is:
A 'more or less' LRU policy is implemented by giving
to each OldRef a generation nr in which it was last touched.
A new generation is created every 50000 new access.
GC is done when the nr of OldRef reaches --conflict-cache-size.
The GC consists in removing enough generations to free 
half of the entries.
After GC of OldRef, the RCEC (Ref Counted Exe Contexts)
not referenced anymore are GC-ed.

The new policy is:
An exact LRU policy is implemented using a doubly linked list
of OldRef.
When reaching --conflict-cache-size, the LRU entry is re-used.

The not referenced RCEC are GC-ed when less than 75% of the RCEC
are referenced, and the nr of RCEC is 'big' (at least half the
size of the contextTab, and at least the max nr of RCEC reached
previously).
  (note: tried to directly recover a unref'ed RCEC when recovering
   the LRU oldref, but that gives a lot of re-creation of RCEC).

new policy has the following advantages/disadvantages:
1. It is faster (at least for big applications)
  On a firefox startup/exit, we gain about 1m30 second on 11m.
  Similar 5..10% speed up encountered on other big applications
  or on the new perf/memrw test.
  The speed increase depends on the amount of memory
  touched by the application. For applications with a
  working set fitting in conflict-cache-size, the new policy
  might be marginally slower than previous policy on platforms
  having a small cache : the current policy only sets a generation
  nr when an address is re-accessed, while the new policy
  has to unchain and rechain the OldRef access in the LRU
  doubly linked list.
2. It uses less memory (at least for big applications)
   Firefox startup/exit "core" arena max use decreases from
     1175MB mmap-ed/1060MB alloc-ed
   to
     994MB mmap-ed/913MB alloc-ed

   The decrease in memory is the result of having a lot less RCEC:
   The current policy let the nr of RCEC grow till the conflict
   cache size is GC-ed.

   The new policy limits the nr of RCEC to 133% of the RCEC
   really referenced. So, we end up with a max nr of RCEC
   a lot smaller with the new policy : max RCEC 191000
   versus 1317000, for a total nr of discard RCEC operations
   almost the same: 33M versus 32M. 
   Also, the current policy allocates a big temporary array
   to do the GC of OldRef.

   With the new policy, size of an OldRef increases because
   we need 2 pointers for the LRU doubly linked list, and
   we need the accessed address.
   In total, the OldRef increase is limited to one Word,
   as we do not need anymore the gen, and the 'magic' 
   for sanity check was removed (the check somewhat
   becomes less needed, because an OldRef is never freed
   anymore. Also, we do a new cross-check between
   the ga in the OldRef and the sparseWA key).

   For applications using small memory and having
   a small nr of different stack traces accessing memory,
   the new policy causes an increase in memory (one Word
   per OldRef).

3. Functionally, the new policy gives better past information:
   once the steady state is reached (i.e. the conflict cache
   is full), the new policy has always --conflict-cache-size
   entries of past information.
   The current policy has a nr of past information varying
   between --conflict-cache-size/2 and --conflict-cache-size
   (so in average, 75% of conflict-cache-size).

4. The new code is a little bit smaller/simpler:
   The generation based GC is replaced by a simpler LRU policy.


So, in summary, this patch should allow big applications
to use less cpu/memory, while having very little
or no impact on memory/cpu of small applications.

Note that the OldRef data structure LRU policy
is not really explicitely tested by a regtest.
Not easy at first sight to make such a test portable
between platforms/OS/compilers/....


------------------------------------------------------------------------
r15118 | florian | 2015-04-20 22:13:03 +0100 (Mon, 20 Apr 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_signals.c

Use the proper function.

------------------------------------------------------------------------
r15117 | florian | 2015-04-20 22:02:18 +0100 (Mon, 20 Apr 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_syscall.c
   M /trunk/include/pub_tool_basics.h

Remove SysRes::_valEx from common code as it is specific to mips.
ifdef'ed accordingly.

------------------------------------------------------------------------
r15116 | florian | 2015-04-20 21:42:42 +0100 (Mon, 20 Apr 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_libcprint.c
   M /trunk/coregrind/m_syswrap/priv_types_n_macros.h
   M /trunk/coregrind/m_syswrap/syswrap-main.c
   M /trunk/include/pub_tool_basics.h
   M /trunk/include/pub_tool_libcprint.h

Remove function sr_ResHI from Linux specific code.
Add function VG_(sr_as_string).

------------------------------------------------------------------------
r15115 | florian | 2015-04-20 18:00:02 +0100 (Mon, 20 Apr 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-tilegx-linux.c

Update tilegx's do_clone function adopting the stack bound changes
made in r14392.

------------------------------------------------------------------------
r15114 | philippe | 2015-04-19 18:56:42 +0100 (Sun, 19 Apr 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_main.c

Ensure we print the memory statistics with the default verbosity,
when giving --stats=yes

------------------------------------------------------------------------
r15113 | philippe | 2015-04-19 16:43:53 +0100 (Sun, 19 Apr 2015) | 9 lines
Changed paths:
   M /trunk/none/tests/libvex_test.c

For ppc64, use the endianess of the running program, rather
than an harcoded endness.
(this is because ppc64 supports 2 endness, decided at runtime)

For mips, use BE if running on a non mips system, otherwise
use the endness of the running program
(this is because mips supports 2 endness, but decided at compile time).


------------------------------------------------------------------------
r15112 | philippe | 2015-04-19 13:39:33 +0100 (Sun, 19 Apr 2015) | 6 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-generic.c

fix 346307  fuse filesystem syscall deadlocks
Mark 2 additional syscalls as 'mayblock' when fuse-compatible hint
is given.
Patch from aozgovde@ralota.com


------------------------------------------------------------------------
r15111 | florian | 2015-04-18 18:45:34 +0100 (Sat, 18 Apr 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-amd64-darwin.c
   M /trunk/coregrind/m_syswrap/syswrap-amd64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-arm-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-arm64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c
   M /trunk/coregrind/m_syswrap/syswrap-generic.c
   M /trunk/coregrind/m_syswrap/syswrap-linux-variants.c
   M /trunk/coregrind/m_syswrap/syswrap-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-main.c
   M /trunk/coregrind/m_syswrap/syswrap-mips32-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-mips64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-ppc32-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-ppc64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-s390x-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-tilegx-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-x86-darwin.c
   M /trunk/coregrind/m_syswrap/syswrap-x86-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-xen.c

Remove a few unneeded header files.

------------------------------------------------------------------------
r15110 | florian | 2015-04-18 18:41:31 +0100 (Sat, 18 Apr 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/pub_core_threadstate.h

Fix a comment.

------------------------------------------------------------------------
r15109 | florian | 2015-04-18 11:33:54 +0100 (Sat, 18 Apr 2015) | 7 lines
Changed paths:
   M /trunk/coregrind/Makefile.am
   A /trunk/coregrind/m_sigframe/priv_sigframe.h
   M /trunk/coregrind/m_sigframe/sigframe-amd64-darwin.c
   M /trunk/coregrind/m_sigframe/sigframe-amd64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-arm-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-arm64-linux.c
   A /trunk/coregrind/m_sigframe/sigframe-common.c
   M /trunk/coregrind/m_sigframe/sigframe-mips32-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-mips64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-ppc32-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-ppc64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-s390x-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-tilegx-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-x86-darwin.c
   M /trunk/coregrind/m_sigframe/sigframe-x86-linux.c

Factor out the 'extend' function. We only need one version for Linux and
one for Darwin. Down from 11. 
Carve out a new function 'track_frame_memory' that communicates to the
tool the allocation of a new stack frame. This was slightly different on
Linux and Darwin but should be the same on both platforms.
New files: priv_sigframe.h and sigframe-common.c

------------------------------------------------------------------------
r15108 | florian | 2015-04-18 10:15:47 +0100 (Sat, 18 Apr 2015) | 2 lines
Changed paths:
   M /trunk/Makefile.vex.am

Add missing header file.

------------------------------------------------------------------------
r15107 | carll | 2015-04-18 01:01:58 +0100 (Sat, 18 Apr 2015) | 17 lines
Changed paths:
   A /trunk/memcheck/tests/ppc32/power_ISA2_07.c
   A /trunk/memcheck/tests/ppc32/power_ISA2_07.stderr.exp
   A /trunk/memcheck/tests/ppc32/power_ISA2_07.stdout.exp
   A /trunk/memcheck/tests/ppc32/power_ISA2_07.stdout.exp-LE
   A /trunk/memcheck/tests/ppc32/power_ISA2_07.vgtest
   A /trunk/memcheck/tests/ppc64/power_ISA2_07.c
   A /trunk/memcheck/tests/ppc64/power_ISA2_07.stderr.exp
   A /trunk/memcheck/tests/ppc64/power_ISA2_07.stdout.exp
   A /trunk/memcheck/tests/ppc64/power_ISA2_07.stdout.exp-LE
   A /trunk/memcheck/tests/ppc64/power_ISA2_07.vgtest

Forgot to add the new files in memcheck/tests/ppc32 and memcheck/tests/ppc32.

They should have been part of the previous commit 15106.

--------------------------------------------------------------------

Add support for the lbarx, lharx, stbcx and sthcs instructions.

The instructions are part of the ISA 2.06 but were not implemented
in all versions of hardware.  The four instructions are all supported
in ISA 2.07.  The instructions were put under the ISA 2.07 category
of supported instructions in this patch.

The VEX commit for this fix is r3137.

The bugzilla for this issue is 346324.

------------------------------------------------------------------------
r15106 | carll | 2015-04-18 00:43:36 +0100 (Sat, 18 Apr 2015) | 11 lines
Changed paths:
   M /trunk/memcheck/tests/ppc32/Makefile.am
   M /trunk/memcheck/tests/ppc64/Makefile.am
   M /trunk/none/tests/ppc32/Makefile.am
   M /trunk/none/tests/ppc32/jm_int_isa_2_07.stdout.exp
   M /trunk/none/tests/ppc64/Makefile.am
   M /trunk/none/tests/ppc64/jm_int_isa_2_07.stdout.exp
   M /trunk/none/tests/ppc64/test_isa_2_07_part1.c

Add support for the lbarx, lharx, stbcx and sthcs instructions.

The instructions are part of the ISA 2.06 but were not implemented
in all versions of hardware.  The four instructions are all supported
in ISA 2.07.  The instructions were put under the ISA 2.07 category
of supported instructions in this patch.

The VEX commit for this fix is r3137.

The bugzilla for this issue is 346324.

------------------------------------------------------------------------
r15105 | philippe | 2015-04-17 22:19:43 +0100 (Fri, 17 Apr 2015) | 5 lines
Changed paths:
   M /trunk/helgrind/libhb_core.c

Fix statistics about ctxt_rcec :
* the nr of discards was always 0
* the cur nr of values was shown as max


------------------------------------------------------------------------
r15104 | florian | 2015-04-17 09:56:11 +0100 (Fri, 17 Apr 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_coredump/coredump-elf.c

Followup to r15101. Remove pointless cast. The castee already 
has that type.

------------------------------------------------------------------------
r15101 | carll | 2015-04-16 17:25:29 +0100 (Thu, 16 Apr 2015) | 6 lines
Changed paths:
   M /trunk/coregrind/m_coredump/coredump-elf.c

Fix the compiler warning about casting the arguments to the functions
LibVEX_GuestPPC64_get_CR() and LibVEX_GuestPPC64_get_XER(). 

The bugzilla for this issue is 346267.


------------------------------------------------------------------------
r15100 | florian | 2015-04-15 22:45:57 +0100 (Wed, 15 Apr 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_sigframe/sigframe-tilegx-linux.c

Fix function call: 1st argument is the thread id.

------------------------------------------------------------------------
r15099 | philippe | 2015-04-15 21:30:52 +0100 (Wed, 15 Apr 2015) | 4 lines
Changed paths:
   M /trunk/none/tests/libvex_test.c

Following fix done in tilegx host in vex: r3130, reenable tilegx as host
in libvexmultiarch_test


------------------------------------------------------------------------
r15098 | florian | 2015-04-15 19:35:52 +0100 (Wed, 15 Apr 2015) | 2 lines
Changed paths:
   M /trunk/none/tests

Update list of ignored files.

------------------------------------------------------------------------
r15097 | zliu | 2015-04-15 04:26:38 +0100 (Wed, 15 Apr 2015) | 3 lines
Changed paths:
   M /trunk/memcheck/tests/leak-segv-jmp.c

To address memcheck/tests/leak-segv-jmp test failure for TILEGX
By: Zhi-Gang Liu       zhg.liu@gmail.com

------------------------------------------------------------------------
r15096 | zliu | 2015-04-15 04:22:17 +0100 (Wed, 15 Apr 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-tilegx-linux.c
   M /trunk/include/vki/vki-scnums-tilegx-linux.h

Add TILEGX arch. specific syscall #245, __NR_cacheflush
By:Zhi-Gang Liu

------------------------------------------------------------------------
r15095 | zliu | 2015-04-15 03:56:20 +0100 (Wed, 15 Apr 2015) | 4 lines
Changed paths:
   M /trunk/perf/bigcode.c

Fix the bigcode test failure for TILEGX
By: Zhi-Gang Liu


------------------------------------------------------------------------
r15094 | zliu | 2015-04-15 03:33:09 +0100 (Wed, 15 Apr 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_debuglog.c
   M /trunk/coregrind/m_libcassert.c

Address minor issues in Julian's last review.
For TILEGX only.
By: Zhi-Gang Liu

------------------------------------------------------------------------
r15093 | zliu | 2015-04-15 01:56:40 +0100 (Wed, 15 Apr 2015) | 9 lines
Changed paths:
   A /trunk/none/tests/tilegx/allexec.c


Add 'allexec.c' in "none/tests/tilegx"

The symbolic link 'allexec.c' -> ../allecec.c

By: Zhi-Gang Liu
zhg.liu@gmail.com


------------------------------------------------------------------------
r15092 | zliu | 2015-04-15 01:48:34 +0100 (Wed, 15 Apr 2015) | 7 lines
Changed paths:
   D /trunk/none/tests/tilegx/allexec.c

Remove allecec.c from none/tests/tilegx

Will add a symbolic link for that file next.

Zhi-Gang Liu


------------------------------------------------------------------------
r15091 | florian | 2015-04-14 20:59:21 +0100 (Tue, 14 Apr 2015) | 5 lines
Changed paths:
   M /trunk/coregrind/m_signals.c
   M /trunk/none/tests/x86-linux
   M /trunk/none/tests/x86-linux/Makefile.am
   A /trunk/none/tests/x86-linux/hang.c
   A /trunk/none/tests/x86-linux/hang.stderr.exp
   A /trunk/none/tests/x86-linux/hang.vgtest

Followup to r14974. That revision oversimplified a condition, part
of which was presumed to be redundant but wasn't. This caused code
to hang due to an infinite signal-delivery loop. Observed and
tracked down by Austin English.

------------------------------------------------------------------------
r15088 | sewardj | 2015-04-13 12:41:30 +0100 (Mon, 13 Apr 2015) | 2 lines
Changed paths:
   M /trunk/configure.ac

Make the version checking for Apple LLVM a bit less strict.

------------------------------------------------------------------------
r15087 | sewardj | 2015-04-13 12:39:50 +0100 (Mon, 13 Apr 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_initimg/initimg-darwin.c

Un-break the Darwin build after r15078.  Patch from Mark Pauley
(pauley@unsaturated.net).


------------------------------------------------------------------------
r15085 | florian | 2015-04-11 19:50:47 +0100 (Sat, 11 Apr 2015) | 2 lines
Changed paths:
   M /trunk/none/tests
   M /trunk/none/tests/tilegx

Update list of ignored files.

------------------------------------------------------------------------
r15084 | philippe | 2015-04-11 15:32:25 +0100 (Sat, 11 Apr 2015) | 79 lines
Changed paths:
   M /trunk/none/tests/Makefile.am
   A /trunk/none/tests/libvex_test.c
   A /trunk/none/tests/libvex_test.stderr.exp
   A /trunk/none/tests/libvex_test.vgtest
   A /trunk/none/tests/libvexmultiarch_test.stderr.exp
   A /trunk/none/tests/libvexmultiarch_test.vgtest

Add 2 tests none/tests/libvex_test and libvexmultiarch_test

The objective of libvex_test is to verify that the VEX lib
can be used in 'single arch mode' (host == guest).

The objective of libvexmultiarch_test is to verify that the VEX lib
can be used in 'multi arch mode' (freely choose host and guest).
(but not many combinations are working: if wordsize or endianess
differs, then libVEX quickly asserts somewhere).

libvex_test.c is somewhat bizarre, as it uses the architecture
for which we have compiled as the guest, and use a 'foreign' arch
as the host.
That allows to avoid having to define in the test a bunch
of arch specific asm instructions : the test just decode a part
of its own code, and translate it to other archs.

By default, only the combination host == guest is run.
Arguments must be given to run other combinations.
See libvex_test.c for a description on how to specify which combinations
to run.

LibVEX host != guest does not (yet?) work when endianess or word size differs
between host and guest.

Also, currently, TILEGX host is not working properly (unless guest is also
TILEGX), as the evcheck instructions generated differs according to
the offset of the host_EvC_{FAILADDR,COUNTER}.

So, using TILEGX as host is only done when guest is also TILEGX.

Note that it is possible to specify a specific host arch to use.
For example, to force TILEGX to be used, do:
./none/tests/libvexmultiarch_test 1034
(where 1034 is the decimal value corresponding to the enum VexArchTILEGX.
This currently aborts with:
...
------------------------ Assembly ------------------------

EvCheck   (evCheck) ld r11, 8(r50); addli r11, r11, -1; st r11, 8(r50); bgez r11, nofail; jalr *(r50); nofail:

vex: priv/host_tilegx_defs.c:2353 (emit_TILEGXInstr): Assertion `evCheckSzB_TILEGX() == (UChar*)p - (UChar*)p0' failed.
//// failure exit called by libVEX
Whe TILEGX is fixed, we can remove the specific condition that avoids using
TILEGX as host.


Small changes have been done on VEX to allow more combinations
to work:
* host_mips_defs.c : when not compiled on mips,
  a lot of mips specific code is not compiled at all, because
  one of _MIPSEL or _MIPSEB must be defined to have either the
  little endian code or big endian code.
  emit32 function must however work to use mips as host.
  So, for this function, if _MIPSEL is not defined, then
  the big endian code is compiled in by default.
  (the mips endianess should probably be handled like the ppc
   endianess, for which the endianness to use is decided at runtime).

* host_arm64_isel.c : addition of a 'do not emit anything' for
   ABI HINT (avoid an assert e.g. for amd64 guest, arm64 host)

* libvex_guest_amd64.h : when I was still hoping mixing amd64 and x86,
  a first assert was firing up due to size/alignment
  of VexGuestAMD64State when compiled in 32 bits.
  => addition of pad elements to ensure the size and alignment
  of VexGuestAMD64State stays the same when compiled in 32 and
  64 bits (the 64 bits layout is unchanged).


The new tests have been run on x86/amd64/ppc64/s390x.
It is very well possible that the tests will fail on untested archs
(ppc32 or mips* or arm* or tilegx)
(e.g. because the hardcoded hwcaps in libvex_test.c are not ok).
It should be relatively trivial to fix these hwcaps problems.
Some other problems might be less easy to understand and fix 
(e.g. similar to the TILEGX evcheck or mips emit32 problem).


------------------------------------------------------------------------
r15083 | philippe | 2015-04-11 12:42:22 +0100 (Sat, 11 Apr 2015) | 5 lines
Changed paths:
   M /trunk/coregrind/m_sparsewa.c
   M /trunk/helgrind/libhb_core.c
   M /trunk/include/pub_tool_sparsewa.h

Remove useless arguments in sparsewa, that were inheritated from WordFM
These arguments are not needed for sparsewa, as they can only
return the key given in input.


------------------------------------------------------------------------
r15082 | philippe | 2015-04-10 20:34:14 +0100 (Fri, 10 Apr 2015) | 6 lines
Changed paths:
   M /trunk/helgrind/libhb_core.c

Have the event map GC use the same approach as the other GC 
done from libhb_maybe_GC, i.e. check the condition in
libhb_maybe_GC, and call the (non inlined) GC only if
a GC is needed.


------------------------------------------------------------------------
r15081 | philippe | 2015-04-10 20:08:17 +0100 (Fri, 10 Apr 2015) | 3 lines
Changed paths:
   M /trunk/memcheck/tests/leak-segv-jmp.stderr.exp

Update expected result for leak-segv-jmp, following TileGX addition of
a few lines in leak-segv-jmp.c

------------------------------------------------------------------------
r15080 | sewardj | 2015-04-10 13:30:09 +0100 (Fri, 10 Apr 2015) | 6 lines
Changed paths:
   M /trunk/Makefile.all.am
   M /trunk/Makefile.tool.am
   M /trunk/Makefile.vex.am
   M /trunk/cachegrind/cg_arch.c
   M /trunk/cachegrind/cg_branchpred.c
   M /trunk/configure.ac
   M /trunk/coregrind/Makefile.am
   M /trunk/coregrind/launcher-linux.c
   M /trunk/coregrind/m_aspacemgr/aspacemgr-common.c
   M /trunk/coregrind/m_cache.c
   M /trunk/coregrind/m_coredump/coredump-elf.c
   M /trunk/coregrind/m_debugger.c
   M /trunk/coregrind/m_debuginfo/d3basics.c
   M /trunk/coregrind/m_debuginfo/debuginfo.c
   M /trunk/coregrind/m_debuginfo/priv_storage.h
   M /trunk/coregrind/m_debuginfo/readdwarf.c
   M /trunk/coregrind/m_debuginfo/readelf.c
   M /trunk/coregrind/m_debuginfo/storage.c
   M /trunk/coregrind/m_debuglog.c
   A /trunk/coregrind/m_dispatch/dispatch-tilegx-linux.S
   M /trunk/coregrind/m_gdbserver/target.c
   A /trunk/coregrind/m_gdbserver/valgrind-low-tilegx.c
   M /trunk/coregrind/m_gdbserver/valgrind_low.h
   M /trunk/coregrind/m_initimg/initimg-linux.c
   M /trunk/coregrind/m_libcassert.c
   M /trunk/coregrind/m_libcfile.c
   M /trunk/coregrind/m_libcproc.c
   M /trunk/coregrind/m_machine.c
   M /trunk/coregrind/m_main.c
   M /trunk/coregrind/m_redir.c
   M /trunk/coregrind/m_scheduler/scheduler.c
   A /trunk/coregrind/m_sigframe/sigframe-tilegx-linux.c
   M /trunk/coregrind/m_signals.c
   M /trunk/coregrind/m_stacktrace.c
   M /trunk/coregrind/m_syscall.c
   M /trunk/coregrind/m_syswrap/priv_types_n_macros.h
   A /trunk/coregrind/m_syswrap/syscall-tilegx-linux.S
   M /trunk/coregrind/m_syswrap/syswrap-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-main.c
   A /trunk/coregrind/m_syswrap/syswrap-tilegx-linux.c
   M /trunk/coregrind/m_trampoline.S
   M /trunk/coregrind/m_translate.c
   M /trunk/coregrind/pub_core_aspacemgr.h
   M /trunk/coregrind/pub_core_basics.h
   M /trunk/coregrind/pub_core_debuginfo.h
   M /trunk/coregrind/pub_core_machine.h
   M /trunk/coregrind/pub_core_mallocfree.h
   M /trunk/coregrind/pub_core_syscall.h
   M /trunk/coregrind/pub_core_trampoline.h
   M /trunk/coregrind/pub_core_transtab_asm.h
   M /trunk/coregrind/vgdb-invoker-ptrace.c
   M /trunk/docs/internals/register-uses.txt
   M /trunk/drd/drd_bitmap.h
   M /trunk/drd/drd_clientreq.c
   M /trunk/drd/drd_load_store.c
   M /trunk/exp-sgcheck/pc_main.c
   M /trunk/exp-sgcheck/tests/is_arch_supported
   M /trunk/gdbserver_tests/mcblocklistsearch.vgtest
   M /trunk/gdbserver_tests/nlcontrolc.vgtest
   M /trunk/gdbserver_tests/nlgone_return.vgtest
   M /trunk/helgrind/tests/annotate_hbefore.c
   M /trunk/helgrind/tests/tc07_hbl1.c
   M /trunk/helgrind/tests/tc08_hbl2.c
   M /trunk/helgrind/tests/tc11_XCHG.c
   M /trunk/include/pub_tool_basics.h
   M /trunk/include/pub_tool_guest.h
   M /trunk/include/pub_tool_machine.h
   M /trunk/include/pub_tool_vkiscnums_asm.h
   M /trunk/include/valgrind.h
   M /trunk/include/vki/vki-linux.h
   A /trunk/include/vki/vki-posixtypes-tilegx-linux.h
   A /trunk/include/vki/vki-scnums-tilegx-linux.h
   A /trunk/include/vki/vki-tilegx-linux.h
   M /trunk/massif/tests/Makefile.am
   M /trunk/memcheck/mc_machine.c
   M /trunk/memcheck/tests/Makefile.am
   M /trunk/memcheck/tests/atomic_incs.c
   M /trunk/memcheck/tests/leak-segv-jmp.c
   A /trunk/memcheck/tests/origin5-bz2.stderr.exp-glibc212-tilegx
   A /trunk/memcheck/tests/origin6-fp.stderr.exp-glibc212-tilegx
   M /trunk/memcheck/tests/vbit-test/irops.c
   M /trunk/memcheck/tests/vbit-test/vtest.h
   M /trunk/none/tests/Makefile.am
   M /trunk/none/tests/allexec_prepare_prereq
   A /trunk/none/tests/tilegx
   A /trunk/none/tests/tilegx/Makefile.am
   A /trunk/none/tests/tilegx/allexec.c
   M /trunk/tests/arch_test.c

Add a port to Linux/TileGx.  Zhi-Gang Liu (zliu@tilera.com)
Valgrind aspects, to match vex r3124.

See bug 339778 - Linux/TileGx platform support to Valgrind


------------------------------------------------------------------------
r15079 | philippe | 2015-04-09 21:07:11 +0100 (Thu, 09 Apr 2015) | 2 lines
Changed paths:
   A /trunk/none/tests/scripts/shell_nointerp1.stdout.exp

Add missing stdout.exp file

------------------------------------------------------------------------
r15078 | carll | 2015-04-09 17:23:20 +0100 (Thu, 09 Apr 2015) | 21 lines
Changed paths:
   M /trunk/coregrind/m_initimg/initimg-linux.c
   M /trunk/coregrind/m_main.c
   M /trunk/coregrind/pub_core_initimg.h

ADD AT_DCACHEBSIZE and AT_HWCAP2 support for POWER PC 

Valgrind currently does not support the following AUX vector entries:
AT_DCACHEBSIZE, and AT_HWCAP2. By default these entries are suppressed by
Valgrind. The attached patch adds the needed support so the user level programs
can correctly determine that hardware level they are running on. Specifically
that the ISA 2.07 for Power 8 is supported.

Bugzilla 345695

This fix adds the needed support.  It makes a minor change to allow the
VEX settings of the host platform to be passed down so they can be checked
against the HWCAP values.

The files touched are:
  coregrind/m_initimg/initimg-linux.c
  coregrind/pub_core_initimg.h
  coregrind/m_main.c

committed by Carl Love cel@us.ibm.com

------------------------------------------------------------------------
r15077 | florian | 2015-04-08 20:01:15 +0100 (Wed, 08 Apr 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_ume/elf.c
   M /trunk/coregrind/m_ume/macho.c
   M /trunk/coregrind/m_ume/main.c
   M /trunk/coregrind/m_ume/priv_ume.h
   M /trunk/coregrind/m_ume/script.c

Assorted cleanups: remove magic constants and unneeded header file. Update
a few comments. Exit with code 127 in bash emulation mode when file was
not found.

------------------------------------------------------------------------
r15076 | florian | 2015-04-08 13:20:04 +0100 (Wed, 08 Apr 2015) | 2 lines
Changed paths:
   M /trunk/none/tests/scripts/Makefile.am
   M /trunk/none/tests/scripts/shell
   M /trunk/none/tests/scripts/shell.stdout.exp
   A /trunk/none/tests/scripts/shell_nointerp1 (from /trunk/none/tests/scripts/shell_valid2:15075)
   A /trunk/none/tests/scripts/shell_nointerp1.stderr.exp (from /trunk/none/tests/scripts/shell_valid2.stderr.exp:15075)
   A /trunk/none/tests/scripts/shell_nointerp1.vgtest (from /trunk/none/tests/scripts/shell_valid2.vgtest:15075)
   A /trunk/none/tests/scripts/shell_nointerp2
   A /trunk/none/tests/scripts/shell_nointerp2.stderr.exp
   A /trunk/none/tests/scripts/shell_nointerp2.stdout.exp
   A /trunk/none/tests/scripts/shell_nointerp2.vgtest
   A /trunk/none/tests/scripts/shell_nointerp3
   A /trunk/none/tests/scripts/shell_nointerp3.stderr.exp
   A /trunk/none/tests/scripts/shell_nointerp3.stdout.exp
   A /trunk/none/tests/scripts/shell_nointerp3.vgtest
   D /trunk/none/tests/scripts/shell_valid2
   D /trunk/none/tests/scripts/shell_valid2.stderr.exp
   D /trunk/none/tests/scripts/shell_valid2.vgtest
   D /trunk/none/tests/scripts/shell_valid3
   D /trunk/none/tests/scripts/shell_valid3.stderr.exp
   D /trunk/none/tests/scripts/shell_valid3.vgtest

Consolidate shell script testcases without interpreter.

------------------------------------------------------------------------
r15075 | florian | 2015-04-07 21:43:55 +0100 (Tue, 07 Apr 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Certain kernels on s390 provide extra read permissions on executable
segments. See discussion here: https://bugs.kde.org/show_bug.cgi?id=345824#c4
Making sure that rx and x compare equal.

------------------------------------------------------------------------
r15074 | sewardj | 2015-04-07 10:08:42 +0100 (Tue, 07 Apr 2015) | 2 lines
Changed paths:
   M /trunk/memcheck/mc_translate.c

Track vex r3120, that changed the type of Iop_Sqrt64x2 and Iop_Sqrt32x4.

------------------------------------------------------------------------
r15073 | florian | 2015-04-06 22:34:30 +0100 (Mon, 06 Apr 2015) | 10 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/Makefile.am
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   A /trunk/coregrind/m_aspacemgr/aspacemgr-segnames.c
   M /trunk/coregrind/m_aspacemgr/priv_aspacemgr.h

Followup to r14898 which changes the storage of segment names by
putting them into a string table.
This patch adds reference counting to segment names and frees them
when they are no longer used. The so freed memory can be reclaimed to
store future segment names.
New file coregrind/m_aspacemgr/aspacemgr-segnames.c which has all the
code dealing with segment names. Carved out of aspacemgr-linux.c
Detailled comments in the code.
Fixes BZ 344559.

------------------------------------------------------------------------
r15072 | sewardj | 2015-04-06 20:41:12 +0100 (Mon, 06 Apr 2015) | 3 lines
Changed paths:
   M /trunk/none/tests/arm64/fp_and_simd.c

arm64: remove redundant comment on test cases for FSQRT 2d_2d, 4s_4s, 2s_2s
(should have been included in r15071).  No functional change.

------------------------------------------------------------------------
r15071 | sewardj | 2015-04-06 20:35:08 +0100 (Mon, 06 Apr 2015) | 3 lines
Changed paths:
   M /trunk/none/tests/arm64/fp_and_simd.c
   M /trunk/none/tests/arm64/fp_and_simd.stdout.exp

arm64: enable test cases for
FSQRT 2d_2d, 4s_4s, 2s_2s

------------------------------------------------------------------------
r15070 | sewardj | 2015-04-06 15:52:28 +0100 (Mon, 06 Apr 2015) | 7 lines
Changed paths:
   M /trunk/memcheck/mc_translate.c
   M /trunk/memcheck/tests/vbit-test/irops.c
   M /trunk/memcheck/tests/vbit-test/vtest.h

Memcheck: add support for recently added IROps: 
Iop_F64toF16 
Iop_F32toF16 
Iop_F16toF64 
Iop_F16toF32 


------------------------------------------------------------------------
r15069 | sewardj | 2015-04-06 15:49:42 +0100 (Mon, 06 Apr 2015) | 17 lines
Changed paths:
   M /trunk/none/tests/arm64/fp_and_simd.c
   M /trunk/none/tests/arm64/fp_and_simd.stdout.exp

arm64: enable test cases for

SCVTF d_d_imm, s_s_imm 
UCVTF d_d_imm, s_s_imm 
FCVTZS d_d_imm, s_s_imm 
FCVTZU d_d_imm, s_s_imm 
FCVTXN s_d 
SCVTF d_d, s_s 
UCVTF d_d, s_s 
SCVTF {2d_2d,4s_4s,2s_2s}_imm 
UCVTF {2d_2d,4s_4s,2s_2s}_imm 
FCVTZS {2d_2d,4s_4s,2s_2s}_imm 
FCVTZU {2d_2d,4s_4s,2s_2s}_imm 
FCVTXN 2s/4s_2d 
FCVTZ{S,U} {w,x}_{s,x}_#fbits 
 

------------------------------------------------------------------------
r15068 | florian | 2015-04-06 15:29:45 +0100 (Mon, 06 Apr 2015) | 25 lines
Changed paths:
   M /trunk/coregrind/launcher-linux.c
   M /trunk/include/vki/vki-linux.h

The linux launcher showed some odd behaviour. When given a shell script
named 'now' with this contents:

#!
/bin/date

the platform selection logic does this:

--11196:1:launcher no tool requested, defaulting to 'memcheck'
--11196:2:launcher   selecting platform for './now'
--11196:2:launcher   selecting platform for './now'
--11196:2:launcher   opened './now'
--11196:2:launcher   read 13 bytes from './now'
--11196:2:launcher   selecting platform for ''
--11196:2:launcher   selecting platform for '/home/florian/bin/'
--11196:2:launcher   opened '/home/florian/bin/'
--11196:2:launcher   selected platform 'unknown'
--11196:1:launcher no platform detected, defaulting platform to 'amd64-linux'

That is not quite right. Instead the platform should be determined by
examining the default shell.
Additionally, define VKI_BINPRM_BUF_SIZE because on linux only that many
characters are considered on a #! line. C.f. <linux>/fs/binfmt_script.c
m_ume/* needs to be adapted as well but that is a different patch.

------------------------------------------------------------------------
r15067 | florian | 2015-04-06 15:24:44 +0100 (Mon, 06 Apr 2015) | 2 lines
Changed paths:
   M /trunk/none/tests/scripts

Ignore generated files.

------------------------------------------------------------------------
r15066 | florian | 2015-04-04 19:43:00 +0100 (Sat, 04 Apr 2015) | 3 lines
Changed paths:
   M /trunk/include/pub_tool_basics.h

Tweak STATIC_ASSERT such that there is no warning about an unused
variable when used at block scope.

------------------------------------------------------------------------
r15065 | florian | 2015-04-03 16:47:19 +0100 (Fri, 03 Apr 2015) | 3 lines
Changed paths:
   M /trunk/configure.ac
   M /trunk/none/tests/Makefile.am
   D /trunk/none/tests/bug231357.stderr.exp
   D /trunk/none/tests/bug231357.stdout.exp
   D /trunk/none/tests/bug231357.vgtest
   D /trunk/none/tests/filter_linenos
   D /trunk/none/tests/filter_shell_output
   A /trunk/none/tests/scripts
   A /trunk/none/tests/scripts/Makefile.am
   A /trunk/none/tests/scripts/bug231357.stderr.exp (from /trunk/none/tests/bug231357.stderr.exp:15064)
   A /trunk/none/tests/scripts/bug231357.stdout.exp (from /trunk/none/tests/bug231357.stdout.exp:15064)
   A /trunk/none/tests/scripts/bug231357.vgtest (from /trunk/none/tests/bug231357.vgtest:15064)
   A /trunk/none/tests/scripts/filter_linenos (from /trunk/none/tests/filter_linenos:15062)
   A /trunk/none/tests/scripts/filter_shell_output (from /trunk/none/tests/filter_shell_output:15062)
   A /trunk/none/tests/scripts/filter_stderr
   A /trunk/none/tests/scripts/shell (from /trunk/none/tests/shell:15062)
   A /trunk/none/tests/scripts/shell.stderr.exp (from /trunk/none/tests/shell.stderr.exp:15062)
   A /trunk/none/tests/scripts/shell.stderr.exp-dash (from /trunk/none/tests/shell.stderr.exp-dash:15062)
   A /trunk/none/tests/scripts/shell.stderr.exp-dash2 (from /trunk/none/tests/shell.stderr.exp-dash2:15062)
   A /trunk/none/tests/scripts/shell.stdout.exp (from /trunk/none/tests/shell.stdout.exp:15062)
   A /trunk/none/tests/scripts/shell.vgtest (from /trunk/none/tests/shell.vgtest:15062)
   A /trunk/none/tests/scripts/shell_badinterp (from /trunk/none/tests/shell_badinterp:15062)
   A /trunk/none/tests/scripts/shell_badinterp.stderr.exp (from /trunk/none/tests/shell_badinterp.stderr.exp:15062)
   A /trunk/none/tests/scripts/shell_badinterp.vgtest (from /trunk/none/tests/shell_badinterp.vgtest:15062)
   A /trunk/none/tests/scripts/shell_binaryfile (from /trunk/none/tests/shell_binaryfile:15062)
   A /trunk/none/tests/scripts/shell_binaryfile.stderr.exp (from /trunk/none/tests/shell_binaryfile.stderr.exp:15062)
   A /trunk/none/tests/scripts/shell_binaryfile.vgtest (from /trunk/none/tests/shell_binaryfile.vgtest:15062)
   A /trunk/none/tests/scripts/shell_dir.stderr.exp (from /trunk/none/tests/shell_dir.stderr.exp:15062)
   A /trunk/none/tests/scripts/shell_dir.vgtest (from /trunk/none/tests/shell_dir.vgtest:15062)
   A /trunk/none/tests/scripts/shell_nonexec.stderr.exp (from /trunk/none/tests/shell_nonexec.stderr.exp:15062)
   A /trunk/none/tests/scripts/shell_nonexec.vgtest (from /trunk/none/tests/shell_nonexec.vgtest:15062)
   A /trunk/none/tests/scripts/shell_nosuchfile.stderr.exp (from /trunk/none/tests/shell_nosuchfile.stderr.exp:15062)
   A /trunk/none/tests/scripts/shell_nosuchfile.vgtest (from /trunk/none/tests/shell_nosuchfile.vgtest:15062)
   A /trunk/none/tests/scripts/shell_valid1 (from /trunk/none/tests/shell_valid1:15062)
   A /trunk/none/tests/scripts/shell_valid1.stderr.exp (from /trunk/none/tests/shell_valid1.stderr.exp:15062)
   A /trunk/none/tests/scripts/shell_valid1.vgtest (from /trunk/none/tests/shell_valid1.vgtest:15062)
   A /trunk/none/tests/scripts/shell_valid2 (from /trunk/none/tests/shell_valid2:15062)
   A /trunk/none/tests/scripts/shell_valid2.stderr.exp (from /trunk/none/tests/shell_valid2.stderr.exp:15062)
   A /trunk/none/tests/scripts/shell_valid2.vgtest (from /trunk/none/tests/shell_valid2.vgtest:15062)
   A /trunk/none/tests/scripts/shell_valid3 (from /trunk/none/tests/shell_valid3:15062)
   A /trunk/none/tests/scripts/shell_valid3.stderr.exp (from /trunk/none/tests/shell_valid3.stderr.exp:15062)
   A /trunk/none/tests/scripts/shell_valid3.vgtest (from /trunk/none/tests/shell_valid3.vgtest:15062)
   A /trunk/none/tests/scripts/shell_valid4 (from /trunk/none/tests/shell_valid4:15063)
   A /trunk/none/tests/scripts/shell_valid4.stderr.exp (from /trunk/none/tests/shell_valid4.stderr.exp:15063)
   A /trunk/none/tests/scripts/shell_valid4.stdout.exp (from /trunk/none/tests/shell_valid4.stdout.exp:15063)
   A /trunk/none/tests/scripts/shell_valid4.vgtest (from /trunk/none/tests/shell_valid4.vgtest:15063)
   A /trunk/none/tests/scripts/shell_zerolength (from /trunk/none/tests/shell_zerolength:15062)
   A /trunk/none/tests/scripts/shell_zerolength.stderr.exp (from /trunk/none/tests/shell_zerolength.stderr.exp:15062)
   A /trunk/none/tests/scripts/shell_zerolength.stderr.exp-dash (from /trunk/none/tests/shell_zerolength.stderr.exp-dash:15062)
   A /trunk/none/tests/scripts/shell_zerolength.vgtest (from /trunk/none/tests/shell_zerolength.vgtest:15062)
   D /trunk/none/tests/shell
   D /trunk/none/tests/shell.stderr.exp
   D /trunk/none/tests/shell.stderr.exp-dash
   D /trunk/none/tests/shell.stderr.exp-dash2
   D /trunk/none/tests/shell.stdout.exp
   D /trunk/none/tests/shell.vgtest
   D /trunk/none/tests/shell_badinterp
   D /trunk/none/tests/shell_badinterp.stderr.exp
   D /trunk/none/tests/shell_badinterp.vgtest
   D /trunk/none/tests/shell_binaryfile
   D /trunk/none/tests/shell_binaryfile.stderr.exp
   D /trunk/none/tests/shell_binaryfile.vgtest
   D /trunk/none/tests/shell_dir.stderr.exp
   D /trunk/none/tests/shell_dir.vgtest
   D /trunk/none/tests/shell_nonexec.stderr.exp
   D /trunk/none/tests/shell_nonexec.vgtest
   D /trunk/none/tests/shell_nosuchfile.stderr.exp
   D /trunk/none/tests/shell_nosuchfile.vgtest
   D /trunk/none/tests/shell_valid1
   D /trunk/none/tests/shell_valid1.stderr.exp
   D /trunk/none/tests/shell_valid1.vgtest
   D /trunk/none/tests/shell_valid2
   D /trunk/none/tests/shell_valid2.stderr.exp
   D /trunk/none/tests/shell_valid2.vgtest
   D /trunk/none/tests/shell_valid3
   D /trunk/none/tests/shell_valid3.stderr.exp
   D /trunk/none/tests/shell_valid3.vgtest
   D /trunk/none/tests/shell_valid4
   D /trunk/none/tests/shell_valid4.stderr.exp
   D /trunk/none/tests/shell_valid4.stdout.exp
   D /trunk/none/tests/shell_valid4.vgtest
   D /trunk/none/tests/shell_zerolength
   D /trunk/none/tests/shell_zerolength.stderr.exp
   D /trunk/none/tests/shell_zerolength.stderr.exp-dash
   D /trunk/none/tests/shell_zerolength.vgtest

New directory: none/tests/scripts
Move corresponding testcases there.

------------------------------------------------------------------------
r15064 | florian | 2015-04-02 23:02:24 +0100 (Thu, 02 Apr 2015) | 10 lines
Changed paths:
   M /trunk/none/tests/Makefile.am
   A /trunk/none/tests/bug231357.stderr.exp
   A /trunk/none/tests/bug231357.stdout.exp
   A /trunk/none/tests/bug231357.vgtest
   M /trunk/tests/vg_regtest.in

Add testcase for BZ 231357.
To do that a small enhancement to vg_regtest was needed:
(1) New declaration to allow specifying an environemnt variable
    that is set prior to invoking valgrind.
    eg:    env:  VAR=VAL
    There can be more than one such declaration
(2) prog-asis:  program_name
    This is like prog: except the program name is not prefixed with
    the testdir.

------------------------------------------------------------------------
r15063 | florian | 2015-04-02 17:07:41 +0100 (Thu, 02 Apr 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_ume/script.c
   M /trunk/none/tests/Makefile.am
   A /trunk/none/tests/shell_valid4
   A /trunk/none/tests/shell_valid4.stderr.exp
   A /trunk/none/tests/shell_valid4.stdout.exp
   A /trunk/none/tests/shell_valid4.vgtest

When skipping white space after #! to find the interpreter
only skip ' ' and tabs.

------------------------------------------------------------------------
r15062 | philippe | 2015-04-01 23:51:07 +0100 (Wed, 01 Apr 2015) | 4 lines
Changed paths:
   M /trunk/none/tests/Makefile.am
   A /trunk/none/tests/bigcode.stderr.exp
   A /trunk/none/tests/bigcode.stdout.exp
   A /trunk/none/tests/bigcode.vgtest

Add a test that triggers sector recycling
(cfr bug fix in revision 15058: without 15058, the below test
loops for ever).

------------------------------------------------------------------------
r15061 | philippe | 2015-04-01 21:06:26 +0100 (Wed, 01 Apr 2015) | 3 lines
Changed paths:
   M /trunk/Makefile.vex.am

Commit the VEX makefile changes needed to have the libvexmultiarch
build and installed by default

------------------------------------------------------------------------
r15060 | florian | 2015-04-01 20:20:16 +0100 (Wed, 01 Apr 2015) | 3 lines
Changed paths:
   M /trunk/include/pub_tool_basics.h

Fix function sr_EQ which compares two SysRes values. On Linux it was
forgotten to compare SysRes::_valEx.

------------------------------------------------------------------------
r15058 | philippe | 2015-04-01 19:15:42 +0100 (Wed, 01 Apr 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_transtab.c

Fix infinite loop in sector recycling introduced by r15054
(a regression test that will exercise sector recycling will follow)

------------------------------------------------------------------------
r15057 | florian | 2015-04-01 16:07:34 +0100 (Wed, 01 Apr 2015) | 3 lines
Changed paths:
   M /trunk/NEWS

Announce fix for 231257. A pretty old BZ. We must have fixed this
in the meantime...

------------------------------------------------------------------------
r15056 | rhyskidd | 2015-04-01 13:15:49 +0100 (Wed, 01 Apr 2015) | 11 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_libcproc.c
   M /trunk/coregrind/m_main.c
   M /trunk/include/pub_tool_libcproc.h

Fix Darwin: -v does not show kernel version
bz#201435

Before:

== 590 tests, 237 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

After:

== 590 tests, 237 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

------------------------------------------------------------------------
r15055 | florian | 2015-03-31 23:19:23 +0100 (Tue, 31 Mar 2015) | 2 lines
Changed paths:
   M /trunk/memcheck/tests

Update list of ignored files.

------------------------------------------------------------------------
r15054 | philippe | 2015-03-31 21:38:52 +0100 (Tue, 31 Mar 2015) | 13 lines
Changed paths:
   M /trunk/coregrind/m_transtab.c

Further reduction of the size of the sector TTE tables
For default memcheck configuration, 32 bits) this patch
decreases by 13.6 MB ie. from 89945856 to 76317696.

Note that the type EClassNo is introduced only for readibility
purpose (and avoid some cast). That does not change the size
of the TTEntry.
The TTEntry size is reduced by using unions and/or Bool on 1 bit.

No performance impact detected (outer callgrind/inner memcheck bz2
on x86 shows a small improvement).


------------------------------------------------------------------------
r15053 | philippe | 2015-03-30 22:29:54 +0100 (Mon, 30 Mar 2015) | 2 lines
Changed paths:
   M /trunk/NEWS

Fix a typo

------------------------------------------------------------------------
r15052 | sewardj | 2015-03-30 20:14:35 +0100 (Mon, 30 Mar 2015) | 2 lines
Changed paths:
   M /trunk/memcheck/tests/vbit-test/irops.c

Un-break the build following vex r3110.  Thanks to PetarJ for the fix.

------------------------------------------------------------------------
r15051 | sewardj | 2015-03-30 19:50:23 +0100 (Mon, 30 Mar 2015) | 3 lines
Changed paths:
   M /trunk/none/tests/arm64/fp_and_simd.c
   M /trunk/none/tests/arm64/fp_and_simd.stdout.exp

arm64: enable test cases for
FCVT{N,M,A,P,Z}{S,U} 2d_2d, 4s_4s, 2s_2s

------------------------------------------------------------------------
r15050 | sewardj | 2015-03-30 10:11:34 +0100 (Mon, 30 Mar 2015) | 9 lines
Changed paths:
   M /trunk/none/tests/arm64/fp_and_simd.c
   M /trunk/none/tests/arm64/fp_and_simd.stdout.exp

arm64: add test cases for
FCVT{N,M,A,P,Z}{S,U} d_d, s_s 
FCVTN 4h/8h_4s, 2s/4s_2d 
FCVTL 4s_4h/8h, 2d_2s/4s 
FCVT Sd, Hn 
FCVT Dd, Hn 
FCVT Hd, Sn 
FCVT Hd, Dn

------------------------------------------------------------------------
r15049 | petarj | 2015-03-30 01:05:54 +0100 (Mon, 30 Mar 2015) | 6 lines
Changed paths:
   M /trunk/auxprogs

mips: update list of ignored files in auxprogs

Update the ignore list with:
- getoff-mips32-linux
- getoff-mips64-linux

------------------------------------------------------------------------
r15048 | rhyskidd | 2015-03-29 06:21:15 +0100 (Sun, 29 Mar 2015) | 12 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/tests/filter_libc

Fix memcheck/tests/sendmsg on OS X
bz#345637
- Support the lowercase for of libsystem* in filter_libc script

Before:

== 590 tests, 238 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

After:

== 590 tests, 237 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

------------------------------------------------------------------------
r15047 | florian | 2015-03-28 18:36:01 +0000 (Sat, 28 Mar 2015) | 2 lines
Changed paths:
   M /trunk/include/pub_tool_basics.h
   M /trunk/memcheck/tests/vbit-test/irops.c

Add STATIC_ASSERT and use it.

------------------------------------------------------------------------
r15046 | philippe | 2015-03-28 12:52:23 +0000 (Sat, 28 Mar 2015) | 14 lines
Changed paths:
   M /trunk/coregrind/m_stacks.c
   M /trunk/memcheck/tests/Makefile.am
   A /trunk/memcheck/tests/resvn_stack.c
   A /trunk/memcheck/tests/resvn_stack.stderr.exp
   A /trunk/memcheck/tests/resvn_stack.vgtest

Extensible main thread stack is tricky :(.

Revision 14976 causes a regression : stacktrace produced when the
stack has not yet been extended to cover SP will only contain one
element, as the stack limits are considered to be the limits of
the resvn segment.

This patch fixes that, by taking Resvn/SmUpper segment into
account to properly compute the limits.
It also contains a new regtest that fails with the trunk
(only one function in the stacktrace)
and succeeds with this patch (the 2 expected functions).


------------------------------------------------------------------------
r15045 | philippe | 2015-03-28 12:23:07 +0000 (Sat, 28 Mar 2015) | 9 lines
Changed paths:
   M /trunk/coregrind/m_gdbserver/server.c

The hint given by Valgrind gdbserver when enabling host visibility
in gdbserver was wrongly giving the file load address,
instead of the text segment address start.
This means that GDB was then showing wrong symbols for an address
(typically, symbols slightly before the address being printed).

This patch ensures the hint given is using the text start address.


------------------------------------------------------------------------
r15044 | philippe | 2015-03-28 12:01:58 +0000 (Sat, 28 Mar 2015) | 8 lines
Changed paths:
   M /trunk/helgrind/libhb_core.c

Helgrind optimisation: 
* do VTS pruning only if new threads were declared
  very dead since the last pruning round.
* When doing pruning, use the new list of threads very dead
  to do the pruning : this decreases the cost of the dichotomic search
  in VTS__substract


------------------------------------------------------------------------
r15043 | petarj | 2015-03-28 00:59:32 +0000 (Sat, 28 Mar 2015) | 9 lines
Changed paths:
   M /trunk/none/tests/mips64/cvm_ins.c
   M /trunk/none/tests/mips64/cvm_ins.stdout.exp

mips64: extend the test with new cases for Cavium SEQI and SNEI

Extend the test to introduce cases for SEQI and SNEI when immediate is
equal to the content of the GPR rs. Minor code style changes added.

Patch by Maran Pakkirisamy.

Related issue - BZ #341997.

------------------------------------------------------------------------
r15042 | florian | 2015-03-27 08:47:22 +0000 (Fri, 27 Mar 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Change the minimum allowable value of aspacem_minAddr to
be VKI_PAGE_SIZE. That follows from the requirement that
the address ought to be page aligned and > 0. 

------------------------------------------------------------------------
r15041 | philippe | 2015-03-26 22:12:40 +0000 (Thu, 26 Mar 2015) | 6 lines
Changed paths:
   M /trunk/coregrind/m_execontext.c
   M /trunk/coregrind/m_transtab.c

Improve --stats=yes:
 * give the avg nr of IPs per execontext
 * use the newly introduced %f in m_transtab.c ratio
   and in the avg nr of execontext per list


------------------------------------------------------------------------
r15040 | florian | 2015-03-26 21:55:00 +0000 (Thu, 26 Mar 2015) | 5 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/coregrind/m_main.c
   M /trunk/coregrind/pub_core_aspacemgr.h

Add function VG_(am_is_valid_for_aspacem_minAddr) so that the parser
for command line options does not need to know what addresses are valid
for aspacem_minAddr.
That information should be hidden in the address space manager.

------------------------------------------------------------------------
r15039 | philippe | 2015-03-26 21:32:03 +0000 (Thu, 26 Mar 2015) | 7 lines
Changed paths:
   M /trunk/coregrind/m_gdbserver/remote-utils.c
   M /trunk/coregrind/m_gdbserver/server.c
   M /trunk/coregrind/m_gdbserver/target.c

Have the very detailed gdbsrv debuglog (e.g. exchange of packets
between GDB and V gdbsrv, fetching/setting registers, ...) done
at debuglog level 3 instead of 1.
This allows to do gdbsrv commands at debuglog level 2
without seeing too much trace.


------------------------------------------------------------------------
r15038 | rhyskidd | 2015-03-26 10:14:25 +0000 (Thu, 26 Mar 2015) | 1 line
Changed paths:
   M /trunk/memcheck/tests/filter_strchr
   M /trunk/shared/vg_replace_strmem.c

Further fixes for bz#345394 specifically for OS X 10.10
------------------------------------------------------------------------
r15037 | philippe | 2015-03-24 14:02:44 +0000 (Tue, 24 Mar 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_transtab.c
   M /trunk/helgrind/libhb_core.c

* Add in helgrind stats the nr of live/exit/joined/exit and joined threads
* avoid division by 0 in m_transtab.c stats before anything was done


------------------------------------------------------------------------
r15036 | philippe | 2015-03-23 21:49:32 +0000 (Mon, 23 Mar 2015) | 25 lines
Changed paths:
   M /trunk/coregrind/m_scheduler/scheduler.c
   M /trunk/coregrind/m_transtab.c
   M /trunk/coregrind/pub_core_transtab.h

This patch further reduces the memory used by TT/TC (by about 15Mb
on 32 bits memcheck default nr of sectors).

Memory is reduced by using UShort typedef-s for Sector no and TTE no.
Note that for TTE no, we had a mixture of UShort, UInt and Int used
depending on the place (a TTE no was in any case constrained to be an UShort).

The bss memory/startup space is also reduced by allocating the htt on demand
(like tt and tc), using mmap the first time a sector is initialised.

Changes:
* pub_core_transtab.h :
   * 2 typedef to identify a sector and a tt entry (these 2 types are UShort)
   * add 2 #define 'invalid values' for these types
   * change the interface to use these types rather than UInt
* m_transtab.c
   * use wherever relevant these 2 new types rather than UInt or UShort
   * replace the use of -1 by INV_SNO or INV_TTE
   * remove now useless typecast from Int/UInt to UShort for tte
* schedule.c: use the new types





------------------------------------------------------------------------
r15035 | florian | 2015-03-23 20:04:14 +0000 (Mon, 23 Mar 2015) | 2 lines
Changed paths:
   M /trunk/include/pub_tool_basics.h

Simplify expression.

------------------------------------------------------------------------
r15034 | florian | 2015-03-23 17:13:04 +0000 (Mon, 23 Mar 2015) | 14 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/coregrind/m_signals.c
   M /trunk/coregrind/m_syswrap/syswrap-main.c
   M /trunk/coregrind/pub_core_aspacemgr.h
   M /trunk/memcheck/tests/sigaltstack.c

Add VG_(am_is_bogus_client_stack_pointer)(Addr).
The function is used in VG_(client_syscall) to avoid extending the stack
when it is clear that the current value of the stack pointer does not
point into a segment that looks like a stack segment.
See the comments in the code there.
As a side effect of this we can now revert r15018 which increased
the stack size of the alternate stack in memcheck/tests/sigaltstack.c.
The reason is that the belief at the time: "alternate stack is too small"
was not correct. What instead happened was that VG_(client_syscall) called
VG_(extend_stack) without need (the syscall was tgkill) and the new stack
pointer happened to be in a file segment. 
In other words: the current stack pointer was still within the alternate
stack, i.e. the alternate stack was (barely) large enough.

------------------------------------------------------------------------
r15033 | tom | 2015-03-22 11:01:58 +0000 (Sun, 22 Mar 2015) | 6 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-main.c
   M /trunk/memcheck/tests/x86-linux/scalar.stderr.exp

Include the platform name in the unhandled system call message

We often get bug reports for an unhandled system call which don't
make it clear what platform is in use, which makes it impossible
to know which system call it is.

------------------------------------------------------------------------
r15032 | philippe | 2015-03-21 20:55:36 +0000 (Sat, 21 Mar 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_addrinfo.c

Fix leak : only strdup in SectKind.objname if a SectKind address is returned


------------------------------------------------------------------------
r15031 | philippe | 2015-03-21 16:13:08 +0000 (Sat, 21 Mar 2015) | 8 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_errormgr.c
   M /trunk/coregrind/m_gdbserver/server.c

343902  --vgdb=yes doesn't break when --xml=yes is used

Changes ensures that gdbserver is called also when xml is yes.
When gdbserver is set to yes, we have to temporarily reset 
xml output to no, as gdbserver output (e.g. print the last error)
has to be printed to gdb.


------------------------------------------------------------------------
r15030 | rhyskidd | 2015-03-21 14:25:02 +0000 (Sat, 21 Mar 2015) | 12 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/memcheck/tests/filter_strchr

Fix memcheck/tests/strchr on OS X
bz#345394
- Support the required index and _platform_strchr alias

Before:

== 589 tests, 239 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

After:

== 589 tests, 238 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

------------------------------------------------------------------------
r15029 | florian | 2015-03-21 10:58:37 +0000 (Sat, 21 Mar 2015) | 11 lines
Changed paths:
   M /trunk/coregrind/m_demangle/cp-demangle.c

Change the GCC demangler to not use VLA. The rationale is that these VLAs
are allocated on the stack and they can become quite large - in particular
when the client is a C++ application using the Boost library.
In combination with the demanglers recursive nature this can quickly lead
to exhaustion of valgrind's per-thread stack (which cannot be dynamically
grown). Additionally, due to the large VLAs (I've seen a 32k array) we
could run out of stack space without issuing a prior warning and instead
just segfault. 
Therefore this patch allocates these arrays on the heap and frees them
later. Basically this is a respin of Joseph's r10385.

------------------------------------------------------------------------
r15028 | rhyskidd | 2015-03-21 06:35:32 +0000 (Sat, 21 Mar 2015) | 1 line
Changed paths:
   M /trunk/none/tests/ioctl_moans.c

Address darwin compile issue introduced in r15013, due to _IOC_NONE
------------------------------------------------------------------------
r15027 | florian | 2015-03-20 16:45:02 +0000 (Fri, 20 Mar 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_debuglog.c

Fix parsing the %z format specifier. Need to advance to next character.

------------------------------------------------------------------------
r15026 | florian | 2015-03-20 09:40:23 +0000 (Fri, 20 Mar 2015) | 2 lines
Changed paths:
   M /trunk/none/tests/s390x/Makefile.am

Add ecag.stdout.exp-z13.

------------------------------------------------------------------------
r15025 | florian | 2015-03-20 09:38:58 +0000 (Fri, 20 Mar 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/debuginfo.c
   M /trunk/coregrind/m_debuginfo/priv_storage.h
   M /trunk/coregrind/m_debuginfo/readdwarf.c
   M /trunk/coregrind/m_debuginfo/storage.c

Do not reuse Creg_IA_* for s390. Add dedicated entries Creg_S390_...

------------------------------------------------------------------------
r15024 | florian | 2015-03-20 08:17:28 +0000 (Fri, 20 Mar 2015) | 2 lines
Changed paths:
   D /trunk/nightly/conf/z10-ec.conf
   D /trunk/nightly/conf/z10-ec.sendmail
   D /trunk/nightly/conf/z900.conf
   D /trunk/nightly/conf/z900.sendmail

Remove config files for no-longer-existing s390 builds.

------------------------------------------------------------------------
r15023 | philippe | 2015-03-19 22:17:08 +0000 (Thu, 19 Mar 2015) | 20 lines
Changed paths:
   M /trunk/coregrind/m_transtab.c

Change TT/TC hashing data structure (decreases memory by 50MB for memcheck 32bits)

This patch changes the way the transtab entries hash table is done.
Currently, the hash table is an open hash table considered full at 65%.
This means that in average, 1 entry on 3 is unused.
(all the hash table memory will be 'active' for big applications,
as the active entries are normally reasonably distributed over the hash table).
The size of a transtab entry is significant (about 150 Bytes).

To avoid having 35% of the entries unused, the translation table
is split in 2:
An hash table, that will contain an index pointing at the transtab entries.
With this technique, we are adding a small hash table,
but we spare 35% of the translation table.

Performance measurements have shown no degradation,
and some platforms have better performance. Not too clear why,
probably this helps platforms with small caches ?).


------------------------------------------------------------------------
r15022 | mjw | 2015-03-19 11:27:46 +0000 (Thu, 19 Mar 2015) | 1 line
Changed paths:
   A /trunk/nightly/conf/lfedora1.conf
   A /trunk/nightly/conf/lfedora1.sendmail
   A /trunk/nightly/conf/wildebeest.conf
   A /trunk/nightly/conf/wildebeest.sendmail
   A /trunk/nightly/conf/wildebeest32.conf
   A /trunk/nightly/conf/wildebeest32.sendmail

Add nightly script for wildebeest[32] (debian x86), lfedora1 (fedora s390x)
------------------------------------------------------------------------
r15021 | cborntra | 2015-03-17 15:48:11 +0000 (Tue, 17 Mar 2015) | 2 lines
Changed paths:
   A /trunk/none/tests/s390x/ecag.stdout.exp-z13

add cache info for z13

------------------------------------------------------------------------
r15020 | florian | 2015-03-17 13:45:29 +0000 (Tue, 17 Mar 2015) | 2 lines
Changed paths:
   M /trunk/README.s390
   M /trunk/coregrind/m_machine.c
   M /trunk/tests/s390x_features.c

Minimal update to recognise z13 (s390).

------------------------------------------------------------------------
r15019 | florian | 2015-03-16 22:42:13 +0000 (Mon, 16 Mar 2015) | 4 lines
Changed paths:
   M /trunk/README_DEVELOPERS
   M /trunk/docs/README
   D /trunk/docs/internals/howto_build_documentation

Merge the contents of docs/internals/howto_build_documentation
into docs/README.
Remove the section about the XML Toolchain as it is outdated.

------------------------------------------------------------------------
r15018 | florian | 2015-03-16 22:03:42 +0000 (Mon, 16 Mar 2015) | 4 lines
Changed paths:
   M /trunk/memcheck/tests/sigaltstack.c

Increase the size of the alternate stack. It was too small.
This was found by accident and there is no known way to detect
an overflow of an alternate stack in the general case.

------------------------------------------------------------------------
r15017 | florian | 2015-03-16 12:22:35 +0000 (Mon, 16 Mar 2015) | 2 lines
Changed paths:
   M /trunk/README_DEVELOPERS
   A /trunk/docs/internals/howto_build_documentation

Add a howto for building documentation.

------------------------------------------------------------------------
r15016 | philippe | 2015-03-15 12:24:19 +0000 (Sun, 15 Mar 2015) | 5 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_main.c
   M /trunk/coregrind/m_transtab.c
   M /trunk/coregrind/pub_core_options.h
   M /trunk/coregrind/pub_core_transtab.h
   M /trunk/docs/xml/manual-core.xml
   M /trunk/none/tests/cmdline1.stdout.exp
   M /trunk/none/tests/cmdline2.stdout.exp

New Option --avg-transtab-entry-size=<number> can be used to tune
  the size of the translation table sectors, either to gain memory
  or to avoid too many retranslations.


------------------------------------------------------------------------
r15015 | philippe | 2015-03-15 12:22:43 +0000 (Sun, 15 Mar 2015) | 7 lines
Changed paths:
   M /trunk/memcheck/tests/Makefile.am

Fix the following errors detected by makefile check
memcheck/tests/Makefile.am:1: error: wrap8.stderr.exp-ppc64 is missing in EXTRA_DIST
memcheck/tests/Makefile.am:1: error: wrap8.stdout.exp-ppc64 is missing in EXTRA_DIST
memcheck/tests/Makefile.am:1: error: wrap8.stdout.exp2 is in EXTRA_DIST but doesn't exist
memcheck/tests/Makefile.am:1: error: wrap8.stderr.exp2 is in EXTRA_DIST but doesn't exist


------------------------------------------------------------------------
r15014 | philippe | 2015-03-14 18:29:35 +0000 (Sat, 14 Mar 2015) | 4 lines
Changed paths:
   M /trunk/tests/vg_regtest.in

Add option --loop-till-fail to tests/vg_regtests
to make it easier to obtain failing trace or unfiltered output for
tests that fail from time to time

------------------------------------------------------------------------
r15013 | florian | 2015-03-14 15:54:05 +0000 (Sat, 14 Mar 2015) | 3 lines
Changed paths:
   M /trunk/none/tests/filter_ioctl_moans
   M /trunk/none/tests/ioctl_moans.c
   M /trunk/none/tests/ioctl_moans.stderr.exp

Fix the testcase so it works on platforms where _IOC_NONE != 0
Filtering script and expected output file adapted.

------------------------------------------------------------------------
r15012 | florian | 2015-03-14 10:15:23 +0000 (Sat, 14 Mar 2015) | 8 lines
Changed paths:
   R /trunk/memcheck/tests/wrap8.stderr.exp (from /trunk/memcheck/tests/wrap8.stderr.exp2:15011)
   A /trunk/memcheck/tests/wrap8.stderr.exp-ppc64 (from /trunk/memcheck/tests/wrap8.stderr.exp:15011)
   D /trunk/memcheck/tests/wrap8.stderr.exp2
   R /trunk/memcheck/tests/wrap8.stdout.exp (from /trunk/memcheck/tests/wrap8.stdout.exp2:15011)
   A /trunk/memcheck/tests/wrap8.stdout.exp-ppc64 (from /trunk/memcheck/tests/wrap8.stdout.exp:15011)
   D /trunk/memcheck/tests/wrap8.stdout.exp2

Organise the expected output files for the wrap8 testcase.
There is special behaviout on ppc64 only. Let the filenames
reflect that. At the same time update the ppc specific
output to what it is. The important thing here is that the
stack overflow is detected. Everything else is effectively a
don't care. Should line numbers and such differ in the future
that should be filtered out.

------------------------------------------------------------------------
r15011 | florian | 2015-03-14 09:44:04 +0000 (Sat, 14 Mar 2015) | 14 lines
Changed paths:
   M /trunk/memcheck/tests/varinfo6.stderr.exp-ppc64

Update the ppc64 specific results to what they are.
The difference of the expected results as compared to other
platforms is

- Location 0x........ is 2 bytes inside local var "budget"
- declared at varinfo6.c:3115, in frame #2 of thread 1
+ Address 0x........ is on thread 1's stack
+ in frame #2, created by BZ2_blockSort (varinfo6.c:3107)

Should the stderr output of this testcase in the future 
match the generic output (varinfo6.stderr.exp) then this is
another incarnation of 
https://bugs.kde.org/show_bug.cgi?id=345121

------------------------------------------------------------------------
r15010 | florian | 2015-03-14 09:30:36 +0000 (Sat, 14 Mar 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-ppc64-linux.c
   M /trunk/memcheck/tests/linux/getregset.vgtest

Disable testcase because the ptrace system call is not 
supported on ppc64.

------------------------------------------------------------------------
r15009 | florian | 2015-03-13 13:50:08 +0000 (Fri, 13 Mar 2015) | 30 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/helgrind/hg_errors.c
   M /trunk/helgrind/tests/locked_vs_unlocked2.stderr.exp

Sort locks by their guestaddr to make the error output independent
of the dynamically allocated Lock addresses.
This restores helgrind/tests/locked_vs_unlocked2.stderr.exp
from r14931.

While regtesting the patch I've observed intermittent failures
of helgrind/tests/hg05_race2 like so:

--- ../../helgrind/tests/hg05_race2.stderr.exp  (revision 15001)
+++ ../../helgrind/tests/hg05_race2.stderr.exp  (working copy)
@@ -26,8 +26,7 @@
    at 0x........: th (hg05_race2.c:17)
    by 0x........: mythread_wrapper (hg_intercepts.c:...)
    ...
- Location 0x........ is 0 bytes inside foo.poot[5].plop[11],
- declared at hg05_race2.c:24, in frame #x of thread x
+ Address 0x........ is on thread #x's stack
 
 ----------------------------------------------------------------
 
@@ -42,8 +41,7 @@
    at 0x........: th (hg05_race2.c:17)
    by 0x........: mythread_wrapper (hg_intercepts.c:...)
    ...
- Location 0x........ is 0 bytes inside foo.poot[5].plop[11],
- declared at hg05_race2.c:24, in frame #x of thread x
+ Address 0x........ is on thread #x's stack

Surely, that's something else.

------------------------------------------------------------------------
r15008 | philippe | 2015-03-12 23:09:28 +0000 (Thu, 12 Mar 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_transtab.c

Fix a warnings introduced by rev 15005

------------------------------------------------------------------------
r15007 | philippe | 2015-03-12 22:53:18 +0000 (Thu, 12 Mar 2015) | 2 lines
Changed paths:
   M /trunk/NEWS

Announce in NEWS the new option --valgrind-stacksize

------------------------------------------------------------------------
r15006 | philippe | 2015-03-12 22:46:58 +0000 (Thu, 12 Mar 2015) | 5 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-common.c

Fix non portability spotted by Florian:
An array must have at least 1 element.
0 element is accepted by gcc but is not portable.


------------------------------------------------------------------------
r15005 | philippe | 2015-03-12 22:36:22 +0000 (Thu, 12 Mar 2015) | 8 lines
Changed paths:
   M /trunk/coregrind/m_transtab.c

m_transtab.c statistic/tracing
* common up the identical debug and clo_stat traces
* add in the stats the nr of sectors recycled
* add the avg translation size in each sector recycled
  and in the final statistics
(no functional change)


------------------------------------------------------------------------
r15004 | philippe | 2015-03-12 20:43:46 +0000 (Thu, 12 Mar 2015) | 8 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-common.c
   M /trunk/coregrind/m_libcassert.c
   M /trunk/coregrind/m_main.c
   M /trunk/coregrind/m_options.c
   M /trunk/coregrind/m_scheduler/scheduler.c
   M /trunk/coregrind/pub_core_aspacemgr.h
   M /trunk/coregrind/pub_core_options.h
   M /trunk/docs/xml/manual-core.xml
   M /trunk/memcheck/tests/err_disable4.vgtest
   M /trunk/none/tests/cmdline1.stdout.exp
   M /trunk/none/tests/cmdline2.stdout.exp

Implement command line option --valgrind-stacksize=<number>

This allows to decrease memory usage when using many threads,
if no big stacksize is needed by Valgrind.
If needed (e.g. for demangling big c++ symbols), the V stacksize
can be increased.


------------------------------------------------------------------------
r15003 | florian | 2015-03-12 18:56:21 +0000 (Thu, 12 Mar 2015) | 10 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/debuginfo.c
   M /trunk/exp-bbv/bbv_main.c

Fix two bugs:
(1) In r14664 VG_(get_fnname_if_entry) was changed to always
    return a function name, even if that function was *not* an
    entry. That broke callgrind and was also confusing because
    it contradicts what "get_fnname_if_entry" suggests.
(2) In r14189 a function call was removed because it was considered
    redundant which it was not.

Both bugs were hunted down by Joseph Weidendorfer.

------------------------------------------------------------------------
r15002 | florian | 2015-03-12 11:02:11 +0000 (Thu, 12 Mar 2015) | 2 lines
Changed paths:
   M /trunk/NEWS

Announce fix for BZ #345079.

------------------------------------------------------------------------
r15001 | florian | 2015-03-11 22:16:22 +0000 (Wed, 11 Mar 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/storage.c

Remove assertion. Unlikely as it may be, len may be huge
and therefore we cannot assert otherwise.

------------------------------------------------------------------------
r15000 | florian | 2015-03-11 13:46:14 +0000 (Wed, 11 Mar 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_main.c

Update a comment.

------------------------------------------------------------------------
r14999 | florian | 2015-03-10 21:31:06 +0000 (Tue, 10 Mar 2015) | 2 lines
Changed paths:
   M /trunk/docs/internals/release-HOWTO.txt

Update release notes with ICC contact.

------------------------------------------------------------------------
r14998 | florian | 2015-03-10 20:48:07 +0000 (Tue, 10 Mar 2015) | 2 lines
Changed paths:
   M /trunk/NEWS

Announce support for Intel's ICC compiler. Fixes BZ #339542.

------------------------------------------------------------------------
r14997 | florian | 2015-03-10 20:46:58 +0000 (Tue, 10 Mar 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/storage.c

Issue a warning if a function has more than 5 million bytes of
code. Previously functions exceeding that size were observed in the
field. Assert for 100x that amount.

------------------------------------------------------------------------
r14996 | carll | 2015-03-10 18:53:15 +0000 (Tue, 10 Mar 2015) | 9 lines
Changed paths:
   M /trunk/NEWS

Updated the NEWS file
   bugzilla  343597 - ppc64le: incorrect use of offseof macro  fixed 3/10/2015

Issue found by Florian Krohm who also suggested the fix.  The fix was 
made and tested by Carl Love.

VEX commit number 3100


------------------------------------------------------------------------
r14995 | florian | 2015-03-10 16:13:59 +0000 (Tue, 10 Mar 2015) | 8 lines
Changed paths:
   M /trunk/Makefile.all.am
   M /trunk/auxprogs/Makefile.am
   M /trunk/configure.ac
   M /trunk/coregrind/Makefile.am
   M /trunk/coregrind/m_compiler.c
   M /trunk/coregrind/m_libcbase.c
   M /trunk/memcheck/tests/vbit-test/Makefile.am

Add support for building with -fsanitize=undefined.
- add configure option --enable-ubsan 
- add __ubsan helpers (by Julian)

This requires gcc 4.9.2 or later. Not all platforms are supported, though.
With this change and VEX r3099 regression tests pass on amd64
with a valgrind compiled with -fsanitize=undefined.

------------------------------------------------------------------------
r14994 | sewardj | 2015-03-10 11:05:10 +0000 (Tue, 10 Mar 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-linux.c
   M /trunk/include/vki/vki-linux.h

PRE(sys_prctl): handle PR_SET_SECCOMP.

------------------------------------------------------------------------
r14993 | florian | 2015-03-07 23:01:14 +0000 (Sat, 07 Mar 2015) | 8 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/coregrind/m_mallocfree.c
   M /trunk/coregrind/m_translate.c
   M /trunk/coregrind/pub_core_aspacemgr.h

New function VG_(am_mmap_client_heap) which swallows
VG_(am_set_segment_isCH_if_SkAnonC).
Rename VG_(am_set_segment_hasT_if_client_segment) to
VG_(am_set_segment_hasT) passing in an address (because that function
cannot possible take a pointer to a *const* segment). Also assert that
the segment containing the address is a client segment. Everything else
is a bug.

------------------------------------------------------------------------
r14992 | philippe | 2015-03-07 19:20:12 +0000 (Sat, 07 Mar 2015) | 5 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/gdbserver_tests/mssnapshot.stderrB.exp
   M /trunk/gdbserver_tests/mssnapshot.stdinB.gdb
   M /trunk/massif/docs/ms-manual.xml
   M /trunk/massif/ms_main.c

342353 - Allow dumping full massif output while valgrind is still running

Patch from Andre Goddard Rosa


------------------------------------------------------------------------
r14991 | philippe | 2015-03-07 17:31:04 +0000 (Sat, 07 Mar 2015) | 6 lines
Changed paths:
   M /trunk/NEWS

update NEWS to indicate that
  335907  segfault when running wine's ddrawex/tests/surface.c under valgrind
is assumed to be fixed either by a previous change in 3.10
and/or by the commit for 343173


------------------------------------------------------------------------
r14990 | rhyskidd | 2015-03-07 14:57:39 +0000 (Sat, 07 Mar 2015) | 1 line
Changed paths:
   M /trunk/coregrind/launcher-darwin.c

n-i-bz: Replace non-POSIX bzero with proper memset. At least for internal-only, Darwin functionality. Picked up by cppcheck. No regressions within test suite.
------------------------------------------------------------------------
r14989 | rhyskidd | 2015-03-07 13:34:02 +0000 (Sat, 07 Mar 2015) | 11 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/darwin14.supp

Fix memcheck/tests/xml1 on OS X 10.10
bz#344939

Before

== 588 tests, 240 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

After

== 588 tests, 239 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

------------------------------------------------------------------------
r14988 | florian | 2015-03-07 12:49:32 +0000 (Sat, 07 Mar 2015) | 3 lines
Changed paths:
   M /trunk/none/tests/linux/stack-overflow.c
   M /trunk/none/tests/linux/stack-overflow.stderr.exp

Rewritten to use a single line instead of line splicing
to avoid line number differences in the reported error.

------------------------------------------------------------------------
r14987 | rhyskidd | 2015-03-07 08:36:20 +0000 (Sat, 07 Mar 2015) | 12 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/priv_syswrap-darwin.h
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c
   M /trunk/memcheck/tests/darwin
   M /trunk/memcheck/tests/darwin/Makefile.am
   A /trunk/memcheck/tests/darwin/pth-undocumented.c
   A /trunk/memcheck/tests/darwin/pth-undocumented.stderr.exp
   A /trunk/memcheck/tests/darwin/pth-undocumented.stdout.exp
   A /trunk/memcheck/tests/darwin/pth-undocumented.vgtest

Fix unhandled syscall: unix:348 (__pthread_chdir) and unhandled syscall: unix:349 (__pthread_fchdir) on OS X
bz#344512
- Support these two undocumented syscalls.
- New regression test case added.

Before:

== 588 tests, 239 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

After:

== 589 tests, 239 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==
------------------------------------------------------------------------
r14986 | rhyskidd | 2015-03-07 06:11:08 +0000 (Sat, 07 Mar 2015) | 1 line
Changed paths:
   M /trunk/memcheck/tests/darwin/deep_badparam.stderr.exp

Tweak test case for bz#344560 from r14985, now includes line numbers
------------------------------------------------------------------------
r14985 | rhyskidd | 2015-03-07 05:22:12 +0000 (Sat, 07 Mar 2015) | 16 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_stacktrace.c
   M /trunk/coregrind/m_syswrap/syswrap-main.c
   M /trunk/coregrind/pub_core_syswrap.h
   M /trunk/memcheck/tests/darwin
   M /trunk/memcheck/tests/darwin/Makefile.am
   A /trunk/memcheck/tests/darwin/deep_badparam.c
   A /trunk/memcheck/tests/darwin/deep_badparam.stderr.exp
   A /trunk/memcheck/tests/darwin/deep_badparam.stdout.exp
   A /trunk/memcheck/tests/darwin/deep_badparam.vgtest

Fix stack traces missing penultimate frame
bz#344560
- Also fixes memcheck/tests/badpoll test on OS X
- Problem occurs because the guest stack seen in a system call pre or post
  function happens to not have a correct topmost stack frame, as Darwin system
  call stubs do not start with the usual function prolog.
- New regression test case added.
- Thanks to Greg Banks for research, patch and test case.

Before:

== 587 tests, 240 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

After:

== 588 tests, 239 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==
------------------------------------------------------------------------
r14984 | rhyskidd | 2015-03-07 01:21:28 +0000 (Sat, 07 Mar 2015) | 1 line
Changed paths:
   M /trunk/helgrind/tests
   M /trunk/helgrind/tests/stackteardown.c

n-i-bz: Small fixes to r14976 (bz#343173) to add stackteardown to svn:ignore and fix compilation on OS X
------------------------------------------------------------------------
r14983 | sewardj | 2015-03-06 09:20:51 +0000 (Fri, 06 Mar 2015) | 2 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/docs/internals/3_10_BUGSTATUS.txt

Update.

------------------------------------------------------------------------
r14982 | sewardj | 2015-03-06 09:19:38 +0000 (Fri, 06 Mar 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/image.c

Update comment about range checks with observations from Florian.
No functional change.

------------------------------------------------------------------------
r14981 | sewardj | 2015-03-05 11:28:57 +0000 (Thu, 05 Mar 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_transtab.c

Make printing of transtab: debug-log messages slightly prettier.
No functional change.

------------------------------------------------------------------------
r14980 | sewardj | 2015-03-05 11:25:52 +0000 (Thu, 05 Mar 2015) | 2 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/docs/internals/3_10_BUGSTATUS.txt

Update.

------------------------------------------------------------------------
r14979 | sewardj | 2015-03-05 11:24:05 +0000 (Thu, 05 Mar 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_sigframe/sigframe-arm-linux.c

Marginally improve debug printing.  No functional change.

------------------------------------------------------------------------
r14978 | sewardj | 2015-03-05 11:22:41 +0000 (Thu, 05 Mar 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-linux.c

POST(sys_ioctl): identify kernel variant "Qualcomm Adreno 3xx" correctly.

------------------------------------------------------------------------
r14977 | sewardj | 2015-03-05 00:52:07 +0000 (Thu, 05 Mar 2015) | 14 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/image.c

Minor changes in an attempt to improve performance and reduce
the amount of file-reading resulting from DiImage-cache misses.

CACHE_N_ENTRIES:
Increase the DiImage cache size from 256KB to 8MB to deal with
drastically worse locality when reading inline info.  The 256KB
setting dates from befre inline-info-reading days.

is_in_CEnt: remove a conditional branch from the hot path (of |get|,
effectively)

set_CEnt: marginally improve debug printing


------------------------------------------------------------------------
r14976 | philippe | 2015-03-03 22:00:06 +0000 (Tue, 03 Mar 2015) | 16 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_stacks.c
   M /trunk/helgrind/tests/Makefile.am
   A /trunk/helgrind/tests/stackteardown.c
   A /trunk/helgrind/tests/stackteardown.stderr.exp
   A /trunk/helgrind/tests/stackteardown.stdout.exp
   A /trunk/helgrind/tests/stackteardown.vgtest

Fix 343173 - helgrind crash during stack unwind

This fixes a helgrind crash detected on android.
Android bionic pthread lib unmaps the stack for detached threads
before exiting.
Helgrind tries to unwind the stack to record a 'read' after
the stack unmap, just before the exit syscall.
The unwind then causes a SEGV.

The solution consists in tightening the calculation of
the stack limits, so as to stop unwinding when no valid stack
can be found.
Regression test reproduces the same problem by simulating the
bionic behaviour on linux, using asm similar to bionic lib.


------------------------------------------------------------------------
r14975 | florian | 2015-03-03 14:58:29 +0000 (Tue, 03 Mar 2015) | 2 lines
Changed paths:
   M /trunk/none/tests/linux

Update list of ignored files.

------------------------------------------------------------------------
r14974 | florian | 2015-03-03 14:56:17 +0000 (Tue, 03 Mar 2015) | 6 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-amd64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-arm-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-arm64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-mips32-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-mips64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-ppc32-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-ppc64-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-s390x-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-x86-linux.c
   M /trunk/coregrind/m_signals.c
   M /trunk/coregrind/m_syswrap/syswrap-generic.c
   M /trunk/coregrind/m_syswrap/syswrap-main.c
   M /trunk/coregrind/pub_core_aspacemgr.h
   M /trunk/coregrind/pub_core_signals.h
   M /trunk/none/tests/linux/Makefile.am
   A /trunk/none/tests/linux/stack-overflow.c
   A /trunk/none/tests/linux/stack-overflow.stderr.exp
   A /trunk/none/tests/linux/stack-overflow.vgtest

Produce a user message in case of stack overflow.
Change VG_(extend_stack) and VG_(am_extend_into_adjacent_reservation_client)
accordingly. 
Remove some redundant checking.
Add testcase.

------------------------------------------------------------------------
r14973 | florian | 2015-03-02 21:10:46 +0000 (Mon, 02 Mar 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_signals.c
   M /trunk/coregrind/m_syswrap/syswrap-main.c

Update a comment. Apparently the code was refactored at some point...

------------------------------------------------------------------------
r14972 | rhyskidd | 2015-03-01 13:22:21 +0000 (Sun, 01 Mar 2015) | 13 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/darwin14.supp

Fix missing libobjc suppressions on OS X 10.10
bz#344702
- Update darwin14.supp suppressions
- Includes malloc_zone_malloc and malloc related issues in system libraries

Before

== 585 tests, 256 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

After

== 585 tests, 240 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

------------------------------------------------------------------------
r14971 | florian | 2015-03-01 09:36:54 +0000 (Sun, 01 Mar 2015) | 2 lines
Changed paths:
   M /trunk/none/tests/s390x/stmg.c
   M /trunk/none/tests/s390x/stmg.stdout.exp

Change the testcase such that the output matches the intended output.

------------------------------------------------------------------------
r14970 | rhyskidd | 2015-03-01 01:35:59 +0000 (Sun, 01 Mar 2015) | 11 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/darwin14.supp

Fix suppression for pthread_rwlock_init on OS X 10.10
bz#344686
- Update darwin14.supp to match prior OS X versions

Before

== 585 tests, 257 stderr failures, 23 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

After

== 585 tests, 256 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==
------------------------------------------------------------------------
r14969 | florian | 2015-02-28 09:22:09 +0000 (Sat, 28 Feb 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_translate.c
   M /trunk/helgrind/libhb_core.c
   M /trunk/memcheck/mc_machine.c

Fix a few compiler warnings issued by clang 3.6.0

------------------------------------------------------------------------
r14968 | rhyskidd | 2015-02-27 11:34:07 +0000 (Fri, 27 Feb 2015) | 13 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/memcheck/tests/err_disable4.c
   M /trunk/memcheck/tests/err_disable4.stderr.exp

Fix memcheck/tests/err_disable4 test on OS X
bz#344621
- Unnamed semaphores are not supported on OS X, must use named semaphores.
- To use named semaphores sem_open() instead of sem_init() utilised.
- Test case updated accordingly across all platforms.

Before:

== 586 tests, 240 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==

After:

== 586 tests, 239 stderr failures, 22 stdout failures, 0 stderrB failures, 0 stdoutB failures, 31 post failures ==
------------------------------------------------------------------------
r14967 | florian | 2015-02-26 21:48:19 +0000 (Thu, 26 Feb 2015) | 12 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-generic.c

Simplify do_brk
- remove redundant asserts
- let VG_(am_extend_into_adjacent_reservation_client) worry about
  - whether delta is too large
  - whether the segment abutting this one exists and is a reservation
    segment
  The function already checks these things. No need to do it again here.
- do_brk does not need to know that a reservation segment must not
  shrink beyond a single page. That detail ought to be hidden in
  the address space manager.
Also, turn a few conditions into asserts.

------------------------------------------------------------------------
r14966 | florian | 2015-02-26 17:48:07 +0000 (Thu, 26 Feb 2015) | 3 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_addrinfo.c
   M /trunk/coregrind/m_gdbserver/remote-utils.c
   M /trunk/coregrind/m_gdbserver/server.c
   M /trunk/coregrind/m_gdbserver/server.h
   M /trunk/coregrind/m_gdbserver/valgrind-low-amd64.c
   M /trunk/coregrind/m_gdbserver/valgrind-low-arm.c
   M /trunk/coregrind/m_gdbserver/valgrind-low-arm64.c
   M /trunk/coregrind/m_gdbserver/valgrind-low-mips32.c
   M /trunk/coregrind/m_gdbserver/valgrind-low-mips64.c
   M /trunk/coregrind/m_gdbserver/valgrind-low-ppc32.c
   M /trunk/coregrind/m_gdbserver/valgrind-low-ppc64.c
   M /trunk/coregrind/m_gdbserver/valgrind-low-s390x.c
   M /trunk/coregrind/m_gdbserver/valgrind-low-x86.c
   M /trunk/include/pub_tool_addrinfo.h

Include pub_core_aspacemgr.h only where needed.
Also fixes BZ #344235.

------------------------------------------------------------------------
r14965 | florian | 2015-02-26 16:07:12 +0000 (Thu, 26 Feb 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/coregrind/m_signals.c
   M /trunk/coregrind/m_syswrap/syswrap-generic.c
   M /trunk/coregrind/pub_core_aspacemgr.h

Change the prototype of VG_(am_extend_into_adjacent_reservation_client)
to match VG_(am_extend_map_client) for consistency.

------------------------------------------------------------------------
r14964 | mjw | 2015-02-25 14:00:14 +0000 (Wed, 25 Feb 2015) | 8 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/priv_syswrap-linux.h
   M /trunk/coregrind/m_syswrap/syswrap-linux.c
   M /trunk/include/vki/vki-linux.h

Bug #344318 socketcall should wrap recvmmsg and sendmmsg

Some architectures, e.g. s390, don't have dedicated recvmmsg and sendmmsg
system calls, but use the socketcall multiplexing system call with
SYS_RECVMMSG or SYS_SENDMMSG (just like the accept4 systemcall can also
be called through socketcall). Create separate helpers for recvmmsg and
sendmmsg helpers that can be used by either the direct syscall or the
socket call.
------------------------------------------------------------------------
r14963 | florian | 2015-02-25 10:06:06 +0000 (Wed, 25 Feb 2015) | 18 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-generic.c
   M /trunk/coregrind/pub_core_aspacemgr.h

Change VG_(am_extend_map_client) as follows:
- Tighten up on asserts
- Simplify; as the function grows memory into a free segment, there
  cannot possibly be any translations to be discarded. Free segments
  do not have translations. sane_NSegment will make sure.
- Change the prototype to take in the start address of the mapping and
  return a pointer to the resized segment. Previously, the code 

   ok = VG_(am_extend_map_client)( &d, old_seg, needL );
   if (!ok)
      goto eNOMEM;
   VG_TRACK( new_mem_mmap, needA, needL, 
                           old_seg->hasR, old_seg->hasW, old_seg->hasX,

  was examining old_seg->hasR etc even though VG_(am_extend_map_client)
  stated that *old_seg was invalid after the function returned.
  That wasn't exactly a problem, but clearly looked wrong.

------------------------------------------------------------------------
r14962 | florian | 2015-02-24 18:11:01 +0000 (Tue, 24 Feb 2015) | 4 lines
Changed paths:
   M /trunk/none/tests/s390x/fpext_warn.c
   M /trunk/none/tests/s390x/fpext_warn.stderr.exp

Add a comment explaining why there are only 3 emulation warnings
and not 4 as one would expect. 
Update the .exp file to show correct line numbers.

------------------------------------------------------------------------
r14961 | florian | 2015-02-24 17:17:19 +0000 (Tue, 24 Feb 2015) | 4 lines
Changed paths:
   M /trunk/memcheck/tests/vbit-test/irops.c

Update opcode list following VEX r3092.
Add an assertion to trigger a compile time error in case this
happens again.

------------------------------------------------------------------------
r14960 | sewardj | 2015-02-24 13:24:52 +0000 (Tue, 24 Feb 2015) | 3 lines
Changed paths:
   M /trunk/none/tests/arm64/fp_and_simd.c
   M /trunk/none/tests/arm64/fp_and_simd.stdout.exp

arm64: enable test cases for conversion instructions which are
in fact implemented at this point.

------------------------------------------------------------------------
r14959 | sewardj | 2015-02-24 12:24:35 +0000 (Tue, 24 Feb 2015) | 8 lines
Changed paths:
   M /trunk/memcheck/mc_translate.c

Handle new IROps added in vex r3092:
Iop_RecipStep64Fx2, Iop_RSqrtStep64Fx2 
Iop_RSqrtEst64Fx2,  Iop_RecipEst64Fx2 
Iop_RecpExpF64,     Iop_RecpExpF32 
 --This line, and those below, will be ignored--

M    memcheck/mc_translate.c

------------------------------------------------------------------------
r14958 | sewardj | 2015-02-24 12:21:26 +0000 (Tue, 24 Feb 2015) | 15 lines
Changed paths:
   M /trunk/none/tests/arm64/fp_and_simd.c
   M /trunk/none/tests/arm64/fp_and_simd.stdout.exp

arm64: enable test cases for
FRECPS  d_d_d, s_s_s 
FRSQRTS d_d_d, s_s_s 
FRECPE  d_d, s_s 
FRSQRTE d_d, s_s 
FRECPX  d_d, s_s 
FRECPS  2d_2d_2d, 4s_4s_4s, 2s_2s_2s 
FRSQRTS 2d_2d_2d, 4s_4s_4s, 2s_2s_2s 
FRECPE  2d_2d, 4s_4s, 2s_2s 
FRSQRTE 2d_2d, 4s_4s, 2s_2s 
 --This line, and those below, will be ignored--

M    none/tests/arm64/fp_and_simd.c
M    none/tests/arm64/fp_and_simd.stdout.exp

------------------------------------------------------------------------
r14957 | florian | 2015-02-24 11:23:51 +0000 (Tue, 24 Feb 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Fix an off-by-one error - this time, do it right. 
A segment with start == end is not empty.

------------------------------------------------------------------------
r14956 | florian | 2015-02-23 21:56:16 +0000 (Mon, 23 Feb 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Revert r14954. If the end of a segment is 0xfffff.....fffff
then end + 1 == 0 and any start address will be >= end.
Think some more.....

------------------------------------------------------------------------
r14955 | cborntra | 2015-02-23 20:19:03 +0000 (Mon, 23 Feb 2015) | 4 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/configure.ac

Fix configure for Linux kernel >= 4.0-rc1
In addition raise the minimal Linux version to 2.6 as there is almost
no test coverage for 2.4 and 2.6 was released in 2003.

------------------------------------------------------------------------
r14954 | florian | 2015-02-23 19:57:12 +0000 (Mon, 23 Feb 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Fix an off-by-one error. A segment with start == end is not
empty.

------------------------------------------------------------------------
r14953 | sewardj | 2015-02-23 13:58:55 +0000 (Mon, 23 Feb 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/readpdb.c

Stop gcc -Og complaining (incorrectly) about filessize being used
uninitialised.  No functional change.

------------------------------------------------------------------------
r14952 | rhyskidd | 2015-02-22 00:42:52 +0000 (Sun, 22 Feb 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/priv_syswrap-darwin.h
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c

Fix bz#343523, OS X mach_ports_register: UNKNOWN task message [id 3403, to mach_task_self(), reply 0x30f]
------------------------------------------------------------------------
r14951 | rhyskidd | 2015-02-21 12:24:18 +0000 (Sat, 21 Feb 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/priv_syswrap-darwin.h
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c
   M /trunk/include/vki/vki-darwin.h
   M /trunk/include/vki/vki-scnums-darwin.h

Fix OS X 10.10 (Yosemite) - missing system calls and fcntl code, courtesy of Bill Zissimopoulos
------------------------------------------------------------------------
r14950 | florian | 2015-02-20 16:46:50 +0000 (Fri, 20 Feb 2015) | 2 lines
Changed paths:
   M /trunk/memcheck/mc_leakcheck.c

Update a comment.

------------------------------------------------------------------------
r14949 | florian | 2015-02-20 14:00:23 +0000 (Fri, 20 Feb 2015) | 29 lines
Changed paths:
   M /trunk/coregrind/m_aspacehl.c
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/coregrind/m_coredump/coredump-elf.c
   M /trunk/coregrind/m_main.c
   M /trunk/include/pub_tool_aspacehl.h
   M /trunk/include/pub_tool_aspacemgr.h
   M /trunk/memcheck/mc_leakcheck.c

Pass in a mask of segment kinds to VG_(get_segment_starts)
and VG_(am_get_segment_starts) to indicate which segments
should be collected. That should solve the following problem:
in m_main.c we used to:

      seg_starts = VG_(get_segment_starts)( &n_seg_starts );

      for (i = 0; i < n_seg_starts; i++) {
         Word j, n;
         NSegment const* seg 
            = VG_(am_find_nsegment)( seg_starts[i] );
         vg_assert(seg);
         if (seg->kind == SkFileC || seg->kind == SkAnonC) {

         ...
         // ... dynamic memory allocation for valgrind
         ...
      }

This caused the vassert(seg) to fire because the dynamic memory
allocation further down the loop changed segments such that a 
valgrind segment which used to be non-SkFree suddenly became 
SkFree and hence VG_(am_find_nsegment) returned NULL. Whoom.

With this revision we only collect the segments we're really
interested in. For the example above that is all client segments.
So if V allocates memory -- fine. That will not change the layout
of client segments.

------------------------------------------------------------------------
r14948 | sewardj | 2015-02-20 12:29:59 +0000 (Fri, 20 Feb 2015) | 5 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/storage.c

canonicaliseSymtab: fix silly logic that could cause the function to
loop forever.  In particular, it will do that when two symbols have
exactly the same address range but differ in their .isText attribute.
Fixes #342117.

------------------------------------------------------------------------
r14947 | weidendo | 2015-02-18 16:28:58 +0000 (Wed, 18 Feb 2015) | 5 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/callgrind/dump.c

Fix Bug #344314  callgrind_annotate ... commands containing newlines

Escape newlines in command arguments for "cmd:" header field in dumps
We could do unescaping in callgrind_annotate, but a escaped command
even seems better there.
------------------------------------------------------------------------
r14946 | sewardj | 2015-02-18 15:46:19 +0000 (Wed, 18 Feb 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-linux.c
   M /trunk/include/vki/vki-linux.h

Correctly handle prctl(VKI_PR_SET_PTRACER, ..) so as to avoid false
positives (eg when running Wine).

------------------------------------------------------------------------
r14945 | sewardj | 2015-02-18 15:38:25 +0000 (Wed, 18 Feb 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/readpdb.c

Messaging cleanup for the PDB reader.  No functional change.

------------------------------------------------------------------------
r14944 | mjw | 2015-02-18 14:23:17 +0000 (Wed, 18 Feb 2015) | 5 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-arm64-linux.c

Bug #344307 2 unhandled syscalls on aarch64/arm64: umount2(39), mount (40)

Reporter: Branislav Blaskovic, bblaskov@redhat.com
Patch: Robin Hack, rhack@redhat.com
Test: Miloš Prchlík, mprchlik@redhat.com
------------------------------------------------------------------------
r14943 | sewardj | 2015-02-18 12:58:56 +0000 (Wed, 18 Feb 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/debuginfo.c

For PDB stats printing, don't print the number of inl-info records,
since it's always zero.

------------------------------------------------------------------------
r14942 | sewardj | 2015-02-18 12:57:06 +0000 (Wed, 18 Feb 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/readpdb.c

Improve string table reading for MSVC2010 compiled code.  Also seems
to help with MSVC2013 compiled code.  Variant of a patch from
Mark Browning (mabrowningrr@gmail.com).  Fixes #211529.

------------------------------------------------------------------------
r14941 | florian | 2015-02-17 21:51:53 +0000 (Tue, 17 Feb 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Update a comment.

------------------------------------------------------------------------
r14940 | mjw | 2015-02-17 19:50:45 +0000 (Tue, 17 Feb 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-arm64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-ppc32-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-ppc64-linux.c

Bug #344295 syscall recvmmsg on arm64 (243) and ppc32/64 (343) unhandled
------------------------------------------------------------------------
r14939 | mjw | 2015-02-17 16:04:09 +0000 (Tue, 17 Feb 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-arm64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-ppc32-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-ppc64-linux.c

Bug #344279 syscall sendmmsg on arm64 (269) and ppc32/64 (349) unhandled.
------------------------------------------------------------------------
r14938 | sewardj | 2015-02-17 13:46:26 +0000 (Tue, 17 Feb 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/readpdb.c

ML_(find_name_of_pdb_file): bit a bit more careful when grepping the
output from /usr/bin/strings, so as to not get confused by substrings
".pdb" and ".PDB" when they don't appear at the end of a line.

------------------------------------------------------------------------
r14937 | florian | 2015-02-16 23:04:53 +0000 (Mon, 16 Feb 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Update comment for VG_(am_find_nsegment) to match the code.
Likewise for VG_(am_next_nsegment). Also make the code similar to
VG_(am_find_nsegment) for easier comprehension.

------------------------------------------------------------------------
r14936 | florian | 2015-02-16 22:58:30 +0000 (Mon, 16 Feb 2015) | 5 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/coregrind/m_translate.c
   M /trunk/coregrind/pub_core_aspacemgr.h
   M /trunk/include/pub_tool_aspacemgr.h

Translations are allowed from all client segments. Update comments
and rename VG_(am_set_segment_hasT_if_SkFileC_or_SkAnonC) to 
VG_(am_set_segment_hasT_if_client_segment). Change it so it handles
all client segments.

------------------------------------------------------------------------
r14935 | florian | 2015-02-16 22:29:03 +0000 (Mon, 16 Feb 2015) | 2 lines
Changed paths:
   M /trunk/include/pub_tool_aspacemgr.h

Update a few comments.

------------------------------------------------------------------------
r14934 | florian | 2015-02-16 21:55:52 +0000 (Mon, 16 Feb 2015) | 2 lines
Changed paths:
   M /trunk/docs/xml/manual-core.xml

Document the --max-threads command line option.

------------------------------------------------------------------------
r14933 | florian | 2015-02-14 21:17:46 +0000 (Sat, 14 Feb 2015) | 7 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Misc tweaks in segAddr_to_index:
(1) It is always invalid for the incoming segment pointer to be
    out of range. Assert that.
(2) Let the compiler do the address arithmetic. They're good at that
    and therefore:
(3) No asserts needed to check the result.

------------------------------------------------------------------------
r14932 | florian | 2015-02-13 19:08:26 +0000 (Fri, 13 Feb 2015) | 4 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/callgrind/main.c
   M /trunk/callgrind/threads.c
   M /trunk/coregrind/m_main.c
   M /trunk/coregrind/m_options.c
   M /trunk/coregrind/m_scheduler/scheduler.c
   M /trunk/coregrind/m_syswrap/syswrap-main.c
   M /trunk/coregrind/m_threadstate.c
   M /trunk/coregrind/pub_core_options.h
   M /trunk/coregrind/pub_core_threadstate.h
   M /trunk/drd/drd_thread.c
   M /trunk/drd/drd_thread.h
   M /trunk/exp-sgcheck/sg_main.c
   M /trunk/helgrind/tests/locked_vs_unlocked2.stderr.exp
   M /trunk/include/pub_tool_threadstate.h
   M /trunk/none/tests/cmdline1.stdout.exp
   M /trunk/none/tests/cmdline2.stdout.exp

Add command line flag --max-threads=<integer> to increase the number of
threads that valgrind can handle. No recompile is needed. 
Part of fixing BZ #337869.

------------------------------------------------------------------------
r14931 | florian | 2015-02-13 17:05:57 +0000 (Fri, 13 Feb 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_scheduler/scheduler.c
   M /trunk/coregrind/pub_core_threadstate.h

More use of LibVEX_GUEST_STATE_ALIGN.

------------------------------------------------------------------------
r14930 | florian | 2015-02-13 16:26:44 +0000 (Fri, 13 Feb 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_threadstate.c
   M /trunk/coregrind/pub_core_threadstate.h

Use LibVEX_GUEST_STATE_ALIGN introduced in VEX r3091.

------------------------------------------------------------------------
r14929 | sewardj | 2015-02-11 19:46:27 +0000 (Wed, 11 Feb 2015) | 5 lines
Changed paths:
   M /trunk/include/valgrind.h

arm32-linux: for the magic-call CALL_FN_* macros, add r12 to the asm
trash list.  Not doing so was causing r12 to get corrupted by the
called function, which lead to some very strange failures in Helgrind
on arm32.  Fixes #344033.

------------------------------------------------------------------------
r14928 | sewardj | 2015-02-11 00:49:45 +0000 (Wed, 11 Feb 2015) | 5 lines
Changed paths:
   M /trunk/coregrind/m_libcassert.c

arm32-linux: GET_STARTREGS has always been wrong on this target,
confusing SP and LR and resulting in no backtraces during internal
assertion failures etc on this platform.  Fixes #343219.  Noticed by
dimitry@google.com.

------------------------------------------------------------------------
r14927 | sewardj | 2015-02-11 00:41:48 +0000 (Wed, 11 Feb 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_debuglog.c

arm32: local_sys_write_stderr and local_sys_getpid: don't trash r7
in the inline assembly, because gcc doesn't like that when compiling
for Thumb.  And this file is compiled for Thumb during "make check".

------------------------------------------------------------------------
r14926 | mjw | 2015-02-10 13:39:04 +0000 (Tue, 10 Feb 2015) | 6 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-arm64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-ppc64-linux.c

Bug #344007 accept4 syscall unhandled on arm64 (242) and ppc64 (344)

ppc64 might fall back to socketcall in some cases, but arm64 always uses
accept4 syscall directly. Some (confusing) background on when/how glibc
(wrongly) decides to use a direct accept4 or the socketcall system call:
https://sourceware.org/ml/libc-alpha/2013-12/msg00014.html
------------------------------------------------------------------------
r14925 | florian | 2015-02-09 21:59:00 +0000 (Mon, 09 Feb 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/readdwarf.c

Fix a bug introduced in r14913.

------------------------------------------------------------------------
r14924 | philippe | 2015-02-09 21:30:58 +0000 (Mon, 09 Feb 2015) | 5 lines
Changed paths:
   M /trunk/coregrind/m_gdbserver/remote-utils.c
   M /trunk/coregrind/pub_core_gdbserver.h
   M /trunk/coregrind/vgdb-invoker-ptrace.c

Ensure vgdb gets the nr of threads from Valgrind via shared memory,
rather than using a compile time constant.
This is in preparation for a future change by Florian, to have
the max nr of threads specifiable at startup via a clo

------------------------------------------------------------------------
r14923 | mjw | 2015-02-09 20:41:48 +0000 (Mon, 09 Feb 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_debuginfo/priv_d3basics.h
   M /trunk/coregrind/m_debuginfo/readdwarf3.c

Bug #343978 Recognize DWARF5/GCC5 DW_LANG_Fortran 2003 and 2008 constants.
------------------------------------------------------------------------
r14922 | mjw | 2015-02-09 13:27:07 +0000 (Mon, 09 Feb 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_libcfile.c

Bug #343967 Don't warn about setuid/setgid/setcap exec for dirs.
------------------------------------------------------------------------
r14921 | sewardj | 2015-02-09 09:15:00 +0000 (Mon, 09 Feb 2015) | 2 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/docs/internals/3_10_BUGSTATUS.txt

Update.

------------------------------------------------------------------------
r14920 | sewardj | 2015-02-09 09:10:27 +0000 (Mon, 09 Feb 2015) | 5 lines
Changed paths:
   M /trunk/none/tests/arm64/fp_and_simd.c
   M /trunk/none/tests/arm64/fp_and_simd.stdout.exp

Enable test cases for
  FMOV (vector, immediate, single precision) 
  {FRINTN,FRINTM,FRINTP,FRINTZ,FRINTA,FRINTX,FRINTI} 2d_2d, 4s_4s, 2s_2s 
  {FRINTN,FRINTM,FRINTP,FRINTZ,FRINTA,FRINTX,FRINTI} d_d, s_s 

------------------------------------------------------------------------
r14919 | sewardj | 2015-02-08 18:26:05 +0000 (Sun, 08 Feb 2015) | 11 lines
Changed paths:
   M /trunk/none/tests/arm64/fp_and_simd.c
   M /trunk/none/tests/arm64/fp_and_simd.stdout.exp

Enable test cases for all remaining FP multiply instructions:
  FMULX d_d_d, s_s_s 
  FMLA d_d_d[], s_s_s[] 
  FMLS d_d_d[], s_s_s[] 
  FMUL  d_d_d[], s_s_s[] 
  FMULX d_d_d[], s_s_s[] 
  FMULX 2d_2d_2d, 4s_4s_4s, 2s_2s_2s 
  FMULX 2d_2d_d[], 4s_4s_s[], 2s_2s_s[] 
and possibly more.


------------------------------------------------------------------------
r14918 | sewardj | 2015-02-08 12:11:52 +0000 (Sun, 08 Feb 2015) | 7 lines
Changed paths:
   M /trunk/none/tests/arm64/fp_and_simd.c
   M /trunk/none/tests/arm64/fp_and_simd.stdout.exp

Enable test cases:
  {FMADD,FNMADD,FMSUB,FNMSUB} d_d_d_d, s_s_s_s 
  {FMAXMNV,FMINMNV,FMAXV,FMINV} s_4s 
  {FMAXNMP,FMINNMP,FMAXP,FMINP} d_2d, s_2s 
  {FMAXNM,FMINNM,FMAX,FMIN} 2d_2d_2d, 4s_4s_4s, 2s_2s_2s 
  {FMAXNMP,FMINNMP,FMAXP,FMINP} 2d_2d_2d, 4s_4s_4s, 2s_2s_2s 

------------------------------------------------------------------------
r14917 | mjw | 2015-02-07 22:58:51 +0000 (Sat, 07 Feb 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-arm64-linux.c

Bug 343733 Unhandled syscall 187 (msgctl and related) on aarch64
------------------------------------------------------------------------
r14916 | mjw | 2015-02-07 22:36:48 +0000 (Sat, 07 Feb 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-arm64-linux.c

Bug 343732 - Unhandled syscall 144 (setgid) on aarch64.
------------------------------------------------------------------------
r14915 | sewardj | 2015-02-07 21:12:04 +0000 (Sat, 07 Feb 2015) | 9 lines
Changed paths:
   M /trunk/none/tests/arm64/fp_and_simd.c
   M /trunk/none/tests/arm64/fp_and_simd.stdout.exp

Enable test cases for all FP compare instructions:
{FCMEQ,FCMGE,FCMGT,FACGE,FACGT} d_d_d, s_s_s 
{FCMEQ,FCMGE,FCMGT,FACGE,FACGT} d_d_#0.0, s_s_#0.0 
{FCMEQ,FCMGE,FCMGT,FACGE,FACGT} 2d_2d_#0.0, 4s_4s_#0.0, 2s_2s_#0.0 
{FCCMP,FCCMPE} s_s, d_d 
{FCMP,FCMPE} d_d, s_s 
{FCMP,FCMPE} d_#0.0, s_#0.0 


------------------------------------------------------------------------
r14914 | florian | 2015-02-06 20:33:51 +0000 (Fri, 06 Feb 2015) | 2 lines
Changed paths:
   M /trunk/memcheck/tests/vbit-test/Makefile.am

Revert accidental checkin for Makefile.am

------------------------------------------------------------------------
r14913 | florian | 2015-02-06 20:32:15 +0000 (Fri, 06 Feb 2015) | 3 lines
Changed paths:
   M /trunk/callgrind/sim.c
   M /trunk/coregrind/m_debuginfo/readdwarf.c
   M /trunk/coregrind/m_gdbserver/target.c
   M /trunk/memcheck/tests/vbit-test/Makefile.am
   M /trunk/memcheck/tests/vbit-test/vbits.c

Fix undefined behaviours when shifting.
Found by libubsan.

------------------------------------------------------------------------
r14912 | florian | 2015-02-06 20:25:57 +0000 (Fri, 06 Feb 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_demangle/cp-demangle.c

There must be at least one element in a VLA.
Found by libubsan.

------------------------------------------------------------------------
r14911 | philippe | 2015-02-05 22:30:57 +0000 (Thu, 05 Feb 2015) | 7 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Fix debug output of aspacemgr
The list of segnames was shown with a seq nr,
while each segment was referencing its segname with an offset.
The patch ensures that at all places, both the seq nr and the
offset is output


------------------------------------------------------------------------
r14910 | sewardj | 2015-02-05 16:22:43 +0000 (Thu, 05 Feb 2015) | 2 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/docs/internals/3_10_BUGSTATUS.txt

Update.

------------------------------------------------------------------------
r14909 | sewardj | 2015-02-05 15:59:01 +0000 (Thu, 05 Feb 2015) | 3 lines
Changed paths:
   M /trunk/include/vki/vki-linux.h

Update to track v4l2 API for kernel version 3.19 changes.  Patch from
Hans Verkuil (hverkuil@xs4all.nl).  Fixes #343069.

------------------------------------------------------------------------
r14908 | sewardj | 2015-02-05 15:52:46 +0000 (Thu, 05 Feb 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-linux.c
   M /trunk/include/vki/vki-linux.h

Add wrapper support for I2C_SMBUS ioctls.  Patch from
super.firetwister@gmail.com.  Fixes #342603.

------------------------------------------------------------------------
r14907 | sewardj | 2015-02-05 15:28:28 +0000 (Thu, 05 Feb 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-arm64-linux.c

Enable sys_mbind, sys_get_mempolicy, sys_set_mempolicy on arm64-linux.
Patch from Hideaki Kimura (hideaki.kimura@gmail.com).  Fixes #342038.

------------------------------------------------------------------------
r14906 | sewardj | 2015-02-05 12:59:46 +0000 (Thu, 05 Feb 2015) | 19 lines
Changed paths:
   M /trunk/cachegrind/cg_main.c
   M /trunk/callgrind/main.c
   M /trunk/coregrind/m_main.c
   M /trunk/coregrind/m_options.c
   M /trunk/coregrind/m_translate.c
   M /trunk/include/pub_tool_options.h
   M /trunk/massif/ms_main.c
   M /trunk/none/tests/cmdline2.stdout.exp

Allow the user to specify precise-exception behaviour for translations
made from file-backed mappings (AOT code, basically) that is different
from the default behaviour as specified by --vex-iropt-register-updates.

New flag is --px-file-backed=, with the same possible args as
--vex-iropt-register-updates has.

Add a new flag --px-default, which is a short alias for
--vex-iropt-register-updates.

Add one line of stats output when --stats=yes, showing counts of how
many translations have been made under each of the 4 different PX
optimisation settings.

No user-visible change if you don't use the new flags.

Relies on VEX API change in r3084.


------------------------------------------------------------------------
r14905 | cborntra | 2015-02-05 11:05:53 +0000 (Thu, 05 Feb 2015) | 3 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/memcheck/tests/s390x/ltgjhe.c

valgrind part to VEX:3083 Fix bugzilla 343802, also extend testcase


------------------------------------------------------------------------
r14904 | sewardj | 2015-02-05 10:05:43 +0000 (Thu, 05 Feb 2015) | 5 lines
Changed paths:
   M /trunk/coregrind/m_main.c

Fix some inconsistent uses of the VG_XACT_CLO macro, by putting an
empty then-body after the condition rather than merely ";", which is
confusing and is inconsistent with the rest of the arg handling code.
No functional change.

------------------------------------------------------------------------
r14903 | sewardj | 2015-02-04 18:46:11 +0000 (Wed, 04 Feb 2015) | 3 lines
Changed paths:
   M /trunk/shared/vg_replace_strmem.c

Followup to r14901 (vectorising memcmp): use SizeT instead of Addr
where appropriate.

------------------------------------------------------------------------
r14902 | florian | 2015-02-04 18:01:19 +0000 (Wed, 04 Feb 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-main.c

Remove unneeded code.
VG_(extend_stack) checks whether the given address is covered by the
stack.

------------------------------------------------------------------------
r14901 | sewardj | 2015-02-04 17:52:42 +0000 (Wed, 04 Feb 2015) | 3 lines
Changed paths:
   M /trunk/shared/vg_replace_strmem.c

Vectorise the memcmp template implementation.  For scenarios requiring
a lot of memcmp-ing (firefox reftests) this is measurably faster.

------------------------------------------------------------------------
r14900 | sewardj | 2015-02-03 12:27:30 +0000 (Tue, 03 Feb 2015) | 2 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/docs/internals/3_10_BUGSTATUS.txt

Update list of open bugs, and classify them by area.

------------------------------------------------------------------------
r14899 | philippe | 2015-02-02 22:40:54 +0000 (Mon, 02 Feb 2015) | 3 lines
Changed paths:
   M /trunk/configure.ac

PTRACE_GETREGS might not be detected on some distro, due to a missing #include
in the configure test.

------------------------------------------------------------------------
r14898 | florian | 2015-01-31 00:29:50 +0000 (Sat, 31 Jan 2015) | 20 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/include/pub_tool_aspacemgr.h

Replace the SegName array with a simple string table.
The validity of this change follows from the following observations:

(1) There is a single source for allocating and storing segment names,
    namely allocate_segname.
(2) For all invocations of allocate_segname the returned value (which
    represents the segmant name) is assigned to NSegment::fnIdx.
(3) All but one assignments to NSegment::fnIdx assign allocate_segname.
    The single exception assigns -1 in init_nsegment. That function is
    called whenever a new segment (named or unnamed) is allocated.

For a segment name to become unused there must be an assignment to
NSegment::fnIdx which was previously assigned a return value from 
allocate_segname. There is no such assignment.
It follows that all segment names are in use at all times, hence
SegName::inUse == True for all SegNames. So we can constant fold it
and don't need to represent it.
Pass 3 in preen_nsegments is obsolete as there are no segment names to
garbage collect.

------------------------------------------------------------------------
r14897 | florian | 2015-01-30 22:21:16 +0000 (Fri, 30 Jan 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Remove confusing function attribute. The function is always used (on all platforms).

------------------------------------------------------------------------
r14896 | florian | 2015-01-29 23:01:14 +0000 (Thu, 29 Jan 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Fix an incorrect comment. Add asserts.

------------------------------------------------------------------------
r14895 | sewardj | 2015-01-28 12:04:21 +0000 (Wed, 28 Jan 2015) | 2 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/docs/internals/3_10_BUGSTATUS.txt

Update.

------------------------------------------------------------------------
r14894 | sewardj | 2015-01-28 11:49:46 +0000 (Wed, 28 Jan 2015) | 3 lines
Changed paths:
   M /trunk/none/tests/amd64/avx-1.c
   M /trunk/none/tests/amd64/avx-1.stdout.exp

Add test cases for AVX-1 conditional vector stores:
VMASKMOVP{D,S} xmm/ymm to memory.  Pertains to #335785.

------------------------------------------------------------------------
r14893 | sewardj | 2015-01-28 11:11:02 +0000 (Wed, 28 Jan 2015) | 2 lines
Changed paths:
   M /trunk/none/tests/amd64/avx2-1.c
   M /trunk/none/tests/amd64/avx2-1.stdout.exp

Add test cases for VPMASKMOV{D,Q} xmm/ymm to memory.

------------------------------------------------------------------------
r14892 | sewardj | 2015-01-27 23:10:19 +0000 (Tue, 27 Jan 2015) | 3 lines
Changed paths:
   M /trunk/memcheck/mc_translate.c

Handle new value ILGop_Ident64 in enum type IRLoadGOp.  This tracks
vex r3074.

------------------------------------------------------------------------
r14891 | florian | 2015-01-27 20:46:19 +0000 (Tue, 27 Jan 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/include/pub_tool_aspacemgr.h

Remove unused field from NSegment structure.

------------------------------------------------------------------------
r14890 | rhyskidd | 2015-01-26 09:00:51 +0000 (Mon, 26 Jan 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c

OS X 10.10: Fix incorrect check for presence of unsupported MACH_SEND_TRAILER in mach_msg. Partial fix for BZ #343306.
------------------------------------------------------------------------
r14889 | rhyskidd | 2015-01-26 03:44:07 +0000 (Mon, 26 Jan 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/darwin14.supp

Darwin14.supp should include suppression for known deliberate memory leak in setenv(). Per BZ #343303.
------------------------------------------------------------------------
r14888 | rhyskidd | 2015-01-26 03:27:01 +0000 (Mon, 26 Jan 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-amd64-darwin.c
   M /trunk/coregrind/m_syswrap/syswrap-x86-darwin.c

Partial fix for bz339745. Mac OS: Further progress worker queue thread support. Additional magic constants have been checked against OS X 10.9 and 10.10
------------------------------------------------------------------------
r14887 | florian | 2015-01-24 18:26:05 +0000 (Sat, 24 Jan 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_addrinfo.c

Followup to r14886. So it turned out that in m_addrinfo we were already
strduping the filename which I failed to spot. Thanks to Philippe for
pointing that out.

------------------------------------------------------------------------
r14886 | florian | 2015-01-24 00:02:19 +0000 (Sat, 24 Jan 2015) | 8 lines
Changed paths:
   M /trunk/coregrind/m_addrinfo.c
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/coregrind/m_debuginfo/debuginfo.c
   M /trunk/include/pub_tool_aspacemgr.h
   M /trunk/memcheck/mc_leakcheck.c

VG_(am_get_filename) returns a pointer to memory that belongs to the
address space manager. Callers should neither modify the string nor
free it (as the string resides is statically allocated memory). That
calls for a   const HChar *
The type change exposed two bugs. One in m_addrinfo.c and one in 
m_debuginfo.c. In both cases the returned string could possibly be freed later
on. So we need to strdup it first. Now fixed.

------------------------------------------------------------------------
r14885 | florian | 2015-01-23 19:55:31 +0000 (Fri, 23 Jan 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/pub_core_aspacemgr.h
   M /trunk/include/pub_tool_aspacemgr.h

Move comments next to the function prototypes they describe.
No functional change.

------------------------------------------------------------------------
r14884 | florian | 2015-01-23 16:53:06 +0000 (Fri, 23 Jan 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/priv_aspacemgr.h

Add function attributes.

------------------------------------------------------------------------
r14883 | sewardj | 2015-01-23 12:00:25 +0000 (Fri, 23 Jan 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-linux.c
   M /trunk/include/vki/vki-linux.h

Write proper wrappers for ioctls ION_IOC_ALLOC, ION_IOC_MAP and
ION_IOC_IMPORT, and add a wrapper for SYNC_IOC_MERGE.

------------------------------------------------------------------------
r14882 | florian | 2015-01-20 19:02:05 +0000 (Tue, 20 Jan 2015) | 5 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c

Minor tweaks:
- update a few boundary checks
- eliminate a loop
- remove a redundant assert

------------------------------------------------------------------------
r14881 | florian | 2015-01-20 18:46:13 +0000 (Tue, 20 Jan 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_compiler.c

Add even more built-in functions for ICC.
Patch by Gregory Czajkowski <gregczajkowski@yahoo.com>
Part of fixing BZ #339542.

------------------------------------------------------------------------
r14880 | sewardj | 2015-01-20 01:24:39 +0000 (Tue, 20 Jan 2015) | 2 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/docs/internals/3_10_BUGSTATUS.txt

Initial trawl through bugs from 22 Nov 2014 to 20 Jan 2015.

------------------------------------------------------------------------
r14879 | sewardj | 2015-01-20 00:47:21 +0000 (Tue, 20 Jan 2015) | 3 lines
Changed paths:
   M /trunk/NEWS

Import the list of bugs fixed in 3.10.1 (apparently never copied
into the trunk's NEWS file) and remove duplicates.

------------------------------------------------------------------------
r14878 | sewardj | 2015-01-20 00:24:51 +0000 (Tue, 20 Jan 2015) | 2 lines
Changed paths:
   M /trunk/docs/internals/3_10_BUGSTATUS.txt

Pull in bugs opened after 22 Nov 2014.

------------------------------------------------------------------------
r14877 | sewardj | 2015-01-20 00:12:18 +0000 (Tue, 20 Jan 2015) | 4 lines
Changed paths:
   M /trunk/drd/drd_mutex.c
   M /trunk/drd/drd_thread.c

Add some parentheses to keep gcc 5 (prerelease) from complaining.
No functional change.


------------------------------------------------------------------------
r14875 | tom | 2015-01-19 21:52:44 +0000 (Mon, 19 Jan 2015) | 2 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/priv_syswrap-linux.h
   M /trunk/coregrind/m_syswrap/syswrap-amd64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-arm-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-arm64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-mips32-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-mips64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-ppc32-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-ppc64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-s390x-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-x86-linux.c

Handle the memfd_create system call.

------------------------------------------------------------------------
r14872 | florian | 2015-01-15 15:54:40 +0000 (Thu, 15 Jan 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/m_compiler.c

Add more built-in functions for ICC.
Patch by Gregory Czajkowski <gregczajkowski@yahoo.com>
Part of fixing BZ #339542.

------------------------------------------------------------------------
r14871 | rhyskidd | 2015-01-14 13:03:51 +0000 (Wed, 14 Jan 2015) | 1 line
Changed paths:
   M /trunk/NEWS

Retroactive NEWS update for r14859, r14860 and r14861
------------------------------------------------------------------------
r14867 | florian | 2015-01-13 17:33:59 +0000 (Tue, 13 Jan 2015) | 6 lines
Changed paths:
   M /trunk/callgrind/main.c
   M /trunk/coregrind/m_tooliface.c
   M /trunk/coregrind/m_transtab.c
   M /trunk/coregrind/pub_core_transtab.h
   M /trunk/include/Makefile.am
   A /trunk/include/pub_tool_transtab.h

Export VG_(discard_tranalsations_safely) to the tools. It is
only allowed to be called in certain contexts which is
enforced at runtime.
Change callgrind accordingly.
New header file pub_tool_transtab.h added.

------------------------------------------------------------------------
r14866 | mjw | 2015-01-13 16:10:20 +0000 (Tue, 13 Jan 2015) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/shared/vg_replace_strmem.c

BZ #342795 Internal glibc __GI_mempcpy call should be intercepted.
------------------------------------------------------------------------
r14865 | rhyskidd | 2015-01-12 13:29:29 +0000 (Mon, 12 Jan 2015) | 1 line
Changed paths:
   M /trunk/auxprogs

Add to svn ignore auxprogs/getoff-*-darwin files created on OS X. The equivalent files are ignored from other architectures in this folder. Simple change, no-BZ.
------------------------------------------------------------------------
r14864 | rhyskidd | 2015-01-11 07:04:20 +0000 (Sun, 11 Jan 2015) | 1 line
Changed paths:
   M /trunk/gdbserver_tests

Add to svn ignore gdbserver_tests/*.dSYM intermediate files created on OS X. These files are ignored in all other sub folders where created. Simple change, no-BZ.
------------------------------------------------------------------------
r14863 | florian | 2015-01-10 16:11:30 +0000 (Sat, 10 Jan 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_transtab.c

Track VEX r3063 (function prototype change).

------------------------------------------------------------------------
r14862 | florian | 2015-01-10 15:25:54 +0000 (Sat, 10 Jan 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_libcproc.c

Remove superfluous function call.

------------------------------------------------------------------------
r14861 | rhyskidd | 2015-01-09 15:56:36 +0000 (Fri, 09 Jan 2015) | 1 line
Changed paths:
   M /trunk/none/tests/Makefile.am

Re-enable building of manythreads and thread-exits tests. Patch and discussion per BZ #341613.
------------------------------------------------------------------------
r14860 | rhyskidd | 2015-01-09 15:41:15 +0000 (Fri, 09 Jan 2015) | 1 line
Changed paths:
   M /trunk/darwin13.supp

Darwin13.supp should include suppression for known uninitialised read in pthread_rwlock_init() as required to pass the memcheck/tests/darwin/pth-supp test. Patch and discussion per BZ #339780.
------------------------------------------------------------------------
r14859 | rhyskidd | 2015-01-09 15:32:07 +0000 (Fri, 09 Jan 2015) | 1 line
Changed paths:
   M /trunk/darwin13.supp

Darwin13.supp should include suppression for known deliberate memory leak in setenv(). Patch and discussion per BZ #339755.
------------------------------------------------------------------------
r14858 | florian | 2015-01-08 21:05:03 +0000 (Thu, 08 Jan 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/m_main.c
   M /trunk/coregrind/m_signals.c

Comment only changes.

------------------------------------------------------------------------
r14857 | florian | 2015-01-08 14:43:29 +0000 (Thu, 08 Jan 2015) | 3 lines
Changed paths:
   M /trunk/callgrind/main.c
   M /trunk/coregrind/m_libcproc.c
   M /trunk/include/pub_tool_libcproc.h

Add VG_(gettimeofday) such that callgrind can use it without
a bloody hack.

------------------------------------------------------------------------
r14856 | weidendo | 2015-01-08 14:15:18 +0000 (Thu, 08 Jan 2015) | 9 lines
Changed paths:
   M /trunk/callgrind/main.c

Callgrind: fix BB discarding

When the info struct for a BB is created, we use the first guest
instruction address as key to insert the info into a hash table.
We should do the same when discarding.

This actually is not a real problem, as Callgrind obviously
is used very rarely with redirections. But we should be consistent
with cachegrind.
------------------------------------------------------------------------
r14855 | florian | 2015-01-07 14:47:15 +0000 (Wed, 07 Jan 2015) | 5 lines
Changed paths:
   M /trunk/coregrind/m_main.c

When creating a log-file (xml or otherwise) give everybody
read permission. Previously, only user could read which was
incovenient for some typical workflows.
Suggested in BZ #339542.

------------------------------------------------------------------------
r14854 | florian | 2015-01-07 14:42:11 +0000 (Wed, 07 Jan 2015) | 4 lines
Changed paths:
   M /trunk/auxprogs/valgrind-di-server.c

Add command line option --max-connect=INT to allow the user to provide
an upper bound for the number of connected processes. 
Part of fixing BZ #337869.

------------------------------------------------------------------------
r14853 | florian | 2015-01-06 17:07:09 +0000 (Tue, 06 Jan 2015) | 2 lines
Changed paths:
   M /trunk/docs/xml/manual-core.xml

Fix a typo.

------------------------------------------------------------------------
r14852 | philippe | 2015-01-05 17:00:54 +0000 (Mon, 05 Jan 2015) | 4 lines
Changed paths:
   M /trunk/memcheck/docs/mc-manual.xml

Small doc improvement:  make more clear that --show-leak-kinds and --errors-for-leak-kinds
have an effect only for a full leak search.


------------------------------------------------------------------------
r14851 | florian | 2015-01-05 14:28:46 +0000 (Mon, 05 Jan 2015) | 4 lines
Changed paths:
   M /trunk/configure.ac

Fix compiler detection for ICC.
Patch by Gregory Czajkowski (gregczajkowski@yahoo.com).
Part of fixing BZ #339542.

------------------------------------------------------------------------
r14850 | philippe | 2015-01-05 13:31:07 +0000 (Mon, 05 Jan 2015) | 2 lines
Changed paths:
   M /trunk/coregrind/vgdb-invoker-ptrace.c

Avoid warning on Addr sp, unused on some platforms (e.g. ppc32)

------------------------------------------------------------------------
r14849 | florian | 2015-01-04 22:55:45 +0000 (Sun, 04 Jan 2015) | 3 lines
Changed paths:
   M /trunk/memcheck/tests/vbit-test/Makefile.am

Fix Makefile.am so it works for builds configured with
--enable-only32bit.

------------------------------------------------------------------------
r14848 | florian | 2015-01-04 22:47:32 +0000 (Sun, 04 Jan 2015) | 3 lines
Changed paths:
   M /trunk/drd/tests/local_static.cpp

Fix a compiler warning about an incompatible format.
Shows up on 32-bit builds only.

------------------------------------------------------------------------
r14847 | philippe | 2015-01-04 20:33:50 +0000 (Sun, 04 Jan 2015) | 4 lines
Changed paths:
   M /trunk/coregrind/vgdb-invoker-ptrace.c

* Remove useless typedef and uses of Addr32 and Addr64, just use Addr
* uses correct filename in "dying here #ifdef"
* small reformat

------------------------------------------------------------------------
r14846 | florian | 2015-01-04 17:20:45 +0000 (Sun, 04 Jan 2015) | 3 lines
Changed paths:
   M /trunk/cachegrind/cg_main.c
   M /trunk/callgrind/main.c
   M /trunk/coregrind/m_redir.c
   M /trunk/coregrind/m_sbprofile.c
   M /trunk/coregrind/m_scheduler/scheduler.c
   M /trunk/coregrind/m_sigframe/sigframe-ppc32-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-ppc64-linux.c
   M /trunk/coregrind/m_stacktrace.c
   M /trunk/coregrind/m_syswrap/syswrap-arm-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-arm64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-generic.c
   M /trunk/coregrind/m_syswrap/syswrap-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-mips32-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-mips64-linux.c
   M /trunk/coregrind/m_tooliface.c
   M /trunk/coregrind/m_translate.c
   M /trunk/coregrind/m_transtab.c
   M /trunk/coregrind/pub_core_tooliface.h
   M /trunk/coregrind/pub_core_translate.h
   M /trunk/coregrind/pub_core_transtab.h
   M /trunk/include/pub_tool_tooliface.h

Change most remaining use of Addr64 in coregrind and the tools to Addr.
Tracking VEX r3056.

------------------------------------------------------------------------
r14845 | florian | 2015-01-04 11:30:11 +0000 (Sun, 04 Jan 2015) | 5 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/tytypes.c

TyEnt::TyStOrUn::fieldRs is never NULL as VG_(newXA) always returns
something != NULL. Testing fieldRs for NULL-ness was confusing static
analysis. It usually takes such tests as evidence that the pointer
can in fact be NULL and may report false positives as a consequence.

------------------------------------------------------------------------
r14844 | florian | 2015-01-02 17:32:40 +0000 (Fri, 02 Jan 2015) | 2 lines
Changed paths:
   M /trunk/cachegrind/cg_main.c
   M /trunk/callgrind/main.c
   M /trunk/coregrind/m_translate.c
   M /trunk/exp-bbv/bbv_main.c
   M /trunk/exp-sgcheck/h_main.c
   M /trunk/exp-sgcheck/sg_main.c
   M /trunk/helgrind/hg_main.c
   M /trunk/memcheck/mc_translate.c

Track the IMark changes in VEX r3055.

------------------------------------------------------------------------
r14843 | florian | 2015-01-02 11:45:57 +0000 (Fri, 02 Jan 2015) | 3 lines
Changed paths:
   M /trunk/coregrind/m_translate.c

Track VEX r3052 (VexTranslateArgs::guest_bytes_addr is an Addr value).
There is more to tidy up here -- but that's for anoher day.

------------------------------------------------------------------------
r14842 | florian | 2015-01-01 18:47:56 +0000 (Thu, 01 Jan 2015) | 2 lines
Changed paths:
   M /trunk/Makefile.vex.am

Remove -Wcast-qual as it is already being added by Makefile.all.am

------------------------------------------------------------------------
r14841 | florian | 2015-01-01 18:26:05 +0000 (Thu, 01 Jan 2015) | 4 lines
Changed paths:
   M /trunk/Makefile.all.am

Add -std=gnu99 to the list of compile flags.
Remove -Wno-long-long as it is no longer needed. long long is part
of C99.

------------------------------------------------------------------------
r14840 | florian | 2014-12-31 12:11:15 +0000 (Wed, 31 Dec 2014) | 3 lines
Changed paths:
   M /trunk/coregrind/m_translate.c
   M /trunk/include/pub_tool_basics.h

The definition of type Addr has moved to VEX and
the resteer callback has changed (VEX r3050). Track those changes.

------------------------------------------------------------------------
r14839 | florian | 2014-12-29 22:19:24 +0000 (Mon, 29 Dec 2014) | 2 lines
Changed paths:
   M /trunk/include/pub_tool_basics.h

Import offsetof and vg_alignof from VEX (tracking VEX r3049).

------------------------------------------------------------------------
r14838 | florian | 2014-12-29 22:07:35 +0000 (Mon, 29 Dec 2014) | 5 lines
Changed paths:
   M /trunk/auxprogs/valgrind-listener.c
   M /trunk/docs/xml/manual-core.xml

Add a command line option to allow the user to provide an upper bound
for the number of connected processes. This is still lame but better
than asking her to recompile.
Part of fixing BZ #337869.

------------------------------------------------------------------------
r14837 | florian | 2014-12-29 20:23:11 +0000 (Mon, 29 Dec 2014) | 2 lines
Changed paths:
   M /trunk/coregrind/m_translate.c

Change a logging function to use SizeT (tracking VEX r3047).

------------------------------------------------------------------------
r14836 | florian | 2014-12-29 19:06:40 +0000 (Mon, 29 Dec 2014) | 3 lines
Changed paths:
   M /trunk/coregrind/m_debuglog.c
   M /trunk/include/pub_tool_basics.h

Move definition of type SizeT to VEX (see VEX r3046).
Enhance printeffery to print SizeT values.

------------------------------------------------------------------------
r14835 | philippe | 2014-12-29 18:24:37 +0000 (Mon, 29 Dec 2014) | 5 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-generic.c

Fix 342221 - socket connect produce false positive saying access to uninitialized memory area

As we check what follows af_family, the length to check must be decreased
by sizeof(af_maily)

------------------------------------------------------------------------
r14834 | florian | 2014-12-29 17:04:46 +0000 (Mon, 29 Dec 2014) | 4 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-common.c
   M /trunk/coregrind/m_mallocfree.c
   M /trunk/coregrind/m_scheduler/scheduler.c
   M /trunk/coregrind/m_transtab.c
   M /trunk/coregrind/pub_core_transtab.h
   M /trunk/include/pub_tool_basics.h

Remove the type AddrH. The code assumes in many places that the host
and guest architecture are the same. So the type is really pointless
nowadays.

------------------------------------------------------------------------
r14833 | philippe | 2014-12-28 17:30:22 +0000 (Sun, 28 Dec 2014) | 9 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_addrinfo.c
   M /trunk/include/pub_tool_addrinfo.h
   M /trunk/memcheck/tests/dw4.c
   M /trunk/memcheck/tests/dw4.stderr.exp

Fix 341539 VG_(describe_addr) should not describe address as belonging to client
        segment if it is past the heap end

Describes specifically an address that is in the brk data segment
or in the 'reduced' (after brk reduction) section of the brk data segment.

Based on a patch from Ivo Raisr.


------------------------------------------------------------------------
r14832 | florian | 2014-12-28 16:46:14 +0000 (Sun, 28 Dec 2014) | 3 lines
Changed paths:
   M /trunk/memcheck/mc_leakcheck.c

Avoid spurious warnings about white space following a backslash
in a line splice.

------------------------------------------------------------------------
r14831 | florian | 2014-12-24 11:11:42 +0000 (Wed, 24 Dec 2014) | 2 lines
Changed paths:
   M /trunk/coregrind/m_scheduler/scheduler.c

Fix a few casts. A void * cannot be used to initialise a function pointer.

------------------------------------------------------------------------
r14830 | florian | 2014-12-23 11:05:21 +0000 (Tue, 23 Dec 2014) | 2 lines
Changed paths:
   M /trunk/coregrind/m_sigframe/sigframe-amd64-darwin.c
   M /trunk/coregrind/m_sigframe/sigframe-x86-darwin.c

Elimnate two magic constants.

------------------------------------------------------------------------
r14829 | philippe | 2014-12-21 17:53:42 +0000 (Sun, 21 Dec 2014) | 2 lines
Changed paths:
   M /trunk/coregrind/vgdb.c

Fix a typo, introduced when fixing a typo.

------------------------------------------------------------------------
r14828 | philippe | 2014-12-21 17:46:11 +0000 (Sun, 21 Dec 2014) | 2 lines
Changed paths:
   M /trunk/coregrind/vgdb.c

Fix typo

------------------------------------------------------------------------
r14827 | philippe | 2014-12-21 17:31:54 +0000 (Sun, 21 Dec 2014) | 4 lines
Changed paths:
   M /trunk/coregrind/vgdb.c

Follow up to rev 14823: make errors when reporting command line non critical
(as e.g. cmdline reporting is not available on MacOS)


------------------------------------------------------------------------
r14826 | philippe | 2014-12-21 17:02:38 +0000 (Sun, 21 Dec 2014) | 4 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/gdbserver_tests/mcblocklistsearch.stdinB.gdb

342063  wrong format specifier for test mcblocklistsearch in gdbserver_tests
Patch from Ivo Raisr.


------------------------------------------------------------------------
r14825 | florian | 2014-12-20 16:52:08 +0000 (Sat, 20 Dec 2014) | 2 lines
Changed paths:
   M /trunk/coregrind/m_aspacemgr/aspacemgr-common.c
   M /trunk/coregrind/m_debuginfo/readelf.c
   M /trunk/coregrind/m_debuginfo/tytypes.c
   M /trunk/coregrind/m_main.c
   M /trunk/coregrind/m_sbprofile.c
   M /trunk/coregrind/m_scheduler/scheduler.c
   M /trunk/coregrind/m_signals.c
   M /trunk/coregrind/m_syswrap/syswrap-generic.c
   M /trunk/coregrind/m_syswrap/syswrap-linux.c

Buffer audit. Resize some.

------------------------------------------------------------------------
r14824 | florian | 2014-12-19 20:29:22 +0000 (Fri, 19 Dec 2014) | 2 lines
Changed paths:
   M /trunk/callgrind/main.c
   M /trunk/callgrind/threads.c
   M /trunk/coregrind/m_aspacemgr/aspacemgr-linux.c
   M /trunk/coregrind/m_gdbserver/server.c
   M /trunk/coregrind/m_gdbserver/target.c
   M /trunk/coregrind/m_scheduler/scheduler.c
   M /trunk/coregrind/m_sigframe/sigframe-ppc32-linux.c
   M /trunk/coregrind/m_sigframe/sigframe-ppc64-linux.c
   M /trunk/coregrind/m_signals.c
   M /trunk/coregrind/vgdb-invoker-ptrace.c
   M /trunk/helgrind/libhb_core.c

Buffer audit. Resize a few.

------------------------------------------------------------------------
r14823 | florian | 2014-12-19 20:25:46 +0000 (Fri, 19 Dec 2014) | 3 lines
Changed paths:
   M /trunk/coregrind/vgdb.c

Fix a buffer overflow (in case read had returned 1000).
Write out the whole command line.

------------------------------------------------------------------------
r14822 | carll | 2014-12-17 21:41:58 +0000 (Wed, 17 Dec 2014) | 8 lines
Changed paths:
   M /trunk/coregrind/m_translate.c

This commit fixes a redundant #if defined line.  The define
VG_PLAT_USES_PPCTOC is only true for PPC64 big endian, do not
need to quailify the #if statement condition of VG_PLAT_USES_PPCTOC
with !VGP_ppc64le_linux.

There is no associated bugzilla.  The fix is in response to an
email message.

------------------------------------------------------------------------
r14821 | philippe | 2014-12-17 20:39:55 +0000 (Wed, 17 Dec 2014) | 7 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_syswrap/syswrap-generic.c

Fix 341789 - aarch64: shmat fails with valgrind on ARMv8
arm64, like amd64, must not use VKI_IPC_64, even
if this symbol is defined.
This makes the shmctl fail, which results in a zero size returned,
which means that the succesful shmat is not reported to the aspacemgr.


------------------------------------------------------------------------
r14820 | florian | 2014-12-17 19:52:25 +0000 (Wed, 17 Dec 2014) | 2 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/readdwarf.c
   M /trunk/coregrind/m_debuginfo/readdwarf3.c

Remove two fixed-size buffers in the dwarf readers.

------------------------------------------------------------------------
r14819 | florian | 2014-12-17 13:18:51 +0000 (Wed, 17 Dec 2014) | 2 lines
Changed paths:
   M /trunk/coregrind/m_main.c

Join two #ifdefs, eliminating one.

------------------------------------------------------------------------
r14818 | florian | 2014-12-17 11:52:39 +0000 (Wed, 17 Dec 2014) | 2 lines
Changed paths:
   M /trunk/coregrind/m_machine.c
   M /trunk/coregrind/m_syswrap/syswrap-s390x-linux.c

For s390 use symbolic register names.

------------------------------------------------------------------------
r14817 | florian | 2014-12-17 11:35:10 +0000 (Wed, 17 Dec 2014) | 2 lines
Changed paths:
   M /trunk/memcheck/tests/vbit-test/irops.c

Avoid compiler warnings on s390x.

------------------------------------------------------------------------
r14816 | florian | 2014-12-17 11:01:40 +0000 (Wed, 17 Dec 2014) | 2 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/priv_storage.h
   M /trunk/coregrind/m_debuginfo/storage.c

Comment change. Function vg_panic does not exist.

------------------------------------------------------------------------
r14815 | philippe | 2014-12-17 00:00:11 +0000 (Wed, 17 Dec 2014) | 7 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_gdbserver/valgrind-low-amd64.c
   M /trunk/coregrind/m_syswrap/syswrap-amd64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c
   M /trunk/coregrind/m_translate.c
   M /trunk/memcheck/mc_machine.c

Fix 197259  Unsupported arch_prtctl PR_SET_GS option
(valgrind side).
In summary: we were counting somewhat on the luck for FS,
we now similarly count on luch for GS
See VEX commit log r3043 for more details.


------------------------------------------------------------------------
r14814 | florian | 2014-12-16 20:55:58 +0000 (Tue, 16 Dec 2014) | 4 lines
Changed paths:
   M /trunk/cachegrind/cg_main.c
   M /trunk/callgrind/dump.c
   M /trunk/callgrind/fn.c
   M /trunk/coregrind/m_debuginfo/debuginfo.c
   M /trunk/coregrind/m_scheduler/scheduler.c
   M /trunk/include/pub_tool_debuginfo.h

Simplify the VG_(get_filename_linenum) interface by removing
the dirname_available parameter. It's redundant. The value
of the returned directory name can be tested instead.

------------------------------------------------------------------------
r14813 | florian | 2014-12-16 12:04:03 +0000 (Tue, 16 Dec 2014) | 2 lines
Changed paths:
   M /trunk/coregrind/m_redir.c

Add a clarifying comment.

------------------------------------------------------------------------
r14812 | florian | 2014-12-16 08:12:02 +0000 (Tue, 16 Dec 2014) | 2 lines
Changed paths:
   M /trunk/exp-bbv/tests/amd64-linux/Makefile.am

Remove duplicate command line option.

------------------------------------------------------------------------
r14811 | florian | 2014-12-15 21:56:00 +0000 (Mon, 15 Dec 2014) | 2 lines
Changed paths:
   M /trunk/Makefile.vex.am

Update tracking the file removal in VEX r3042.

------------------------------------------------------------------------
r14810 | florian | 2014-12-14 15:39:57 +0000 (Sun, 14 Dec 2014) | 4 lines
Changed paths:
   M /trunk/callgrind/global.h
   M /trunk/callgrind/sim.c

Remove callgrind's percentify and commify functions as well as the
assorted buffers that go with them.
Part of fixing BZ #337869.

------------------------------------------------------------------------
r14809 | florian | 2014-12-13 18:55:35 +0000 (Sat, 13 Dec 2014) | 3 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/docs/xml/valgrind-manpage.xml

Enhance the "Author" section of the manpage as suggested
in BZ #226609.

------------------------------------------------------------------------
r14808 | florian | 2014-12-13 18:35:00 +0000 (Sat, 13 Dec 2014) | 8 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_debuginfo/readdwarf3.c
   M /trunk/coregrind/m_debuginfo/readelf.c
   M /trunk/coregrind/m_debuginfo/readexidx.c
   M /trunk/coregrind/m_debuglog.c
   M /trunk/coregrind/m_gdbserver/target.c
   M /trunk/coregrind/m_mallocfree.c
   M /trunk/coregrind/m_redir.c
   M /trunk/coregrind/m_seqmatch.c
   M /trunk/lackey/lk_main.c
   M /trunk/memcheck/mc_leakcheck.c
   M /trunk/none/tests/unit_debuglog.c
   M /trunk/none/tests/unit_debuglog.stderr.exp

Fix BZ #116002.
Left justification of strings in myvprintf_str was mixed up.
Now fixed and %s formats changed accordingly.
In function myvprintf_int64: the local buffer was not large
enough to hold ULONG_MAX in binary notation. Numbers were
truncated at 39 digits. 
Testcases added.

------------------------------------------------------------------------
r14807 | philippe | 2014-12-13 16:36:12 +0000 (Sat, 13 Dec 2014) | 7 lines
Changed paths:
   M /trunk/memcheck/tests/reach_thread_register.vgtest

reach_thread_register cannot be compiled on Mac OS as Mac OS
had no pthread barrier.
(the Makefile.am protects this with a if HAVE_PTHREAD_BARRIER)
But the test should then be protected with a prereq that the
executable exists.
(analysis and fix suggestion by rhyskidd, part of fixing 341613)

------------------------------------------------------------------------
r14806 | florian | 2014-12-12 19:32:10 +0000 (Fri, 12 Dec 2014) | 15 lines
Changed paths:
   M /trunk/cachegrind/cg_main.c
   M /trunk/callgrind/main.c
   M /trunk/coregrind/m_debuglog.c
   M /trunk/coregrind/m_libcprint.c
   M /trunk/coregrind/m_sbprofile.c
   M /trunk/coregrind/m_translate.c
   M /trunk/include/pub_tool_libcprint.h
   M /trunk/lackey/lk_main.c
   M /trunk/lackey/tests/true.stderr.exp
   M /trunk/massif/ms_main.c
   M /trunk/massif/tests/insig.post.exp
   M /trunk/massif/tests/thresholds_5_0.post.exp
   M /trunk/massif/tests/zero1.post.exp
   M /trunk/memcheck/mc_main.c
   M /trunk/none/tests
   M /trunk/none/tests/Makefile.am
   A /trunk/none/tests/unit_debuglog.c
   A /trunk/none/tests/unit_debuglog.stderr.exp
   A /trunk/none/tests/unit_debuglog.vgtest

Add limited support for printing floating point numbers to
VG_(debugLog_vprintf). 
Remove function VG_(percentify) and fix up its call sites (part of
fixing BZ #337869.
Allow the width in a format specification to be '*', i.e. the width is
given as an additional function argument.

The limitations for printing floating point numbers are:
(1) %f is the only supported format. Width and precision can be
    specified.
(2) Funny numbers (NaN and such) are not supported.
(3) Floating point numbers need to be benign in the sense that their
    integral part fits into an ULong.
This is good enough for our purposes.

------------------------------------------------------------------------
r14805 | florian | 2014-12-12 17:44:36 +0000 (Fri, 12 Dec 2014) | 4 lines
Changed paths:
   M /trunk/configure.ac

Update detection of tool-chain support for MPX insns
to better work for older assemblers.
Pertains to BZ #339542.

------------------------------------------------------------------------
r14804 | sewardj | 2014-12-09 22:25:47 +0000 (Tue, 09 Dec 2014) | 3 lines
Changed paths:
   M /trunk/none/tests/darwin/access_extended.stderr.exp

Update expected output for none/tests/darwin/access_extended.
Fixes #341615.  (Rhys Kidd, rhyskidd@gmail.com)

------------------------------------------------------------------------
r14803 | florian | 2014-12-09 20:08:46 +0000 (Tue, 09 Dec 2014) | 5 lines
Changed paths:
   M /trunk/coregrind/m_machine.c

Detect presence of sse3 instructions on x86.
Set VEX_HWCAPS_X86_SSE3 accordingly.
This came about by grepping the source for VEX_HWCAPS_X86_SSE3
and observing that the flag was tested for (in VEX) but not set.

------------------------------------------------------------------------
r14802 | florian | 2014-12-08 14:03:00 +0000 (Mon, 08 Dec 2014) | 3 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/README.s390
   M /trunk/coregrind/m_main.c

Announce, that the long displacement facility is noq required for s390x.
Update minimum machine model. See also VEX r3034.

------------------------------------------------------------------------
r14801 | florian | 2014-12-07 18:58:59 +0000 (Sun, 07 Dec 2014) | 7 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/readdwarf3.c

Remove fixed size arrays in the dwarf-3 parser.
Use proper initialisation functions for the type and variable parser.
Add functions to release the dynamically allocated functions.
No longer maintain content of popped-off stack entries as that is
essentially freed memory and complicates matters unnecessarily.
Part of fixing BZ #337869.

------------------------------------------------------------------------
r14800 | florian | 2014-12-06 21:58:50 +0000 (Sat, 06 Dec 2014) | 3 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/readdwarf.c

Eliminate fixed size buffer 'the_CIEs' and allocate it dynamically.
Part of fixing BZ #337869.

------------------------------------------------------------------------
r14799 | florian | 2014-12-05 18:29:38 +0000 (Fri, 05 Dec 2014) | 2 lines
Changed paths:
   M /trunk/none/tests/s390x/fpext_warn.stderr.exp

Update test result following VEX r3029.

------------------------------------------------------------------------
r14798 | florian | 2014-12-03 22:53:00 +0000 (Wed, 03 Dec 2014) | 27 lines
Changed paths:
   M /trunk/Makefile.all.am
   M /trunk/Makefile.tool-tests.am
   M /trunk/configure.ac
   M /trunk/memcheck/tests/vbit-test/Makefile.am

Add -Wformat -Wformat-security to the list of compile flags.
This was not as straight forward as expected. Specifically, adding the
new flag to CFLAGS in configure.ac did not work and was causing
compiler warnings. For instance, compiling memcheck/tests/execve2.c will
generate a -Wnonnull warning even though the testcase is explicitly
compiled with -Wno-nonnull. The reason is that (a) -Wformat is implied by
-Wnonnull and (b) the list of compiler flags gets assembled in the wrong
order. The culprit appears to be that we modify CFLAGS in configure.ac and
that really is not the right place. Conceptually, configure should determine
tool-chain capabilities and not assemble compiler flags. That should be done
in Makefiles. This patch entangles all this.

So, whatever was added to CFLAGS in configure.ac has now been moved to
Makefile.all.am and Makefile.tool-tests.am. Those are:
-Wno-long-long
-Wwrite-strings
-Wcast-qual
-fno-stack-protector
Note, that this change allows us to simplify Makefile.tool-tests.am which
in the past was disabling some of those flags (e.g. by adding -Wno-cast-qual
again).
In case of the clang compiler, extra command line options are needed. I've
moved those into a separate 'if COMPILER_IS_CLANG' section and not merge
them into baseline flags.

Related to BZ 334727.

------------------------------------------------------------------------
r14797 | florian | 2014-12-03 22:48:29 +0000 (Wed, 03 Dec 2014) | 4 lines
Changed paths:
   A /trunk/auxprogs/compare-build-logs

Add script. Comes in handy when messing with the build system
to make sure no compiler flags get lost (as they did at some
point in the past).

------------------------------------------------------------------------
r14796 | florian | 2014-11-29 17:50:10 +0000 (Sat, 29 Nov 2014) | 3 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-arm-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-arm64-linux.c
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c
   M /trunk/coregrind/m_syswrap/syswrap-s390x-linux.c
   M /trunk/drd/drd_semaphore.c

Fix a few VG_(message) invocations. The function does not add a 
newline character under the covers.

------------------------------------------------------------------------
r14795 | florian | 2014-11-29 14:41:32 +0000 (Sat, 29 Nov 2014) | 4 lines
Changed paths:
   M /trunk/Makefile.all.am
   M /trunk/NEWS
   M /trunk/cachegrind/cg_arch.c
   M /trunk/callgrind/main.c
   M /trunk/coregrind/m_gdbserver/remote-utils.c
   M /trunk/coregrind/m_libcprint.c
   M /trunk/coregrind/m_main.c
   M /trunk/coregrind/pub_core_libcprint.h
   M /trunk/include/pub_tool_options.h
   M /trunk/massif/ms_main.c
   M /trunk/none/tests/cmdline4.stderr.exp

Fix BZ 334802. Patch by Mark Wielaard with a few mods to make it apply.
r14794 is related as well.
Also: remove -Wno-format-zero-length from compile options.

------------------------------------------------------------------------
r14794 | florian | 2014-11-29 13:31:18 +0000 (Sat, 29 Nov 2014) | 19 lines
Changed paths:
   M /trunk/coregrind/m_coredump/coredump-elf.c
   M /trunk/coregrind/m_options.c

Fix up the error processing in VG_(expand_file_name). E.g. giving
--log-file=  on the command line results in the following error:

valgrind: --log-file: filename is emptyBad option: --log-file=
...

Relatedly, fix the 1st argument to VG_(expand_file_name) in coredump-elf.c.
This should not contain additional verbiage as it is assumed to be an option
name which us used to construct an error message containing
option_name=file_name

As an aside, this logic in coredump-elf.c seems odd:
If VG_(clo_log_fname_expanded) is not NULL, then it has already been
expanded in main_process_cmd_line_options. Expanding it again would only
make a difference, if the original logfile name contained an environment 
variable whose value contained %q{whatever} thereby referring to a yet
another environment variable. That seems strange.
But I'm not touching it.

------------------------------------------------------------------------
r14793 | florian | 2014-11-28 12:42:39 +0000 (Fri, 28 Nov 2014) | 3 lines
Changed paths:
   M /trunk/none/tests/s390x/flogr.c

Add an early-clobber constraint. Otherwise, it will segfault when compiled
with gcc 4.9.2

------------------------------------------------------------------------
r14792 | petarj | 2014-11-26 23:50:31 +0000 (Wed, 26 Nov 2014) | 9 lines
Changed paths:
   M /trunk/none/tests/mips64/cvm_bbit.c
   M /trunk/none/tests/mips64/cvm_bbit.stdout.exp

mips64: add test cases for Cavium BBIT032 and BBIT132

This is a follow up to VEX r3028. This change adds two test cases
for Cavium instructions BBIT032 and BBIT132.

Issue tracked in BZ #339288.

Patch by Maran Pakkirisamy.

------------------------------------------------------------------------
r14791 | mjw | 2014-11-26 15:43:14 +0000 (Wed, 26 Nov 2014) | 1 line
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_debuginfo/priv_d3basics.h
   M /trunk/coregrind/m_debuginfo/readdwarf3.c

Bug 341238. Recognize GCC5/DWARFv5 DW_LANG constants Go, C11, C++11, C++14.
------------------------------------------------------------------------
r14790 | bart | 2014-11-26 12:47:19 +0000 (Wed, 26 Nov 2014) | 1 line
Changed paths:
   M /trunk/drd/drd_vc.c

drd: Add a consistency check
------------------------------------------------------------------------
r14789 | sewardj | 2014-11-25 23:19:24 +0000 (Tue, 25 Nov 2014) | 2 lines
Changed paths:
   M /trunk/docs/Makefile.am
   A /trunk/docs/internals/MERGE_3_10_1.txt

Add a file tracking the 3.10.x merge status.

------------------------------------------------------------------------
r14788 | sewardj | 2014-11-25 23:18:54 +0000 (Tue, 25 Nov 2014) | 2 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/docs/internals/3_10_BUGSTATUS.txt

Update.

------------------------------------------------------------------------
r14784 | sewardj | 2014-11-25 17:27:50 +0000 (Tue, 25 Nov 2014) | 2 lines
Changed paths:
   M /trunk/none/tests/arm64/integer.c
   M /trunk/none/tests/arm64/integer.stdout.exp

Add test cases for RORV x_x_x, w_w_w.

------------------------------------------------------------------------
r14783 | sewardj | 2014-11-25 15:51:31 +0000 (Tue, 25 Nov 2014) | 2 lines
Changed paths:
   M /trunk/none/tests/arm64/integer.c
   M /trunk/none/tests/arm64/integer.stdout.exp

Add test cases for CLS x_x, w_w.

------------------------------------------------------------------------
r14782 | sewardj | 2014-11-25 11:43:54 +0000 (Tue, 25 Nov 2014) | 2 lines
Changed paths:
   M /trunk/Makefile.all.am
   M /trunk/Makefile.am
   M /trunk/auxprogs/gsl16test

Back out r14781, which was unintended.

------------------------------------------------------------------------
r14781 | sewardj | 2014-11-25 11:37:14 +0000 (Tue, 25 Nov 2014) | 2 lines
Changed paths:
   M /trunk/Makefile.all.am
   M /trunk/Makefile.am
   M /trunk/auxprogs/gsl16test

arm64: implement "BRK #imm16".

------------------------------------------------------------------------
r14780 | florian | 2014-11-24 22:30:49 +0000 (Mon, 24 Nov 2014) | 3 lines
Changed paths:
   M /trunk/memcheck/tests/demangle.cpp
   M /trunk/memcheck/tests/demangle.stderr.exp

Change the testcase to not depend on the type of 'this' in the output.
GCC 4.9.2 and GCC 4.8.x have different opinions about that variable's type.

------------------------------------------------------------------------
r14779 | philippe | 2014-11-24 17:46:41 +0000 (Mon, 24 Nov 2014) | 18 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/coregrind/m_addrinfo.c
   M /trunk/helgrind/hg_addrdescr.c
   M /trunk/helgrind/hg_errors.c
   M /trunk/include/pub_tool_addrinfo.h
   M /trunk/memcheck/mc_errors.c
   M /trunk/memcheck/tests/addressable.stderr.exp
   M /trunk/memcheck/tests/dw4.c
   M /trunk/memcheck/tests/dw4.stderr.exp
   M /trunk/memcheck/tests/filter_dw4
   M /trunk/memcheck/tests/mempool2.stderr.exp

Change pub_tool_addrinfo.h AddrInfo and VG_(describe_addr) so as to describe
anonymous or file mmap-ed segments and shared memory segments.

* pub_tool_addrinfo.h:
    new AddrTag Addr_SegmentKind  // Client segment (mapped memory)
    new struct SegmentKind in AddrInfo

* m_addrinfo.c:
   If address is still undescribed, try to describe by findinf a client segment.

* update various tests

* mc_errors.c:
  add a call to VG_(clear_addrinfo) in MC_(pp_describe_addr)
  as the memory allocated in the local AddrInfo has to be cleared once
  info is printed.


------------------------------------------------------------------------
r14778 | florian | 2014-11-24 17:30:01 +0000 (Mon, 24 Nov 2014) | 6 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-generic.c

As the BEAM checker correctly points out, the conditions on lines 430 and 485
are always false. I'm keeping them as assertions for documentation purposes.
The proof is left as exercise to the reader.
Hint: use conditions on lines 307 and 311 and the fact that old_len and
old_arg are both unsigned entities.

------------------------------------------------------------------------
r14777 | sewardj | 2014-11-24 16:19:48 +0000 (Mon, 24 Nov 2014) | 2 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-arm64-linux.c

Enable sys_flock on arm64-linux.

------------------------------------------------------------------------
r14744 | florian | 2014-11-22 20:15:11 +0000 (Sat, 22 Nov 2014) | 2 lines
Changed paths:
   M /trunk/NEWS

Announce fix for BZ #269360.

------------------------------------------------------------------------
r14743 | sewardj | 2014-11-22 11:57:18 +0000 (Sat, 22 Nov 2014) | 2 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/docs/internals/3_10_BUGSTATUS.txt

Update.

------------------------------------------------------------------------
r14740 | sewardj | 2014-11-20 10:15:17 +0000 (Thu, 20 Nov 2014) | 2 lines
Changed paths:
   M /trunk/memcheck/mc_translate.c

isBogusAtom: handle missing case Ico_F32.

------------------------------------------------------------------------
r14739 | sewardj | 2014-11-20 10:11:42 +0000 (Thu, 20 Nov 2014) | 2 lines
Changed paths:
   M /trunk/none/tests/arm64/fp_and_simd.stdout.exp

Update mysteriously out-of-date fp_and_simd.stdout.exp.

------------------------------------------------------------------------
r14738 | sewardj | 2014-11-20 10:11:00 +0000 (Thu, 20 Nov 2014) | 2 lines
Changed paths:
   M /trunk/none/tests/arm64/Makefile.am
   A /trunk/none/tests/arm64/cvtf_imm.c
   A /trunk/none/tests/arm64/cvtf_imm.stderr.exp
   A /trunk/none/tests/arm64/cvtf_imm.stdout.exp
   A /trunk/none/tests/arm64/cvtf_imm.vgtest

Add test cases for {S,U}CVTF fixedpt-to-fp.

------------------------------------------------------------------------
r14737 | philippe | 2014-11-19 22:21:12 +0000 (Wed, 19 Nov 2014) | 2 lines
Changed paths:
   M /trunk/coregrind/m_debuginfo/readdwarf3.c

Fix typos in a comment

------------------------------------------------------------------------
r14736 | sewardj | 2014-11-19 16:09:08 +0000 (Wed, 19 Nov 2014) | 3 lines
Changed paths:
   M /trunk/none/tests/arm/vfpv4_fma.c
   M /trunk/none/tests/arm/vfpv4_fma.stdout.exp

Add test cases for VFPv4 VFNMA, VFNMS added in vex r2995.
Pertains to #340807.

------------------------------------------------------------------------
r14735 | sewardj | 2014-11-19 09:15:56 +0000 (Wed, 19 Nov 2014) | 7 lines
Changed paths:
   M /trunk/darwin14.supp

Add a lot more intercepts.  Very crude.  I am sure this is merely
hiding a whole bunch of problems in the Darwin syscall wrappers.  In
particular it suppresses all invalid address errors arising from
AppleIntelHD4000GraphicsGLDriver.dylib, as it appears that maps
hardware into user space and aspacemgr doesn't know anything about it.


------------------------------------------------------------------------
r14734 | sewardj | 2014-11-19 09:14:07 +0000 (Wed, 19 Nov 2014) | 2 lines
Changed paths:
   M /trunk/shared/vg_replace_strmem.c

OSX 10.10: intercept memchr in libsystem_platform.dylib.

------------------------------------------------------------------------
r14733 | sewardj | 2014-11-19 09:13:12 +0000 (Wed, 19 Nov 2014) | 3 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c

Fix up the wrapper for getdirentries64 a bit so as to avoid false positives
from it.  Unfortunately I can't tell why this was happening.

------------------------------------------------------------------------
r14732 | florian | 2014-11-19 07:41:19 +0000 (Wed, 19 Nov 2014) | 4 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/include/valgrind.h

Use unsigned long int instead of unsigned long long int on LP64
platforms. This avoids warnings when compiling with -pedantic.
Fixes BZ #211926.

------------------------------------------------------------------------
r14731 | florian | 2014-11-18 10:03:14 +0000 (Tue, 18 Nov 2014) | 3 lines
Changed paths:
   M /trunk/NEWS
   M /trunk/memcheck/tests
   M /trunk/memcheck/tests/Makefile.am
   A /trunk/memcheck/tests/bug155125.c
   A /trunk/memcheck/tests/bug155125.stderr.exp
   A /trunk/memcheck/tests/bug155125.vgtest

Announce fix of BZ #155125. As of r14685 I think.
Add testcase.

------------------------------------------------------------------------
r14730 | sewardj | 2014-11-17 11:22:51 +0000 (Mon, 17 Nov 2014) | 9 lines
Changed paths:
   M /trunk/none/tests/arm64/fp_and_simd.c
   M /trunk/none/tests/arm64/fp_and_simd.stdout.exp

Enable test cases for r2993, viz:
FADDP s_2s, d_2d 
FADDP 2d_2d_2d, 4s_4s_4s, 2s_2s_2s 
FMAX d_d, s_s 
FMIN d_d, s_s 
FMAXNM d_d, s_s (not really correct) 
FMINNM d_d, s_s (not really correct) 


------------------------------------------------------------------------
r14729 | florian | 2014-11-16 09:56:42 +0000 (Sun, 16 Nov 2014) | 2 lines
Changed paths:
   M /trunk/massif/ms_main.c

Comment only changes.

------------------------------------------------------------------------
r14728 | sewardj | 2014-11-15 22:15:47 +0000 (Sat, 15 Nov 2014) | 2 lines
Changed paths:
   M /trunk/none/tests/arm64/fp_and_simd.c
   M /trunk/none/tests/arm64/fp_and_simd.stdout.exp

Add test cases for all remaining AArch64 ARMv8 SIMD and FP instructions.

------------------------------------------------------------------------
r14726 | sewardj | 2014-11-15 10:30:23 +0000 (Sat, 15 Nov 2014) | 2 lines
Changed paths:
   M /trunk/darwin14.supp

Add even more suppressions for Yosemite.

------------------------------------------------------------------------
r14725 | sewardj | 2014-11-15 10:29:57 +0000 (Sat, 15 Nov 2014) | 8 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c

* add a logging mechanism to show repeated messages at exponentially
  declining rates, so as to reduce the amount of junk spewed out by
  the various support functions for the MacOS syscall wrappers.

* add a couple more cases to the resync filter for Yosemite.  This
  is working pretty well now.


------------------------------------------------------------------------
r14724 | florian | 2014-11-14 22:34:40 +0000 (Fri, 14 Nov 2014) | 3 lines
Changed paths:
   M /trunk/coregrind/m_libcprint.c
   M /trunk/coregrind/m_main.c
   M /trunk/coregrind/pub_core_libcprint.h

Pass buffer size to  VG_(elapsed_wallclock_time) so the function
can check it's large enough.

------------------------------------------------------------------------
r14723 | florian | 2014-11-14 19:25:08 +0000 (Fri, 14 Nov 2014) | 2 lines
Changed paths:
   M /trunk/coregrind/m_coredump/coredump-elf.c
   M /trunk/coregrind/m_debuginfo/debuginfo.c
   M /trunk/coregrind/m_errormgr.c
   M /trunk/coregrind/m_libcfile.c
   M /trunk/coregrind/m_machine.c
   M /trunk/coregrind/m_syswrap/priv_syswrap-generic.h
   M /trunk/coregrind/m_syswrap/syswrap-generic.c
   M /trunk/coregrind/pub_core_libcfile.h

Minor non-functional cleanups.

------------------------------------------------------------------------
r14722 | florian | 2014-11-14 14:47:12 +0000 (Fri, 14 Nov 2014) | 3 lines
Changed paths:
   M /trunk/coregrind/Makefile.am

m_compiler.c was added to noinst_HEADERS but should of course
be added to COREGRIND_SOURCES_COMMON. Now fixed.

------------------------------------------------------------------------
r14721 | sewardj | 2014-11-14 10:13:49 +0000 (Fri, 14 Nov 2014) | 2 lines
Changed paths:
   M /trunk/exp-dhat/dh_main.c

Implement missing heap-intercept function "dh_malloc_usable_size".

------------------------------------------------------------------------
r14720 | florian | 2014-11-13 22:45:58 +0000 (Thu, 13 Nov 2014) | 2 lines
Changed paths:
   M /trunk/callgrind/main.c
   M /trunk/callgrind/sim.c

Audit two buffer sizes.

------------------------------------------------------------------------
r14719 | florian | 2014-11-13 21:41:28 +0000 (Thu, 13 Nov 2014) | 5 lines
Changed paths:
   M /trunk
   M /trunk/callgrind/bb.c
   M /trunk/coregrind/m_addrinfo.c
   M /trunk/coregrind/m_debuginfo/debuginfo.c
   M /trunk/drd/drd_error.c
   M /trunk/drd/drd_load_store.c
   M /trunk/drd/drd_main.c
   M /trunk/helgrind/hg_errors.c
   M /trunk/include/pub_tool_addrinfo.h
   M /trunk/include/pub_tool_debuginfo.h

Merge revisions 14445 and 14446 from the BUF_REMOVAL branch to trunk.
Two things:
- remove the buffer argument from VG_(DebugInfo_sect_kind)
- allocate AddrInfo::SectKind::objname dynamically

------------------------------------------------------------------------
r14718 | sewardj | 2014-11-13 16:30:09 +0000 (Thu, 13 Nov 2014) | 8 lines
Changed paths:
   M /trunk/coregrind/m_syswrap/priv_syswrap-darwin.h
   M /trunk/coregrind/m_syswrap/syswrap-darwin.c
   M /trunk/include/vki/vki-darwin.h
   M /trunk/include/vki/vki-scnums-darwin.h

* add syscall wrappers for some new OSX 10.10 specific calls
  necp_match_policy
    sysctlbyname
      getattrlistbulk (kludged)

* add initial entries for the resync-filter on OSX 10.10.


------------------------------------------------------------------------
r14717 | sewardj | 2014-11-13 16:28:24 +0000 (Thu, 13 Nov 2014) | 2 lines
Changed paths:
   M /trunk/darwin14.supp

Update suppressions for OSX 10.10.

------------------------------------------------------------------------
r14716 | mjw | 2014-11-13 13:03:25 +0000 (Thu, 13 Nov 2014) | 1 line
Changed paths:
